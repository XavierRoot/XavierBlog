<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>浏览器XSS编码解析原理 - Xavier&#39;s Blog</title><meta name="author" content="Xavier">
<meta name="description" content="一、小测验 本文介绍浏览器加载过程以及常用的XSS编码解析原理。首发于T00ls论坛，在博客中再发一遍留档。
"><meta name="keywords" content='Pentest, XSS'>
  <meta itemprop="name" content="浏览器XSS编码解析原理">
  <meta itemprop="description" content="一、小测验 本文介绍浏览器加载过程以及常用的XSS编码解析原理。首发于T00ls论坛，在博客中再发一遍留档。">
  <meta itemprop="datePublished" content="2023-03-30T21:45:15+08:00">
  <meta itemprop="dateModified" content="2023-03-30T21:45:15+08:00">
  <meta itemprop="wordCount" content="9642">
  <meta itemprop="keywords" content="Pentest,XSS"><meta property="og:url" content="http://localhost:1313/posts/2023-6-%E6%B5%8F%E8%A7%88%E5%99%A8xss%E7%BC%96%E7%A0%81%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86/">
  <meta property="og:site_name" content="Xavier&#39;s Blog">
  <meta property="og:title" content="浏览器XSS编码解析原理">
  <meta property="og:description" content="一、小测验 本文介绍浏览器加载过程以及常用的XSS编码解析原理。首发于T00ls论坛，在博客中再发一遍留档。">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-03-30T21:45:15+08:00">
    <meta property="article:modified_time" content="2023-03-30T21:45:15+08:00">
    <meta property="article:tag" content="Pentest">
    <meta property="article:tag" content="XSS">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="浏览器XSS编码解析原理">
  <meta name="twitter:description" content="一、小测验 本文介绍浏览器加载过程以及常用的XSS编码解析原理。首发于T00ls论坛，在博客中再发一遍留档。">
<meta name="application-name" content="Xavier&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Xavier&#39;s Blog"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="http://localhost:1313/posts/2023-6-%E6%B5%8F%E8%A7%88%E5%99%A8xss%E7%BC%96%E7%A0%81%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86/" title="浏览器XSS编码解析原理 - Xavier&#39;s Blog" /><link rel="prev" type="text/html" href="http://localhost:1313/posts/20230324-%E6%94%BB%E9%98%B2%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" title="20230324-攻防项目总结" /><link rel="next" type="text/html" href="http://localhost:1313/posts/20230425-shellspawn/" title="Shell Spawning" /><link rel="alternate" type="text/markdown" href="http://localhost:1313/posts/2023-6-%E6%B5%8F%E8%A7%88%E5%99%A8xss%E7%BC%96%E7%A0%81%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86/index.md" title="浏览器XSS编码解析原理 - Xavier's Blog"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "浏览器XSS编码解析原理",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/localhost:1313\/posts\/2023-6-%E6%B5%8F%E8%A7%88%E5%99%A8xss%E7%BC%96%E7%A0%81%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86\/"
    },"genre": "posts","keywords": "Pentest, XSS","wordcount":  9642 ,
    "url": "http:\/\/localhost:1313\/posts\/2023-6-%E6%B5%8F%E8%A7%88%E5%99%A8xss%E7%BC%96%E7%A0%81%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86\/","datePublished": "2023-03-30T21:45:15+08:00","dateModified": "2023-03-30T21:45:15+08:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Xavier"
      },"description": ""
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="Xavier&#39;s Blog"><span class="header-title-text">Xavier&#39;s Blog</span></a><span class="header-subtitle">一个安全工作者</span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/"><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item">
              <a class="menu-link" href="/friends/"><i class="fa-solid fa-user-group fa-fw fa-sm" aria-hidden="true"></i> Friends</a></li><li class="menu-item">
              <a class="menu-link" href="/tools/"><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden="true"></i> Tools</a></li><li class="menu-item">
              <a class="menu-link" href="/about/"><i class="fa-solid fa-circle-info fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Xavier&#39;s Blog"><span class="header-title-text">Xavier&#39;s Blog</span></a><span class="header-subtitle">一个安全工作者</span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/posts/"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/categories/"><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item"><a class="menu-link" href="/friends/"><i class="fa-solid fa-user-group fa-fw fa-sm" aria-hidden="true"></i> Friends</a></li><li class="menu-item"><a class="menu-link" href="/tools/"><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden="true"></i> Tools</a></li><li class="menu-item"><a class="menu-link" href="/about/"><i class="fa-solid fa-circle-info fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="合集"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>浏览器XSS编码解析原理</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><img loading="lazy" src="/resource/friends/me.png" alt="Xavier" data-title="Xavier" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;Xavier</span></span><span class="post-included-in">&nbsp;收录于 <a href="/categories/pentest/" class="post-category" title="分类 - Pentest"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Pentest</a></span></div><div class="post-meta-line"><span title="发布于 2023-03-30 21:45:15"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2023-03-30">2023-03-30</time></span>&nbsp;<span title="9642 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 9700 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 20 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#一小测验">一、小测验</a>
      <ul>
        <li><a href="#问题">问题</a></li>
        <li><a href="#答案">答案</a></li>
      </ul>
    </li>
    <li><a href="#二浏览器工作原理">二、浏览器工作原理</a></li>
    <li><a href="#三网页加载过程">三、网页加载过程</a></li>
    <li><a href="#四浏览器解析">四、浏览器解析</a>
      <ul>
        <li><a href="#41-html解析">4.1 HTML解析</a>
          <ul>
            <li><a href="#1数据状态">1.数据状态</a></li>
            <li><a href="#13251-data-state">13.2.5.1 Data state</a></li>
            <li><a href="#2rcdata状态">2.RCDATA状态</a>
              <ul>
                <li><a href="#13252-rcdata-state">13.2.5.2 RCDATA state</a></li>
                <li><a href="#foreign-元素">Foreign 元素</a></li>
              </ul>
            </li>
            <li><a href="#3属性值状态">3.属性值状态</a>
              <ul>
                <li><a href="#132536-attribute-value-double-quoted-state">13.2.5.36 Attribute value (double-quoted) state</a></li>
                <li><a href="#132537-attribute-value-single-quoted-state">13.2.5.37 Attribute value (single-quoted) state</a></li>
                <li><a href="#132538-attribute-value-unquoted-state">13.2.5.38 Attribute value (unquoted) state</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#42-url解析">4.2 URL解析</a></li>
        <li><a href="#43-javascript解析">4.3 JavaScript解析</a>
          <ul>
            <li><a href="#1-执行上下文">1. 执行上下文</a></li>
            <li><a href="#2字符解码">2.字符解码</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#五浏览器解码顺序">五、浏览器解码顺序</a></li>
    <li><a href="#六总结">六、总结</a></li>
    <li><a href="#参考文章">参考文章：</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content" data-end-flag="It&#39;s end."><h2 id="一小测验" class="heading-element"><span>一、小测验</span>
  <a href="#%e4%b8%80%e5%b0%8f%e6%b5%8b%e9%aa%8c" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>本文介绍浏览器加载过程以及常用的XSS编码解析原理。首发于T00ls论坛，在博客中再发一遍留档。</p>
<p>首先做个小测试，下面的XSS payload能否触发，题目选自<a href="https://www.attacker-domain.com/2013/04/deep-dive-into-browser-parsing-and-xss.html"target="_blank" rel="external nofollow noopener noreferrer">大佬博客</a>。</p>
<h3 id="问题" class="heading-element"><span>问题</span>
  <a href="#%e9%97%ae%e9%a2%98" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>基础题：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">1.URL编码&#34;javascript:alert(1)&#34;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;%6a%61%76%61%73%63%72%69%70%74:%61%6c%65%72%74%28%31%29&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.实体编码&#34;javascript&#34;，URL编码&#34;alert(2)&#34;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;:%61   %6c%65%72%74%28%32%29&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.URL编码&#34;:&#34;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;javascript%3aalert(3)&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.实体编码<span class="err">&lt;</span> &gt;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="ni">&amp;#60;</span>img src=x onerror=alert(4)<span class="ni">&amp;#62;</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5.实体编码<span class="err">&lt;</span> &gt;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">textarea</span><span class="p">&gt;</span><span class="ni">&amp;#60;</span>script<span class="ni">&amp;#62;</span>alert(5)<span class="ni">&amp;#60;</span>/script<span class="ni">&amp;#62;</span><span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6. <span class="p">&lt;</span><span class="nt">textarea</span><span class="p">&gt;&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mi">6</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>高级题：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">7.实体编码&#39;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&#34;confirm(&#39;7&amp;#39;);&#34;</span><span class="p">&gt;</span>Button<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">8.Unicode编码&#39;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&#34;confirm(&#39;8\u0027);&#34;</span><span class="p">&gt;</span>Button<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">9.实体编码alert(9);
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">97</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">108</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">101</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">114</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">116</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">40</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">57</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">41</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">59</span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">10.Unicode编码alert
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">\u0061\u006c\u0065\u0072\u0074</span><span class="p">(</span><span class="mi">10</span><span class="p">);&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">11.unicode编码alert(11)
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">\u0061\u006c\u0065\u0072\u0074\u0028\u0031\u0031\u0029</span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">12.Unicode编码alert和12
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">\u0061\u006c\u0065\u0072\u0074</span><span class="p">(</span><span class="nx">\u0031\u0032</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">13.Unicode编码&#39;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="err">&#39;</span><span class="mi">13</span><span class="nx">\u0027</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">14.Unicode编码换行符
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;14\u000a&#39;</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>附加题：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span>
</span></span><span class="line"><span class="cl">	  <span class="na">href</span><span class="o">=</span><span class="s">&#34;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3a;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x31;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x36;&amp;#x33;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x35;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x32;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x34;&amp;#x28;&amp;#x31;&amp;#x35;&amp;#x29;&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="答案" class="heading-element"><span>答案</span>
  <a href="#%e7%ad%94%e6%a1%88" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><blockquote>
<p>The answers to these questions are <a href="http://test.attacker-domain.com/browserparsing/answers.txt"target="_blank" rel="external nofollow noopener noreferrer">here</a> and the testing page is <a href="http://test.attacker-domain.com/browserparsing/tests.html"target="_blank" rel="external nofollow noopener noreferrer">here</a>.</p>
</blockquote>
<p>具体内容可以去大佬博客看，我这就写个结果，Y表示触发，N表示不触发</p>
<p>1N，2Y，3N，4N，5N，6N</p>
<p>7Y，8N，9N，10Y，11N，12N，13N，14Y</p>
<p>15Y</p>
<p>如果大部分问题都回答正确，且在这过程中没有感到困惑，那么就不需要再阅读这篇文章了。</p>
<p>本文将讲解浏览器工作的一些原理和解析过程，希望能有些帮助。</p>
<h2 id="二浏览器工作原理" class="heading-element"><span>二、浏览器工作原理</span>
  <a href="#%e4%ba%8c%e6%b5%8f%e8%a7%88%e5%99%a8%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>浏览器的主要组件，包含用户界面、浏览器引擎、呈现引擎、网络、用户界面后端、JavaScript解释器、数据存储。</p>
<ol>
<li>用户界面： 包括地址栏、前进/后退按钮、书签菜单等。除了浏览器主窗口显示的您请求的页面外，其他显示的各个部分都属于用户界面。</li>
<li>浏览器引擎：在用户界面和呈现引擎之间传送指令。</li>
<li>呈现引擎：负责显示请求的内容。如果请求的内容是 HTML，它就负责解析 HTML 和 CSS 内容，并将解析后的内容显示在屏幕上。</li>
<li>网络：用于网络调用，比如 HTTP 请求。其接口与平台无关，并为所有平台提供底层实现。</li>
<li>用户界面后端：用于绘制基本的窗口小部件，比如组合框和窗口。其公开了与平台无关的通用接口，而在底层使用操作系统的用户界面方法。</li>
<li>JavaScript 解释器：用于解析和执行 JavaScript 代码。</li>
<li>数据存储：这是持久层。浏览器需要在硬盘上保存各种数据，例如 Cookie。新的 HTML 规范 (HTML5) 定义了“网络数据库”，这是一个完整（但是轻便）的浏览器内数据库。</li>
</ol>
<h2 id="三网页加载过程" class="heading-element"><span>三、网页加载过程</span>
  <a href="#%e4%b8%89%e7%bd%91%e9%a1%b5%e5%8a%a0%e8%bd%bd%e8%bf%87%e7%a8%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>浏览器加载解析渲染呈现的整个过程称为关键渲染路径（Critical Rendering Path），指的是浏览器从请求 HTML，CSS，JavaScript 文件开始，到将它们最终以像素输出到屏幕上这一过程。包括以下几个部分：</p>
<p>构建DOM树，构建CSSOM，构建Render，Layout和Paint，这些过程中存在这一定的交叉。</p>
<p>下面简述浏览器加载解析渲染的整个过程：</p>
<p>1、浏览器通过URL进行域名解析，向服务器发起请求，接受文件</p>
<p>2、<strong>构建DOM树</strong>：浏览器获取一个HTML页面时，会自上而下加载，并逐行解析HTML标签，解析器根据HTML文档开始构建<strong>DOM树</strong>。</p>
<pre><code>**HTML文档解析过程**：

1）浏览器接收到显示字节内容的html文件；

2）浏览器将字节内容转换为字符文件；

3）浏览器将字符文件解析成许多Tokens（符号标签）；

4）将Token解析为节点对象Objects；

5）将节点对象Objects连接起来形成DOM树；
</code></pre>
<p>3、<strong>构建CSSOM树</strong>：浏览器在HTML文档解析过程中，遇到外部CSS文件，浏览器会另外发起请求去获取CSS文件并进行解析构建CSSOM树，并不会阻塞网页加载过程，不影响解析HTML文件。</p>
<pre><code>**解析CSS过程**：

步骤与HTML文档解析类似：

1）浏览器接收到字节内容的CSS文件；

2）浏览器将字节内容转换为字符文件；

3）浏览器将字符文件解析成许多Tokens（符号标签）；

4）将Token解析为节点对象Objects；

5）将节点对象Objects连接起来构建成CSSOM树（CSS Rule Tree）；
</code></pre>
<p>4、加载过程中，遇到图片资源，也是另发起一个请求获取图片资源，也不会影响HTML文档的加载。</p>
<p>5、<strong>JavaScript</strong>：在加载过程中，当遇到外链的JS脚本文件或<code>&lt;script&gt;</code>等标签内的JS代码时，会<strong>暂停</strong>HTML标签的解析，挂起HTML文档加载解析渲染的线程，加载JS脚本文件，使用JavaScript引擎对JS进行解析，通过DOM API 和CSSOM API来操作 DOM Tree和 CSS Rule Tree。等到JS文件加载、解析完毕，才会继续解析HTML，恢复HTML文档的渲染线程。</p>
<pre><code>**解析JS代码过程**：
</code></pre>
<p>1）浏览器会请求js代码，这时HTML文件的解析会停下来；</p>
<p>2）但是CSS文件的解析不会停止，所以会继续构造出CSSOM树；</p>
<p>3）在构建CSSOM树时，返回的js文件并不会执行，在CSSOM树构建完成，才会运行JS文件。</p>
<p>4）JS文件执行结束后，HTML继续解析并构建出DOM树，进行下一步。</p>
<p>6、<strong>构建渲染树</strong>：在DOM树和CSSOM树构建完成后，浏览器会结合DOM Tree和CSS Rule Tree 构建<strong>呈现树/渲染树</strong>（Rendering Tree）；</p>
<p>7、布局阶段：获取渲染树结构、节点位置和大小等；</p>
<p>8、绘制元素：根据渲染树和布局绘制所有节点的可视属性。</p>
<p>9、合并渲染层：把以上绘制的所有图层（类似于PhotoShop中的“图层”）合并,最终输出一张图片</p>
<p>当用户在浏览网页时进行交互或通过 js 脚本改变页面结构时，以上的部分操作有可能重复运行，此过程称为 Repaint 或 Reflow。</p>
<blockquote>
<p><strong>Repaint</strong>：当元素改变时，不会影响元素在页面当中的位置（比如 background-color, border-color, visibility），浏览器仅仅会应用新的样式重绘此元素，此过程称为 Repaint。</p>
<p>Reflow：当元素改变时，将会影响文档内容、结构或元素位置，此过程称为 Reflow。（ HTML 使用的是 flow based layout ，即流式布局，所以，如果某元件的几何尺寸发生了变化，需要重新布局，也就叫 Reflow。）</p>
</blockquote>
<h2 id="四浏览器解析" class="heading-element"><span>四、浏览器解析</span>
  <a href="#%e5%9b%9b%e6%b5%8f%e8%a7%88%e5%99%a8%e8%a7%a3%e6%9e%90" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>解析 HTML 文档涉及三个主要过程：HTML 解析器、URL 解析器和 JavaScript 解析器。每个解析器负责解码和解析其文档，并且在相应的解析器规范中明确指定了它们应该如何执行此操作。</p>
<h3 id="41-html解析" class="heading-element"><span>4.1 HTML解析</span>
  <a href="#41-html%e8%a7%a3%e6%9e%90" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>上文说过浏览器将收到的HTML文件的字节内容转换为字符文件，然后将字符文件解析成许多Tokens（符号标签），在这一过程用到的就是HTML解析器。</p>
<p>参考<a href="https://html.spec.whatwg.org/multipage/parsing.html"target="_blank" rel="external nofollow noopener noreferrer">HTML标记规范</a>，我们只需关注如何完成文档解码和何时创建新token。</p>
<p>首先了解一下HTML解析器的工作原理：</p>
<ul>
<li>HTML解析器是一个状态机，它自上而下对HTML资源从进行解析，当遇到一个<code>&lt;</code>符号（后面没有<code>/</code>）时，就会进入标签开始状态（Tag Open State）；</li>
<li>然后进入标签名称状态（Tag name state）搜寻标签，img可以被识别为正确的标签，img1则不会识别。</li>
<li><em>后面可能还有其他很多种状态，如：&quot;<a href="https://html.spec.whatwg.org/multipage/parsing.html#before-attribute-name-state"target="_blank" rel="external nofollow noopener noreferrer">Before attribute name state</a>&quot;、“<a href="https://html.spec.whatwg.org/multipage/parsing.html#attribute-name-state"target="_blank" rel="external nofollow noopener noreferrer">Attribute name state</a>”等，我们先不提，有兴趣可以去看HTML标记规范。</em></li>
<li>当最后在读到最近的一个<code>&gt;</code>时，结束标签状态进入数据状态（Data State），发出当前标签token。</li>
</ul>
<p>当解析器处于“数据状态”时，它会继续进行HTML解析处理并在发现完整标记时发出token。</p>
<p><strong>HTML字符实体解码</strong></p>
<p>在解析过程中遇到HTML字符实体编码，HTML解析器处于以下三种状态时，能够对HTML字符实体进行解码：</p>
<ul>
<li>“数据状态”（&ldquo;Character reference in data state&rdquo;；</li>
<li>“RCDATA状态”（&ldquo;Character reference in RCDATA state&rdquo;）</li>
<li>“属性值状态”（&ldquo;Character reference in attribute value state&rdquo;）。</li>
</ul>
<p>这些状态下，HTML 实体将从其“<code>&amp;#..;</code>”形式中解码出来，变成相应的字符插入到数据缓冲区。</p>
<p>也就是说，HTML字符实体编码只能在数据状态（标签外部和标签的text段），RCDATA状态（RCDATA元素内）、属性值状态（标签内的属性值位置）才能被解析。</p>
<h4 id="1数据状态" class="heading-element"><span>1.数据状态</span>
  <a href="#1%e6%95%b0%e6%8d%ae%e7%8a%b6%e6%80%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><blockquote>
<h4 id="13251-data-state" class="heading-element"><span>13.2.5.1 Data state</span>
  <a href="#13251-data-state" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>Consume the <a href="https://html.spec.whatwg.org/multipage/parsing.html#next-input-character"target="_blank" rel="external nofollow noopener noreferrer">next input character</a>:</p>
<ul>
<li>
<p>U+0026 AMPERSAND (&amp;)</p>
<p>Set the <a href="https://html.spec.whatwg.org/multipage/parsing.html#return-state"target="_blank" rel="external nofollow noopener noreferrer">return state</a> to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#data-state"target="_blank" rel="external nofollow noopener noreferrer">data state</a>. Switch to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#character-reference-state"target="_blank" rel="external nofollow noopener noreferrer">character reference state</a>.</p>
</li>
<li>
<p>U+003C LESS-THAN SIGN (&lt;)</p>
<p>Switch to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#tag-open-state"target="_blank" rel="external nofollow noopener noreferrer">tag open state</a>.</p>
</li>
<li>
<p>U+0000 NULL</p>
<p>This is an <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-error-unexpected-null-character"target="_blank" rel="external nofollow noopener noreferrer">unexpected-null-character</a> <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-errors"target="_blank" rel="external nofollow noopener noreferrer">parse error</a>. Emit the <a href="https://html.spec.whatwg.org/multipage/parsing.html#current-input-character"target="_blank" rel="external nofollow noopener noreferrer">current input character</a> as a character token.</p>
</li>
<li>
<p>EOF</p>
<p>Emit an end-of-file token.</p>
</li>
<li>
<p>Anything else</p>
<p>Emit the <a href="https://html.spec.whatwg.org/multipage/parsing.html#current-input-character"target="_blank" rel="external nofollow noopener noreferrer">current input character</a> as a character token.</p>
</li>
</ul>
</blockquote>
<p>当在数据状态，即标签外部，或者标签内的text段中，匹配到&amp;符号时，会切换到字符引用状态（character reference state）。</p>
<p>例如问题4，“&lt;”和“&gt;”字符在输入流中被编码为“<code>&amp;#60;</code>”和“<code>&amp;#62;</code>”，当解析器处于“数据状态”时，它们将被解析。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">4.实体编码<span class="err">&lt;</span> &gt;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="ni">&amp;#60;</span>img src=x onerror=alert(4)<span class="ni">&amp;#62;</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>那么当HTML实体被解析为<code>&lt; &gt;</code>时，它们中的脚本能否被执行呢？</p>
<p>答案是不能，因为当解析器在解析实体编码后，不会转换成“标签打开状态”，因此不会创建新的标签。</p>
<p>这就是我们为什么建议用字符实体编码来处理不受信任的用户输入，以确保它们作为数据进行解析。</p>
<p>再看，我们对h1的h进行HTML实体编码，它能被解析形成标签吗？</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="err">&lt;</span><span class="ni">&amp;#104;</span>1&gt;123<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>答案是不能，HTML解析器首先匹配到div标签，进入数据状态，接着搜索到&lt;，进入标签名称状态，但并没有匹配到正确的标签，所以回到了数据状态，对<code>&amp;#104;</code>进行解码，最后返回的结果就是文本状态下的<code>&lt;h1&gt;123</code>。</p>
<h4 id="2rcdata状态" class="heading-element"><span>2.RCDATA状态</span>
  <a href="#2rcdata%e7%8a%b6%e6%80%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>什么是RCDATA？我们需要知道HTML中共有5种元素：空元素、原始文本元素、RCDATA元素、外来元素以及常规元素。RCDATA状态就是RCDATA元素标签内的状态。</p>
<p><strong>Void 元素</strong>：area, base, br, col, embed, hr, img, input, keygen, link, menuitem, meta, param, source, track, wbr。Void元素没有结束标签，因此不能在开始标签和结束标签直接放任何内容。</p>
<p><strong>Raw text 元素</strong>：script, style。Raw text元素能含有text文本内容。</p>
<p><strong>RCDATA 元素</strong>：textarea, title。RCDATA 元素可以有文本和字符引用</p>
<p><strong>Foreign 元素</strong>：MathML 命名空间和 SVG 命名空间的元素。外部元素可以有文本、字符引用、CDATA 部分、其他元素和注释。</p>
<p><strong>Normal 元素</strong>：除了以上4种元素以外的其他所有允许的 HTML 元素都是普通元素。普通元素可以有文本、字符引用、其他元素和注释。</p>
<blockquote>
<h5 id="13252-rcdata-state" class="heading-element"><span>13.2.5.2 RCDATA state</span>
  <a href="#13252-rcdata-state" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>Consume the <a href="https://html.spec.whatwg.org/multipage/parsing.html#next-input-character"target="_blank" rel="external nofollow noopener noreferrer">next input character</a>:</p>
<ul>
<li>
<p>U+0026 AMPERSAND (&amp;)</p>
<p>Set the <a href="https://html.spec.whatwg.org/multipage/parsing.html#return-state"target="_blank" rel="external nofollow noopener noreferrer">return state</a> to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#rcdata-state"target="_blank" rel="external nofollow noopener noreferrer">RCDATA state</a>. Switch to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#character-reference-state"target="_blank" rel="external nofollow noopener noreferrer">character reference state</a>.</p>
</li>
<li>
<p>U+003C LESS-THAN SIGN (&lt;)</p>
<p>Switch to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#rcdata-less-than-sign-state"target="_blank" rel="external nofollow noopener noreferrer">RCDATA less-than sign state</a>.</p>
</li>
<li>
<p>U+0000 NULL</p>
<p>This is an <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-error-unexpected-null-character"target="_blank" rel="external nofollow noopener noreferrer">unexpected-null-character</a> <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-errors"target="_blank" rel="external nofollow noopener noreferrer">parse error</a>. Emit a U+FFFD REPLACEMENT CHARACTER character token.</p>
</li>
<li>
<p>EOF</p>
<p>Emit an end-of-file token.</p>
</li>
<li>
<p>Anything else</p>
<p>Emit the <a href="https://html.spec.whatwg.org/multipage/parsing.html#current-input-character"target="_blank" rel="external nofollow noopener noreferrer">current input character</a> as a character token.</p>
</li>
</ul>
</blockquote>
<p>之前我们说“RCDATA 状态”下可以对HTML字符引用进行解码。这意味着“textarea”和“title”中的字符引用将被 HTML 解析器解码。</p>
<p>同样，在解码这些字符引用时没有进入“标签打开状态”，这就是问题 5 中没有脚本执行的原因。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">5.实体编码<span class="err">&lt;</span> &gt;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">textarea</span><span class="p">&gt;</span><span class="ni">&amp;#60;</span>script<span class="ni">&amp;#62;</span>alert(5)<span class="ni">&amp;#60;</span>/script<span class="ni">&amp;#62;</span><span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>此外，RCDATA还有一个特别之处。当浏览器解析到 RCDATA 元素时，它会进入“RCDATA 状态”。在这种状态下，如果遇到&rsquo;&lt;&lsquo;字符，就会切换到“RCDATA小于号状态”（<a href="https://html.spec.whatwg.org/multipage/parsing.html#rcdata-less-than-sign-state"target="_blank" rel="external nofollow noopener noreferrer">RCDATA less-than sign state</a>），如果后面紧跟的不是相应的RCDATA元素闭合标签，则会回到“RCDATA状态”。</p>
<p>这意味着在 RCDATA 元素（例如<code> &lt;textarea&gt;</code>、<code>&lt;title&gt;</code>）的标签内部，唯一能够被识别为标签的字符是 ”<code>&lt;/textarea&gt;</code>”闭合标签或“<code>&lt;/title&gt;</code>”闭合标签，具体取决于前面打开的标签。</p>
<p>因此，即便在“textarea”或“title”中创建额外的标签，也无法在其中执行脚本。这就解释了为什么问题6中脚本不执行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">textarea</span><span class="p">&gt;&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mi">6</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>关于“CDATA”元素的简单说明。CDATA 中包含的任何内容都不会导致解析器创建新的开放标记，并且它以“]]&gt;”序列结束。</p>
<p>因此，如果用户输入想要跳出 CDATA 上下文，必须使用没有任何编码的精确“]]&gt;”序列，否则它不会跳出上下文。</p>
</blockquote>
<p>所以当我们遇到<code>&lt;textarea&gt;</code>或<code>&lt;title&gt;</code>标签下的XSS插入点时，首先要做的就是闭合前面的标签，这样后续的payload才可能被执行，如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mi">2</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="foreign-元素" class="heading-element"><span>Foreign 元素</span>
  <a href="#foreign-%e5%85%83%e7%b4%a0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>细心的同学会发现上文我们提到Foreign元素也可以有字符引用。</p>
<blockquote>
<p><strong>Foreign 元素</strong>：MathML 命名空间和 SVG 命名空间的元素。外部元素可以有文本、字符引用、CDATA 部分、其他元素和注释。</p>
</blockquote>
<p>这类情况，也是属于数据状态解析HTML字符引用，看示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">编码<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span> <span class="na">onerror</span><span class="o">=</span><span class="s">alert(1)</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">math</span><span class="p">&gt;</span><span class="ni">&amp;lt;&amp;#105;&amp;#109;&amp;#103;&amp;#32;&amp;#115;&amp;#114;&amp;#99;&amp;#32;&amp;#111;&amp;#110;&amp;#101;&amp;#114;&amp;#114;&amp;#111;&amp;#114;&amp;equals;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;lpar;&amp;#49;&amp;rpar;&amp;gt;</span><span class="p">&lt;/</span><span class="nt">math</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">svg</span><span class="p">&gt;</span><span class="ni">&amp;lt;&amp;#105;&amp;#109;&amp;#103;&amp;#32;&amp;#115;&amp;#114;&amp;#99;&amp;#32;&amp;#111;&amp;#110;&amp;#101;&amp;#114;&amp;#114;&amp;#111;&amp;#114;&amp;equals;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;lpar;&amp;#49;&amp;rpar;&amp;gt;</span><span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上述示例可以被解码，但与之前提过的一样，无法建立img标签，因此无法执行XSS。</p>
<p>我们可以看几个可以执行的SVG和MathML命名空间的XSS：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">svg</span><span class="p">&gt;&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">40</span><span class="p">;</span><span class="mi">1</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">41</span><span class="p">;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">svg</span><span class="p">&gt;&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">97</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">108</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">101</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">114</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">116</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">40</span><span class="p">;</span><span class="mi">1</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">41</span><span class="p">;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">math</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span> <span class="na">onerror</span><span class="o">=</span><span class="s">alert&amp;#40;2&amp;#41;</span><span class="p">&gt;&lt;/</span><span class="nt">math</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到，还是在<code>script</code>标签内的数据状态和<code>img</code>标签的属性值状态处解析后进入了JavaScript解析器，从而触发XSS。</p>
<h4 id="3属性值状态" class="heading-element"><span>3.属性值状态</span>
  <a href="#3%e5%b1%9e%e6%80%a7%e5%80%bc%e7%8a%b6%e6%80%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>“属性值状态下的字符引用”（&ldquo;Character reference in attribute value state&rdquo;），它可以细分为无引号、单引号、双引号3种状态下的HTML实体引用。</p>
<p>看原文：</p>
<blockquote>
<h5 id="132536-attribute-value-double-quoted-state" class="heading-element"><span>13.2.5.36 Attribute value (double-quoted) state</span>
  <a href="#132536-attribute-value-double-quoted-state" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>Consume the <a href="https://html.spec.whatwg.org/multipage/parsing.html#next-input-character"target="_blank" rel="external nofollow noopener noreferrer">next input character</a>:</p>
<ul>
<li>
<p>U+0022 QUOTATION MARK (&quot;)</p>
<p>Switch to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#after-attribute-value-%28quoted%29-state"target="_blank" rel="external nofollow noopener noreferrer">after attribute value (quoted) state</a>.</p>
</li>
<li>
<p>U+0026 AMPERSAND (&amp;)</p>
<p>Set the <a href="https://html.spec.whatwg.org/multipage/parsing.html#return-state"target="_blank" rel="external nofollow noopener noreferrer">return state</a> to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#attribute-value-%28double-quoted%29-state"target="_blank" rel="external nofollow noopener noreferrer">attribute value (double-quoted) state</a>. Switch to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#character-reference-state"target="_blank" rel="external nofollow noopener noreferrer">character reference state</a>.</p>
</li>
<li>
<p>U+0000 NULL</p>
<p>This is an <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-error-unexpected-null-character"target="_blank" rel="external nofollow noopener noreferrer">unexpected-null-character</a> <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-errors"target="_blank" rel="external nofollow noopener noreferrer">parse error</a>. Append a U+FFFD REPLACEMENT CHARACTER character to the current attribute&rsquo;s value.</p>
</li>
<li>
<p>EOF</p>
<p>This is an <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-error-eof-in-tag"target="_blank" rel="external nofollow noopener noreferrer">eof-in-tag</a> <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-errors"target="_blank" rel="external nofollow noopener noreferrer">parse error</a>. Emit an end-of-file token.</p>
</li>
<li>
<p>Anything else</p>
<p>Append the <a href="https://html.spec.whatwg.org/multipage/parsing.html#current-input-character"target="_blank" rel="external nofollow noopener noreferrer">current input character</a> to the current attribute&rsquo;s value.</p>
</li>
</ul>
<h5 id="132537-attribute-value-single-quoted-state" class="heading-element"><span>13.2.5.37 Attribute value (single-quoted) state</span>
  <a href="#132537-attribute-value-single-quoted-state" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>Consume the <a href="https://html.spec.whatwg.org/multipage/parsing.html#next-input-character"target="_blank" rel="external nofollow noopener noreferrer">next input character</a>:</p>
<ul>
<li>
<p>U+0027 APOSTROPHE (&rsquo;)</p>
<p>Switch to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#after-attribute-value-%28quoted%29-state"target="_blank" rel="external nofollow noopener noreferrer">after attribute value (quoted) state</a>.</p>
</li>
<li>
<p>U+0026 AMPERSAND (&amp;)</p>
<p>Set the <a href="https://html.spec.whatwg.org/multipage/parsing.html#return-state"target="_blank" rel="external nofollow noopener noreferrer">return state</a> to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#attribute-value-%28single-quoted%29-state"target="_blank" rel="external nofollow noopener noreferrer">attribute value (single-quoted) state</a>. Switch to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#character-reference-state"target="_blank" rel="external nofollow noopener noreferrer">character reference state</a>.</p>
</li>
<li>
<p>U+0000 NULL</p>
<p>This is an <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-error-unexpected-null-character"target="_blank" rel="external nofollow noopener noreferrer">unexpected-null-character</a> <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-errors"target="_blank" rel="external nofollow noopener noreferrer">parse error</a>. Append a U+FFFD REPLACEMENT CHARACTER character to the current attribute&rsquo;s value.</p>
</li>
<li>
<p>EOF</p>
<p>This is an <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-error-eof-in-tag"target="_blank" rel="external nofollow noopener noreferrer">eof-in-tag</a> <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-errors"target="_blank" rel="external nofollow noopener noreferrer">parse error</a>. Emit an end-of-file token.</p>
</li>
<li>
<p>Anything else</p>
<p>Append the <a href="https://html.spec.whatwg.org/multipage/parsing.html#current-input-character"target="_blank" rel="external nofollow noopener noreferrer">current input character</a> to the current attribute&rsquo;s value.</p>
</li>
</ul>
<h5 id="132538-attribute-value-unquoted-state" class="heading-element"><span>13.2.5.38 Attribute value (unquoted) state</span>
  <a href="#132538-attribute-value-unquoted-state" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>Consume the <a href="https://html.spec.whatwg.org/multipage/parsing.html#next-input-character"target="_blank" rel="external nofollow noopener noreferrer">next input character</a>:</p>
<ul>
<li>
<p>U+0009 CHARACTER TABULATION (tab)</p>
</li>
<li>
<p>U+000A LINE FEED (LF)</p>
</li>
<li>
<p>U+000C FORM FEED (FF)</p>
</li>
<li>
<p>U+0020 SPACE</p>
<p>Switch to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#before-attribute-name-state"target="_blank" rel="external nofollow noopener noreferrer">before attribute name state</a>.</p>
</li>
<li>
<p>U+0026 AMPERSAND (&amp;)</p>
<p>Set the <a href="https://html.spec.whatwg.org/multipage/parsing.html#return-state"target="_blank" rel="external nofollow noopener noreferrer">return state</a> to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#attribute-value-%28unquoted%29-state"target="_blank" rel="external nofollow noopener noreferrer">attribute value (unquoted) state</a>. Switch to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#character-reference-state"target="_blank" rel="external nofollow noopener noreferrer">character reference state</a>.</p>
</li>
<li>
<p>U+003E GREATER-THAN SIGN (&gt;)</p>
<p>Switch to the <a href="https://html.spec.whatwg.org/multipage/parsing.html#data-state"target="_blank" rel="external nofollow noopener noreferrer">data state</a>. Emit the current tag token.</p>
</li>
<li>
<p>U+0000 NULL</p>
<p>This is an <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-error-unexpected-null-character"target="_blank" rel="external nofollow noopener noreferrer">unexpected-null-character</a> <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-errors"target="_blank" rel="external nofollow noopener noreferrer">parse error</a>. Append a U+FFFD REPLACEMENT CHARACTER character to the current attribute&rsquo;s value.</p>
</li>
<li>
<p>U+0022 QUOTATION MARK (&quot;)</p>
</li>
<li>
<p>U+0027 APOSTROPHE (')</p>
</li>
<li>
<p>U+003C LESS-THAN SIGN (&lt;)</p>
</li>
<li>
<p>U+003D EQUALS SIGN (=)</p>
</li>
<li>
<p>U+0060 GRAVE ACCENT (`)</p>
<p>This is an <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-error-unexpected-character-in-unquoted-attribute-value"target="_blank" rel="external nofollow noopener noreferrer">unexpected-character-in-unquoted-attribute-value</a> <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-errors"target="_blank" rel="external nofollow noopener noreferrer">parse error</a>. Treat it as per the &ldquo;anything else&rdquo; entry below.</p>
</li>
<li>
<p>EOF</p>
<p>This is an <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-error-eof-in-tag"target="_blank" rel="external nofollow noopener noreferrer">eof-in-tag</a> <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-errors"target="_blank" rel="external nofollow noopener noreferrer">parse error</a>. Emit an end-of-file token.</p>
</li>
<li>
<p>Anything else</p>
<p>Append the <a href="https://html.spec.whatwg.org/multipage/parsing.html#current-input-character"target="_blank" rel="external nofollow noopener noreferrer">current input character</a> to the current attribute&rsquo;s value.</p>
</li>
</ul>
</blockquote>
<p>例如下面字符实体编码，都将被解码还原：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">实体编码&#34;javascript&#34;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span> <span class="na">id</span><span class="o">=</span><span class="s">&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;</span><span class="p">&gt;</span>123<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&#39;</span><span class="p">&gt;</span>456<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">h1</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&#34;</span><span class="p">&gt;</span>789<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在属性值下的HTML实体编码，是平时XSS编码的一种常用方式，如下述payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">编码alert(/xss/)
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">svg</span><span class="err">/</span><span class="na">onload</span><span class="o">=</span><span class="s">&amp;#x0061;&amp;#x006c;&amp;#x0065;&amp;#x0072;&amp;#x0074;&amp;#x0028;&amp;#x002f;&amp;#x0078;&amp;#x0073;&amp;#x0073;&amp;#x002f;&amp;#x0029;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span><span class="err">/</span><span class="na">href</span><span class="o">=</span><span class="s">javascript&amp;colon;alert&amp;grave;1&amp;grave;</span><span class="p">&gt;</span>123<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;javascri&amp;#x0070;t:alert(1)&#34;</span><span class="p">&gt;</span>link<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span> <span class="na">onerror</span><span class="o">=</span><span class="s">alert&amp;#40;2&amp;#41;</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="42-url解析" class="heading-element"><span>4.2 URL解析</span>
  <a href="#42-url%e8%a7%a3%e6%9e%90" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>URL 解析器也可以视为状态机，输入流中的字符可以将其定向到不同的状态。<a href="https://url.spec.whatwg.org/"target="_blank" rel="external nofollow noopener noreferrer">URL解析器规范在这里</a>。</p>
<p>从安全或 XSS 转义的角度来看，有几件事很有趣。</p>
<p>首先，URL 格式必须是 ASCII 字母字符。 (U+0041-U+005A || U+0061-U+007A)，否则状态会转变为“无格式”状态。</p>
<p>例如，如果对协议格式进行任何形式的编码，URL 解析器都将无法识别为协议。问题 1 中的脚本不执行就是因为URL 解析器没有将url 编码的“javascript”识别为协议。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">1.URL编码&#34;javascript:alert(1)&#34;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;%6a%61%76%61%73%63%72%69%70%74:%61%6c%65%72%74%28%31%29&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">3.URL编码&#34;:&#34;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;javascript%3aalert(3)&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>同样的理论也适用于 &lsquo;:&rsquo; 字符，如果对其进行编码将无法识别。这就是问题 3 中的脚本不会执行的原因。</p>
<p>那么，当使用字符实体对方案 (javascript) 进行编码时，为什么问题 2 中的脚本会执行？</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;:%61   %6c%65%72%74%28%32%29&#34;</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这里就要用到刚在HTML 解析部分讨论过的内容，有一种状态称为“属性值状态”，在这种状态下，字符引用将被解码并替换为解码后的版本。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;javascript:%61   %6c%65%72%74%28%32%29&#34;</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这里实际发生的是HTML解析器解析文档、创建标签tokens并解码 href 属性中的HTML字符实体。</p>
<p>当 HTML 解析器完成后，URL 解析器开始解析 href 值中的链接，此时“javascript”已经解码，并被 URL 解析器识别为JavaScript协议。</p>
<p>然后 URL 解析器继续对链接的后续部分进行 URL 解码。因为是“javascript”协议，所以后续使用JavaScript 解析器来解析执行，这就是问题 2 中的脚本被执行的原因。</p>
<p>&#x26a0;&#xfe0f;<em>注意：URL编码是使用UTF-8编码方案对每个字符进行编码。如果使用另一种方案对URL进行编码，则 URL 解析器可能无法识别，这可能会变得失效。</em></p>
<p>url解析器识别相应的协议，我们上面提到JavaScript伪协议之外，通过http协议加载外部JS文件，也是一种方式。</p>
<p>在对外部链接的处理上，还可以设计一些URI的变形，不过这些不在本文进行赘述。</p>
<h3 id="43-javascript解析" class="heading-element"><span>4.3 JavaScript解析</span>
  <a href="#43-javascript%e8%a7%a3%e6%9e%90" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>JavaScript 解析不同于 HTML 解析，因为JS语言本身是上下文无关的语言(context free language)，，可以通过上下文无关语法(context free grammar)来弄清楚 JavaScript 是如何被解析的。</p>
<p>ECMAScript-262 的规范在<a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm"target="_blank" rel="external nofollow noopener noreferrer">这里</a>，一个单独的HTML解析语法文件在<a href="https://html.spec.whatwg.org/multipage/parsing.html#parsing"target="_blank" rel="external nofollow noopener noreferrer">这里</a>。</p>
<p>JS的脚本处理模型是按照源码处理-函数解析-代码执行这个顺序进行，不管是外部JS还是<code>&lt;script&gt;</code> 标签内，或者 HTML标签属性中的，对JS编码的解码都是相同的。</p>
<h4 id="1-执行上下文" class="heading-element"><span>1. 执行上下文</span>
  <a href="#1-%e6%89%a7%e8%a1%8c%e4%b8%8a%e4%b8%8b%e6%96%87" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>当一段 JavaScript 代码在运行的时候，它实际上是运行在执行上下文中。而下列三种代码都会创建相应的执行上下文：</p>
<ul>
<li><strong>全局执行上下文</strong>：它是为运行代码主体而创建的执行上下文，也就是说它是为那些存在于函数之外的任何代码而创建的。</li>
<li><strong>函数执行上下文</strong>：每个函数会在执行的时候创建自己的执行上下文。</li>
<li><strong>Eval 函数执行上下文</strong>：使用 eval() 函数也会创建一个新的执行上下文。</li>
</ul>
<p>这部分内容不是重点，就不多说了。</p>
<h4 id="2字符解码" class="heading-element"><span>2.字符解码</span>
  <a href="#2%e5%ad%97%e7%ac%a6%e8%a7%a3%e7%a0%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>我们主要关注关于安全性、字符解码方式以及在某些上下文中转义是否有效这些问题。</p>
<p>首先，让我们稍微回到 HTML 解析中的&quot;Raw text&quot;元素，因为它与 JavaScript 解析有关。</p>
<p>所有“script”块都属于原始文本元素，“script”块有一个有趣的属性：字符引用实体在其中不被解析和解码。这意味着问题 9 中的脚本将不会执行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">9.实体编码alert(9);
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">97</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">108</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">101</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">114</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">116</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">40</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">57</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">41</span><span class="p">;</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">59</span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>那么像 \uXXXX（例如 \u0000、\u000A）这样的Unicode 转义序列字符编码的 JavaScript 会被解析和执行吗？答案是需要看情况，这取决于编码序列所处的位置。</p>
<p>根据上下文，有三种情况可以使用转义序列：字符串、标识符名称或控制字符。</p>
<p><strong>字符串</strong>：当字符串中存在 Unicode 转义序列时，它们只会被解释为常规字符，而不是单双引号（&rsquo; &ldquo;）或可以结束字符串的行终止符。这在 ECMAScript 规范中有明确说明。因此，Unicode 转义序列永远不会脱离 JavaScript 中的字符串上下文，因为它们总是被解释为字符串文字。</p>
<blockquote>
<p><em>ECMA-262 edition13.0, Rev 11, Clause 1
&ldquo;ECMAScript differs from the Java programming language in the behaviour of Unicode escape sequences. In a Java program, if the Unicode escape sequence \u000A, for example, occurs within a single-line comment, it is interpreted as a line terminator (Unicode character 000A is line feed) and therefore the next Unicode character is not part of the comment. Similarly, if the Unicode escape sequence \u000A occurs within a string literal in a Java program, it is likewise interpreted as a line terminator, which is not allowed within a string literal—one must write \n instead of\u000A to cause a line feed to be part of the string value of a string literal. In an ECMAScript program, a Unicode escape sequence occurring within a comment is never interpreted and therefore cannot contribute to termination of the comment. Similarly, a Unicode escape sequence occurring within a string literal in an ECMAScript program always contributes a Unicode character to the literal and is never interpreted as a line terminator or as a quote mark that might terminate the string literal.</em>&rdquo;</p>
</blockquote>
<p>翻译：</p>
<blockquote>
<p>ECMA-262 版本13.0，第11章，第1条款</p>
<p>ECMAScript 与 Java 编程语言的区别在于 Unicode 转义序列的行为。</p>
<p>在Java中，如果Unicode转义序列\u000A，出现在单行注释中，它被解释为行终止符（Unicode 字符 000A 是换行符），因此下一个 Unicode 字符将不是注释的一部分。同样，如果\u000A 出现在 Java 程序的字符串文字中，它同样被解释为行终止符，这在字符串文字中是不允许的——必须写 \n 而不是 \u000A 以使换行符成为字符串文字的一部分。</p>
<p>在 ECMAScript 程序中，注释中出现的 Unicode 转义序列永远不会被解释，因此不会导致注释的终止。类似地，在 ECMAScript 程序的字符串文字中出现的 Unicode 转义序列总是为文字提供一个 Unicode 字符，并且永远不会被解释为行终止符或可能字符串终止的引号。</p>
</blockquote>
<p><strong>标识符名称</strong>：当标识符名称中存在 Unicode 转义序列时，它们将被解码并解释为标识符的名称，例如函数名称、属性名称等。</p>
<p>这就是为什么问题 10 中的脚本是可执行的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">\u0061\u006c\u0065\u0072\u0074</span><span class="p">(</span><span class="mi">10</span><span class="p">);&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>如果我们深入研究规范，它也清楚地说明如下。</p>
<blockquote>
<p>ECMA-262 edition13.0, Rev 12, Clause 6.1</p>
<p><em>&ldquo;Unicode escape sequences are permitted in an IdentifierName, where they contribute a single Unicode code point to the IdentifierName. The code point is expressed by the CodePoint of the UnicodeEscapeSequence (see 12.8.4). The \ preceding the UnicodeEscapeSequence and the u and { } code units, if they appear, do not contribute code points to the IdentifierName. A UnicodeEscapeSequence cannot be used to put a code point into an IdentifierName that would otherwise be illegal. &ldquo;</em></p>
</blockquote>
<p>翻译：</p>
<blockquote>
<p>标识符名称中也允许使用 Unicode 转义序列，它们将作为标识符中的一个字符，由Unicode 转义序列的 CV 计算转换（见 7.8.4）。Unicode 转义序列前的 \ 不会转换为标识符名称中的一个字符。 Unicode 转义序列不能用于将字符放入标识符名称中，否则将是非法的。</p>
<p>标识符名称中允许使用 Unicode 转义序列，它们将作为标识符中的Unicode代码点。代码点由 Unicode 转义序列的 CodePoint 表示（见 12.8.4）。Unicode 转义序列之前的 \ 以及 u 和 { } 代码单元（如果有）不会作为标识符名称中的代码点。 Unicode 转义序列不能用于将代码点放入标识符名称，否则将是非法的。</p>
</blockquote>
<p><strong>控制字符</strong>：当 Unicode 转义序列表示控制字符时，如单引号、双引号、括号等，它们不会被解释为控制字符，只会被解码和解析为标识符名称或字符串文字。查看 ECMAScript 语法，就会发现没有任何可以充当控制字符的 Unicode 转义序列。例如，如果解析器正在解析函数调用语句，则括号必须是“(”和“)”，而不是像 \u0028 和 \u0029 这样的字符。</p>
<p>也就是说，Unicode 转义序列只有在标识符名称的上下文中才会被解释为字符串，这是唯一可以注入并利用的地方。</p>
<p>回顾问题 11不起作用，因为 &lsquo;(11)&rsquo; 没有被正确解释而且 &lsquo;alert(11)&rsquo; 不是有效的标识符名称。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">11.unicode编码alert(11)
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">\u0061\u006c\u0065\u0072\u0074\u0028\u0031\u0031\u0029</span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>问题 12 ， &lsquo;\u0031\u0032&rsquo; 不会被解释为字符串，因为它们必须以单引号或双引号开头，或者是 ASCII 数字。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">12.Unicode编码alert和12
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">\u0061\u006c\u0065\u0072\u0074</span><span class="p">(</span><span class="nx">\u0031\u0032</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>问题 13 ，因为 &lsquo;\u0027&rsquo; 仅被解释为单引号文字，并没有起到控制字符的效果，导致字符串不完整。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">13.Unicode编码&#39;
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="err">&#39;</span><span class="mi">13</span><span class="nx">\u0027</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>问题 14 有效，因为 &lsquo;\u000a&rsquo; 被解释为换行符，不会被当做行终止符，没有破坏 JavaScript 语法。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">14.Unicode编码换行符
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;14\u000a&#39;</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>根据上述描述，以下编码都可以执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span> <span class="nx">\u0061lert</span><span class="p">(</span><span class="s2">&#34;Hello&#34;</span><span class="p">);</span> <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span> <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;\u0048ello&#34;</span><span class="p">);</span> <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Hello\u000a&#39;</span><span class="p">);&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="五浏览器解码顺序" class="heading-element"><span>五、浏览器解码顺序</span>
  <a href="#%e4%ba%94%e6%b5%8f%e8%a7%88%e5%99%a8%e8%a7%a3%e7%a0%81%e9%a1%ba%e5%ba%8f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>在讨论了浏览器 HTML、URL 和 JavaScript 解析之后，所有这些如何一起发挥作用？接下来将非常简要地回顾浏览器如何解析文档。</p>
<ul>
<li>
<p>当浏览器从网络堆栈获取内容时，HTML 解析器被触发并开始标记文档。这是完成HTML字符引用解码的步骤。标记化完成后，构建 DOM 树。</p>
</li>
<li>
<p>JavaScript 解析器开始解析内联脚本和<code>script</code>块中的脚本。这是对 Unicode 转义序列和 Hex 转义序列进行解码的步骤。</p>
</li>
<li>
<p>同时，如果浏览器遇到需要 URL 的上下文，URL 解析器也会启动以解码 URL 内容。这是完成 URL 解码的步骤。根据 URL 的位置，URL 解析器可能会在 JavaScript 解析器进入之前或之后解析内容。</p>
</li>
</ul>
<p>考虑以下两个示例。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Example A: &lt;a href=&#34;UserInput&#34;&gt;&lt;/a&gt;
</span></span><span class="line"><span class="cl">Example B: &lt;a href=# onclick=&#34;window.open(&#39;UserInput&#39;)&#34;&gt;&lt;/a&gt;</span></span></code></pre></td></tr></table>
</div>
</div><p>在示例 A 中，HTML 解析器将首先启动并对用户输入执行字符引用解码。然后 URL 解析器开始对 href 中的值进行 URL 解码。最后，如果 URL scheme 是 javascript，则 JavaScript 解析器来执行 Unicode 转义序列和 Hex 转义序列解码。之后，脚本被执行。所以一共有三轮解码，依次是HTML、URL、JavaScript。</p>
<p>在示例 B 中，HTML 解析器也首先启动。但是之后，JavaScript 解析器开始解析 onclick 处理程序中的值，因为 onclick 处理程序中需要脚本。当 JavaScript 被解析和执行时，它看到它正在执行“window.open()”，其中参数应该是一个 URL。此时，URL 解析器开始对用户输入进行 URL 解码，并将结果传回 JavaScript 引擎。所以一共有三轮解码，依次是HTML、JavaScript、URL。</p>
<p>有没有可能超过三轮解码？考虑下面的例子</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Example C: &lt;a href=&#34;javascript:window.open(&#39;UserInput&#39;)&#34;&gt;</span></span></code></pre></td></tr></table>
</div>
</div><p>示例 C 与 A 类似，但在 JavaScript 中存在“window.open”调用的意义上也有所不同。因此，将对 UserInput 进行额外的 URL 解码。一般情况下会进行四次解码，依次为HTML、URL、JavaScript、URL。</p>
<p>此时，您应该具备解决文章开头所有问题的必要知识。</p>
<h2 id="六总结" class="heading-element"><span>六、总结</span>
  <a href="#%e5%85%ad%e6%80%bb%e7%bb%93" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>总而言之，为了了解如何使 XSS payload脱离攻击者的上下文，或者如何使应用程序服务器正确编码用户输入，就必须真正了解浏览器解析器的工作原理以及组件（HTML、URL 和 JavaScript 解析器）如何协同工作。</p>
<p>同样，如果想要绕过防御检测，使payload能够被正确解析执行，也必须要了解浏览器的工作原理和解析器的协调处理，只有在这种情况下，才能像浏览器一样正确地编码攻击载荷。</p>
<h2 id="参考文章" class="heading-element"><span>参考文章：</span>
  <a href="#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li>
<p><a href="https://www.attacker-domain.com/2013/04/deep-dive-into-browser-parsing-and-xss.html"target="_blank" rel="external nofollow noopener noreferrer">Deep dive into browser parsing and XSS payload encoding</a></p>
</li>
<li>
<p><a href="https://html.spec.whatwg.org/multipage/parsing.html"target="_blank" rel="external nofollow noopener noreferrer">HTML标记规范</a></p>
</li>
<li>
<p><a href="https://url.spec.whatwg.org/"target="_blank" rel="external nofollow noopener noreferrer">URL规范</a></p>
</li>
<li>
<p><a href="https://www.w3.org/html/ig/zh/wiki/HTML5/syntax"target="_blank" rel="external nofollow noopener noreferrer">HTML 语法</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/xawjz/article/details/120515355"target="_blank" rel="external nofollow noopener noreferrer">浏览器解析HTML，渲染页面的过程</a></p>
</li>
<li>
<p><a href="https://zhuanlan.zhihu.com/p/445810614"target="_blank" rel="external nofollow noopener noreferrer">深入理解浏览器解析渲染 HTML</a></p>
</li>
<li>
<p><a href="https://www.jianshu.com/p/c0dc4bbab8e8"target="_blank" rel="external nofollow noopener noreferrer">浏览器工作原理与XSS-HTML编码</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/6954966248233009182"target="_blank" rel="external nofollow noopener noreferrer">理解 JavaScript 的执行上下文这篇就够了！</a></p>
</li>
</ul>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2023-03-30 21:45:15">更新于 2023-03-30&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/pentest/" class="post-tag" title="标签 - Pentest">Pentest</a><a href="/tags/xss/" class="post-tag" title="标签 - XSS">XSS</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/20230324-%E6%94%BB%E9%98%B2%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" class="post-nav-item" rel="prev" title="20230324-攻防项目总结"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>20230324-攻防项目总结</a><a href="/posts/20230425-shellspawn/" class="post-nav-item" rel="next" title="Shell Spawning">Shell Spawning<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="目录"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">该网站在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/twemoji/twemoji.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":20},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/search.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"没有找到结果","snippetLength":30,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"twemoji":true,"version":"v0.3.16"};console.log('Page config:', window.config);</script><script src="/js/theme.min.js" defer></script></body>
</html>
